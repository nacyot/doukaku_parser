
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja"> 
  <head>

<script type="text/javascript" src="/static/js/analytics.js" ></script>
<link type="text/css" rel="stylesheet" href="/static/css/banner-styles.css"/>




    <meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
    <title>
居眠り床屋問題
どう書く？org </title>

    <link rel="stylesheet" type="text/css"
	href="/web/20100712030912cs_/http://ja.doukaku.org/static/style/reset-fonts-grids.css" />
    <link rel="stylesheet" type="text/css"
	href="/web/20100712030912cs_/http://ja.doukaku.org/static/style/style.css?20071211?20071207" />
	
    <link rel="stylesheet" type="text/css"
	href="/web/20100712030912cs_/http://ja.doukaku.org/static/style/pygments.css" />


	
<meta name="robots" content="noindex,nofollow">

    <!--<script src="/web/20100712030912/http://ja.doukaku.org/static/js/ieerbug/ieerbug.js" type="text/javascript"></script>-->


<!--<script src="/web/20100712030912/http://ja.doukaku.org/static/js/ieerbug/ieerbug.js" type="text/javascript"></script>-->
<script src="/web/20100712030912js_/http://ja.doukaku.org/static/js/jquery-1.1.3.1.js" type="text/javascript"></script>
<script src="/web/20100712030912js_/http://ja.doukaku.org/static/js/rating.js" type="text/javascript"></script>
<script src="/web/20100712030912js_/http://ja.doukaku.org/static/js/addtag.js?20071129" type="text/javascript"></script>

<script type="text/javascript">
is_key_navigation_enable = true;
</script>
<script src="/web/20100712030912js_/http://ja.doukaku.org/static/js/utils.js?~~~" type="text/javascript"></script>

</head>


<body id="doukaku_org">
<!-- BEGIN WAYBACK TOOLBAR INSERT -->
<script> if (window.archive_analytics) { window.archive_analytics.values['server_name']="wwwb-app0.us.archive.org";}; </script>

<script type="text/javascript" src="/static/js/disclaim-element.js" ></script>
<script type="text/javascript" src="/static/js/graph-calc.js" ></script>
<script type="text/javascript" src="/static/jflot/jquery.min.js" ></script>
<script type="text/javascript">
//<![CDATA[
var firstDate = 820454400000;
var lastDate = 1388534399999;
var wbPrefix = "/web/";
var wbCurrentUrl = "http:\/\/ja.doukaku.org\/285\/flatten\/";

var curYear = -1;
var curMonth = -1;
var yearCount = 18;
var firstYear = 1996;
var imgWidth = 450;
var yearImgWidth = 25;
var monthImgWidth = 2;
var trackerVal = "none";
var displayDay = "12";
var displayMonth = "Jul";
var displayYear = "2010";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function showTrackers(val) {
	if(val == trackerVal) {
		return;
	}
	if(val == "inline") {
		document.getElementById("displayYearEl").style.color = "#ec008c";
		document.getElementById("displayMonthEl").style.color = "#ec008c";
		document.getElementById("displayDayEl").style.color = "#ec008c";		
	} else {
		document.getElementById("displayYearEl").innerHTML = displayYear;
		document.getElementById("displayYearEl").style.color = "#ff0";
		document.getElementById("displayMonthEl").innerHTML = displayMonth;
		document.getElementById("displayMonthEl").style.color = "#ff0";
		document.getElementById("displayDayEl").innerHTML = displayDay;
		document.getElementById("displayDayEl").style.color = "#ff0";
	}
   document.getElementById("wbMouseTrackYearImg").style.display = val;
   document.getElementById("wbMouseTrackMonthImg").style.display = val;
   trackerVal = val;
}
function getElementX2(obj) {
	var thing = jQuery(obj);
	if((thing == undefined) 
			|| (typeof thing == "undefined") 
			|| (typeof thing.offset == "undefined")) {
		return getElementX(obj);
	}
	return Math.round(thing.offset().left);
}
function trackMouseMove(event,element) {

   var eventX = getEventX(event);
   var elementX = getElementX2(element);
   var xOff = eventX - elementX;
	if(xOff < 0) {
		xOff = 0;
	} else if(xOff > imgWidth) {
		xOff = imgWidth;
	}
   var monthOff = xOff % yearImgWidth;

   var year = Math.floor(xOff / yearImgWidth);
	var yearStart = year * yearImgWidth;
   var monthOfYear = Math.floor(monthOff / monthImgWidth);
   if(monthOfYear > 11) {
       monthOfYear = 11;
   }
   // 1 extra border pixel at the left edge of the year:
   var month = (year * 12) + monthOfYear;
   var day = 1;
	if(monthOff % 2 == 1) {
		day = 15;
	}
	var dateString = 
		zeroPad(year + firstYear) + 
		zeroPad(monthOfYear+1,2) +
		zeroPad(day,2) + "000000";

	var monthString = prettyMonths[monthOfYear];
	document.getElementById("displayYearEl").innerHTML = year + 1996;
	document.getElementById("displayMonthEl").innerHTML = monthString;
	// looks too jarring when it changes..
	//document.getElementById("displayDayEl").innerHTML = zeroPad(day,2);

	var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
	document.getElementById('wm-graph-anchor').href = url;

   //document.getElementById("wmtbURL").value="evX("+eventX+") elX("+elementX+") xO("+xOff+") y("+year+") m("+month+") monthOff("+monthOff+") DS("+dateString+") Moy("+monthOfYear+") ms("+monthString+")";
   if(curYear != year) {
       var yrOff = year * yearImgWidth;
       document.getElementById("wbMouseTrackYearImg").style.left = yrOff + "px";
       curYear = year;
   }
   if(curMonth != month) {
       var mtOff = year + (month * monthImgWidth) + 1;
       document.getElementById("wbMouseTrackMonthImg").style.left = mtOff + "px";
       curMonth = month;
   }
}
//]]>
</script>

<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>
<div id="wm-ipp" lang="en" class="__wb_banner_div" style="display:none; position:relative;padding:0 5px;min-height:70px;min-width:800px">


<div id="wm-ipp-inside" class="__wb_banner_div" style="position:fixed;padding:0!important;margin:0!important;width:97%;min-width:780px;border:5px solid #000;border-top:none;background-image:url(/static/images/toolbar/wm_tb_bk_trns.png);text-align:center;-moz-box-shadow:1px 1px 3px #333;-webkit-box-shadow:1px 1px 3px #333;box-shadow:1px 1px 3px #333;font-size:11px!important;font-family:'Lucida Grande','Arial',sans-serif!important;">
   <table style="border-collapse:collapse;margin:0;padding:0;width:100%;"><tbody><tr>
   <td style="padding:10px;vertical-align:top;min-width:110px;">
   <a href="/web/" title="Wayback Machine home page" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0"/></a>
   </td>
   <td style="padding:0!important;text-align:center;vertical-align:top;width:100%;">

       <table style="border-collapse:collapse;margin:0 auto;padding:0;width:570px;"><tbody><tr>
       <td style="padding:3px 0;" colspan="2">
       <form target="_top" method="get" action="/web/form-submit.jsp" name="wmtb" id="wmtb" style="margin:0!important;padding:0!important;"><input type="text" name="url" id="wmtbURL" value="http://ja.doukaku.org/285/flatten/" style="width:400px;font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;" onfocus="javascript:this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20100712030912" /><input type="submit" value="Go" style="font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;margin-left:5px;width: inherit !important" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td style="vertical-align:bottom;padding:5px 0 0 0!important;" rowspan="2">
           <table style="border-collapse:collapse;width:110px;color:#99a;font-family:'Helvetica','Lucida Grande','Arial',sans-serif;"><tbody>
			
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr style="width:110px;height:16px;font-size:10px!important;">
           	<td style="padding-right:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20100506231028/http://ja.doukaku.org/285/flatten/" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="6 May 2010"><strong>MAY</strong></a>
		                
               </td>
               <td id="displayMonthEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight:bold;text-transform:uppercase;width:34px;height:15px;padding-top:1px;text-align:center;" title="You are here: 3:09:12 Jul 12, 2010">JUL</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
                       Aug
                       
               </td>
           </tr>

           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr>
               <td style="padding-right:9px;white-space:nowrap;overflow:visible;text-align:right!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20100506231028/http://ja.doukaku.org/285/flatten/" title="23:10:28 May 6, 2010" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a>
		                
               </td>
               <td id="displayDayEl" style="background:#000;color:#ff0;width:34px;height:24px;padding:2px 0 0 0;text-align:center;font-size:24px;font-weight: bold;" title="You are here: 3:09:12 Jul 12, 2010">12</td>
				<td style="padding-left:9px;white-space:nowrap;overflow:visible;text-align:left!important;vertical-align:middle!important;" nowrap="nowrap">
               
                       <img src="/static/images/toolbar/wm_tb_nxt_off.png" alt="Next capture" width="14" height="16" border="0"/>
                       
			    </td>
           </tr>

           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr style="width:110px;height:13px;font-size:9px!important;">
				<td style="padding-right:9px;font-size:11px!important;font-weight: bold;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
                       2009
                       
               </td>
               <td id="displayYearEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight: bold;padding-top:1px;width:34px;height:13px;text-align:center;" title="You are here: 3:09:12 Jul 12, 2010">2010</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight: bold;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
                       2011
                       
				</td>
           </tr>
           </tbody></table>
       </td>

       </tr>
       <tr>
       <td style="vertical-align:middle;padding:0!important;">
           <a href="/web/20100712030912*/http://ja.doukaku.org/285/flatten/" style="color:#33f;font-size:11px;font-weight:bold;background-color:transparent;border:none;" title="See a list of every capture for this URL"><strong>3 captures</strong></a>
           <div class="__wb_banner_div" style="margin:0!important;padding:0!important;color:#666;font-size:9px;padding-top:2px!important;white-space:nowrap;" title="Timespan for captures of this URL">13 Dec 09 - 12 Jul 10</div>
       </td>
       <td style="padding:0!important;">
       <a style="position:relative; white-space:nowrap; width:450px;height:27px;" href="" id="wm-graph-anchor">
       <div class="__wb_banner_div" id="wm-ipp-sparkline" style="position:relative; white-space:nowrap; width:450px;height:27px;background-color:#fff;cursor:pointer;border-right:1px solid #ccc;" title="Explore captures for this URL">
			<img id="sparklineImgId" style="position:absolute; z-index:9012; top:0px; left:0px;"
				onmouseover="showTrackers('inline');" 
				onmouseout="showTrackers('none');"
				onmousemove="trackMouseMove(event,this)"
				alt="sparklines"
				width="450"
				height="27"
				border="0"
				src="/web/jsp/graph.jsp?graphdata=450_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000000000000_2004:-1:000000000000_2005:-1:000000000000_2006:-1:000000000000_2007:-1:000000000000_2008:-1:000000000000_2009:-1:000000000001_2010:6:000010100000_2011:-1:000000000000_2012:-1:000000000000_2013:-1:000000000000"></img>
			<img id="wbMouseTrackYearImg" 
				style="display:none; position:absolute; z-index:9010;"
				width="25" 
				height="27"
				border="0"
				src="/static/images/toolbar/transp-yellow-pixel.png"></img>
			<img id="wbMouseTrackMonthImg"
				style="display:none; position:absolute; z-index:9011; " 
				width="2"
				height="27" 
				border="0"
				src="/static/images/toolbar/transp-red-pixel.png"></img>
       </div>
		</a>

       </td>
       </tr></tbody></table>
   </td>
   <td style="text-align:right;padding:5px;width:65px;font-size:11px!important;">
       <a href="javascript:;" onclick="document.getElementById('wm-ipp').style.display='none';" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_close.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;margin-bottom:23px;background-color:transparent;border:none;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_help.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;background-color:transparent;border:none;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>

</div>
</div>
<script type="text/javascript">
 var wmDisclaimBanner = document.getElementById("wm-ipp");
 if(wmDisclaimBanner != null) {
   disclaimElement(wmDisclaimBanner);
 }
</script>
<!-- END WAYBACK TOOLBAR INSERT -->


<div id="page_head" class="compact">
  <h1 class="compact">
    <a href="/web/20100712030912/http://ja.doukaku.org/">どう書く？org</a><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/beta.png" alt="beta">
  </h1>
</div>

<div id="page_body" class="compact">
<div id="content" class="compact">




<h2 class="compact">
<img src='/web/20100712030912im_/http://ja.doukaku.org/static/image/star_gold.png' alt=お題(出題済み)>
<a href="/web/20100712030912/http://ja.doukaku.org/285/">居眠り床屋問題</a>
</h2>

    





<div class="comment" id="comment9625">
  <p class="banner"><a href="/web/20100712030912/http://ja.doukaku.org/user/88/" target="_top">sumim</a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9625/">#9625</a>(<script language="JavaScript">print_time(new Date("2009/10/09 16:50 GMT"));</script><noscript>2009/10/09 16:50 GMT</noscript>)
	
	
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content" >
	<div class="comment_body">
	  <div class="section">
<p>並行処理のお題です。ある床屋の亭主は、客がいないときまって居眠りを始めます。床屋店内には三台の散髪兼順番待ち用の椅子があり、客は来店時に椅子に空きがあれば、いずれかに勝手に座って自分の番が来るのを待ち、散髪を終えてから店を出ます。空席が無ければそのまま何もせずに立ち去ります。居眠り中の亭主は、客の入店時に起こされると待ち客すべてをひとりずつ順に散髪しますが、誰もいなくなればまた居眠りを始めます。</p>
<p></p>
<p>この床屋店に16人の客が訪れた日のシミュレーションを行なうコードと、その結果（下に例として示したログ形式。「[スレッドのIDなど] イベント描写」の一覧と終了後の総括）を出力して示してください。なお、散髪には一人当たり100～400ミリ秒の時間（この範囲でランダムに変化）を要し、客は通常 0～200ミリ秒（同）の間隔で訪れます。ただし例外として9番目の客だけは前の客から1200ミリ秒程度の間隔（すなわち、最大三名の待ち客全員を散髪し終えるのに十分な時間）をあけて訪れるものとします。</p>
<p></p>
<p>実装に際し、実行時のデッドロックの回避はもちろんですが、そのほかにも、競合状態（席の空きを確認して座ろうとしたら、もう別の客が座っていた…というような事態）などの不整合も生じないよう配慮し、必要であればそのための対策を講じてください。たとえば来客の間隔が仮に０ミリ秒で固定の場合（つまり、客が一斉に来店した場合）でも、コードが正常に動作するかどうか試してみるのもよいかもしれません。</p>
<p>　</p>
<p>　</p>
<p>出力例：</p>
<p>[7302088] 床屋、眠る</p>
<p>[7012360] 来店 1</p>
<p>[7302088] 床屋、目覚める</p>
<p>[7302088] 散髪開始 1</p>
<p>[7012360] 来店 2</p>
<p>[7012360] 来店 3</p>
<p>[7302088] 散髪完了 1</p>
<p>[7302088] 散髪開始 2</p>
<p>[7012360] 来店 4</p>
<p>[7012360] 来店 5</p>
<p>[7012360] 満席で立ち去る 5</p>
<p>[7302088] 散髪完了 2</p>
<p>[7302088] 散髪開始 3</p>
<p>[7012360] 来店 6</p>
<p>[7012360] 来店 7</p>
<p>[7012360] 満席で立ち去る 7</p>
<p>[7012360] 来店 8</p>
<p>[7012360] 満席で立ち去る 8</p>
<p>[7302088] 散髪完了 3</p>
<p>[7302088] 散髪開始 4</p>
<p>[7302088] 散髪完了 4</p>
<p>[7302088] 散髪開始 6</p>
<p>[7302088] 散髪完了 6</p>
<p>[7302088] 床屋、眠る</p>
<p>[7012360] 来店 9</p>
<p>[7302088] 床屋、目覚める</p>
<p>[7302088] 散髪開始 9</p>
<p>[7012360] 来店 10</p>
<p>[7012360] 来店 11</p>
<p>[7012360] 来店 12</p>
<p>[7012360] 満席で立ち去る 12</p>
<p>[7302088] 散髪完了 9</p>
<p>[7302088] 散髪開始 10</p>
<p>[7012360] 来店 13</p>
<p>[7012360] 来店 14</p>
<p>[7012360] 満席で立ち去る 14</p>
<p>[7012360] 来店 15</p>
<p>[7012360] 満席で立ち去る 15</p>
<p>[7302088] 散髪完了 10</p>
<p>[7302088] 散髪開始 11</p>
<p>[7012360] 来店 16</p>
<p>[7302088] 散髪完了 11</p>
<p>[7302088] 散髪開始 13</p>
<p>[7302088] 散髪完了 13</p>
<p>[7302088] 散髪開始 16</p>
<p>[7302088] 散髪完了 16</p>
<p>[7302088] 床屋、眠る</p>
<p>※ 16人のうち 10人を散髪</p>
<p>　</p>
</div>
	</div>
	
	<p class="link">
	  参考: <a href="/web/20100712030912/http://en.wikipedia.org/wiki/Sleeping_barber_problem">Wikipedia - Sleeping barber problem</a>
	</p>  
	
	
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9625/addtag/" class="addtag" id="addtag_9625">タグ</a>:
	
	タグなし
	&nbsp;

	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_9625"
  >-</span><span
  class="button yellow"
  id="rating_z_9625"
  >0</span><span 
  class="button green"
  id="rating_p_9625"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20100712030912/http://ja.doukaku.org/285/reply_to/9625/">
  返信
  </a>]
  </div>
</div>
</div>




  



<div class="indent">
<a href="/web/20100712030912/http://ja.doukaku.org/285/post_comment/">
投稿する
</a>
</div>


<h2>投稿されたコメント - フラット表示</h2>
<a href="/web/20100712030912/http://ja.doukaku.org/285/nested/">ネスト表示</a>
<a href="/web/20100712030912/http://ja.doukaku.org/285/">非表示</a> 


  
  <br/>

  
  




<div class="comment" id="comment9628">
  <p class="banner"><a href="/web/20100712030912/http://ja.doukaku.org/user/504/" target="_top">あにす</a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9628/">#9628</a>(<script language="JavaScript">print_time(new Date("2009/10/12 00:30 GMT"));</script><noscript>2009/10/12 00:30 GMT</noscript>)
	
	
	
	[<a href="/web/20100712030912/http://ja.doukaku.org/lang/csharp/">
	  C#
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  【1回目】<br/>[11]&nbsp;床屋、眠る<br/>[12]&nbsp;来店&nbsp;1<br/>[11]&nbsp;床屋、目覚める<br/>[11]&nbsp;散髪開始&nbsp;1<br/>[12]&nbsp;来店&nbsp;2<br/>[12]&nbsp;来店&nbsp;3<br/>[11]&nbsp;散髪完了&nbsp;1<br/>[11]&nbsp;散髪開始&nbsp;2<br/>[12]&nbsp;来店&nbsp;4<br/>[12]&nbsp;来店&nbsp;5<br/>[12]&nbsp;満席で立ち去る&nbsp;5<br/>[11]&nbsp;散髪完了&nbsp;2<br/>[11]&nbsp;散髪開始&nbsp;3<br/>[12]&nbsp;来店&nbsp;6<br/>[12]&nbsp;来店&nbsp;7<br/>[12]&nbsp;満席で立ち去る&nbsp;7<br/>[11]&nbsp;散髪完了&nbsp;3<br/>[11]&nbsp;散髪開始&nbsp;4<br/>[12]&nbsp;来店&nbsp;8<br/>[11]&nbsp;散髪完了&nbsp;4<br/>[11]&nbsp;散髪開始&nbsp;6<br/>[11]&nbsp;散髪完了&nbsp;6<br/>[11]&nbsp;散髪開始&nbsp;8<br/>[11]&nbsp;散髪完了&nbsp;8<br/>[11]&nbsp;床屋、眠る<br/>[12]&nbsp;来店&nbsp;9<br/>[11]&nbsp;床屋、目覚める<br/>[11]&nbsp;散髪開始&nbsp;9<br/>[12]&nbsp;来店&nbsp;10<br/>[12]&nbsp;来店&nbsp;11<br/>[12]&nbsp;来店&nbsp;12<br/>[12]&nbsp;満席で立ち去る&nbsp;12<br/>[11]&nbsp;散髪完了&nbsp;9<br/>[11]&nbsp;散髪開始&nbsp;10<br/>[12]&nbsp;来店&nbsp;13<br/>[12]&nbsp;来店&nbsp;14<br/>[12]&nbsp;満席で立ち去る&nbsp;14<br/>[11]&nbsp;散髪完了&nbsp;10<br/>[11]&nbsp;散髪開始&nbsp;11<br/>[12]&nbsp;来店&nbsp;15<br/>[11]&nbsp;散髪完了&nbsp;11<br/>[11]&nbsp;散髪開始&nbsp;13<br/>[12]&nbsp;来店&nbsp;16<br/>[11]&nbsp;散髪完了&nbsp;13<br/>[11]&nbsp;散髪開始&nbsp;15<br/>[11]&nbsp;散髪完了&nbsp;15<br/>[11]&nbsp;散髪開始&nbsp;16<br/>[11]&nbsp;散髪完了&nbsp;16<br/>[11]&nbsp;床屋、眠る<br/>※&nbsp;16人のうち&nbsp;12人を散髪<br/><br/>【2回目】<br/>[12]&nbsp;床屋、眠る<br/>[13]&nbsp;来店&nbsp;1<br/>[12]&nbsp;床屋、目覚める<br/>[12]&nbsp;散髪開始&nbsp;1<br/>[13]&nbsp;来店&nbsp;2<br/>[13]&nbsp;来店&nbsp;3<br/>[13]&nbsp;来店&nbsp;4<br/>[13]&nbsp;満席で立ち去る&nbsp;4<br/>[12]&nbsp;散髪完了&nbsp;1<br/>[12]&nbsp;散髪開始&nbsp;2<br/>[13]&nbsp;来店&nbsp;5<br/>[12]&nbsp;散髪完了&nbsp;2<br/>[12]&nbsp;散髪開始&nbsp;3<br/>[13]&nbsp;来店&nbsp;6<br/>[13]&nbsp;来店&nbsp;7<br/>[13]&nbsp;満席で立ち去る&nbsp;7<br/>[13]&nbsp;来店&nbsp;8<br/>[13]&nbsp;満席で立ち去る&nbsp;8<br/>[12]&nbsp;散髪完了&nbsp;3<br/>[12]&nbsp;散髪開始&nbsp;5<br/>[12]&nbsp;散髪完了&nbsp;5<br/>[12]&nbsp;散髪開始&nbsp;6<br/>[12]&nbsp;散髪完了&nbsp;6<br/>[12]&nbsp;床屋、眠る<br/>[13]&nbsp;来店&nbsp;9<br/>[12]&nbsp;床屋、目覚める<br/>[12]&nbsp;散髪開始&nbsp;9<br/>[13]&nbsp;来店&nbsp;10<br/>[13]&nbsp;来店&nbsp;11<br/>[13]&nbsp;来店&nbsp;12<br/>[13]&nbsp;満席で立ち去る&nbsp;12<br/>[12]&nbsp;散髪完了&nbsp;9<br/>[12]&nbsp;散髪開始&nbsp;10<br/>[13]&nbsp;来店&nbsp;13<br/>[13]&nbsp;来店&nbsp;14<br/>[13]&nbsp;満席で立ち去る&nbsp;14<br/>[12]&nbsp;散髪完了&nbsp;10<br/>[12]&nbsp;散髪開始&nbsp;11<br/>[13]&nbsp;来店&nbsp;15<br/>[13]&nbsp;来店&nbsp;16<br/>[13]&nbsp;満席で立ち去る&nbsp;16<br/>[12]&nbsp;散髪完了&nbsp;11<br/>[12]&nbsp;散髪開始&nbsp;13<br/>[12]&nbsp;散髪完了&nbsp;13<br/>[12]&nbsp;散髪開始&nbsp;15<br/>[12]&nbsp;散髪完了&nbsp;15<br/>[12]&nbsp;床屋、眠る<br/>※&nbsp;16人のうち&nbsp;10人を散髪<br/><br/>【3回目】<br/>[12]&nbsp;床屋、眠る<br/>[13]&nbsp;来店&nbsp;1<br/>[12]&nbsp;床屋、目覚める<br/>[12]&nbsp;散髪開始&nbsp;1<br/>[13]&nbsp;来店&nbsp;2<br/>[12]&nbsp;散髪完了&nbsp;1<br/>[12]&nbsp;散髪開始&nbsp;2<br/>[13]&nbsp;来店&nbsp;3<br/>[13]&nbsp;来店&nbsp;4<br/>[12]&nbsp;散髪完了&nbsp;2<br/>[12]&nbsp;散髪開始&nbsp;4<br/>[13]&nbsp;来店&nbsp;5<br/>[13]&nbsp;来店&nbsp;6<br/>[13]&nbsp;満席で立ち去る&nbsp;6<br/>[13]&nbsp;来店&nbsp;7<br/>[13]&nbsp;満席で立ち去る&nbsp;7<br/>[13]&nbsp;来店&nbsp;8<br/>[13]&nbsp;満席で立ち去る&nbsp;8<br/>[12]&nbsp;散髪完了&nbsp;4<br/>[12]&nbsp;散髪開始&nbsp;3<br/>[12]&nbsp;散髪完了&nbsp;3<br/>[12]&nbsp;散髪開始&nbsp;5<br/>[12]&nbsp;散髪完了&nbsp;5<br/>[12]&nbsp;床屋、眠る<br/>[13]&nbsp;来店&nbsp;9<br/>[12]&nbsp;床屋、目覚める<br/>[12]&nbsp;散髪開始&nbsp;9<br/>[13]&nbsp;来店&nbsp;10<br/>[13]&nbsp;来店&nbsp;11<br/>[13]&nbsp;来店&nbsp;12<br/>[13]&nbsp;満席で立ち去る&nbsp;12<br/>[13]&nbsp;来店&nbsp;13<br/>[13]&nbsp;満席で立ち去る&nbsp;13<br/>[12]&nbsp;散髪完了&nbsp;9<br/>[12]&nbsp;散髪開始&nbsp;10<br/>[13]&nbsp;来店&nbsp;14<br/>[13]&nbsp;来店&nbsp;15<br/>[13]&nbsp;満席で立ち去る&nbsp;15<br/>[13]&nbsp;来店&nbsp;16<br/>[13]&nbsp;満席で立ち去る&nbsp;16<br/>[12]&nbsp;散髪完了&nbsp;10<br/>[12]&nbsp;散髪開始&nbsp;11<br/>[12]&nbsp;散髪完了&nbsp;11<br/>[12]&nbsp;散髪開始&nbsp;14<br/>[12]&nbsp;散髪完了&nbsp;14<br/>[12]&nbsp;床屋、眠る<br/>※&nbsp;16人のうち&nbsp;9人を散髪
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81</pre></td><td class="code"><div class="highlight"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Program</span> <span class="k">{</span>
    <span class="k">static</span> <span class="n">Random</span> <span class="n">rnd</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Random</span><span class="p">();</span>
    <span class="k">static</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">chair</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="m">3</span><span class="p">];</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">count</span><span class="p">;</span>
    <span class="k">static</span> <span class="kt">bool</span> <span class="n">ownerSleep</span><span class="p">;</span>
    <span class="k">static</span> <span class="kt">bool</span> <span class="n">end</span><span class="p">;</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="k">{</span>
        <span class="n">Thread</span> <span class="n">owner</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="p">(</span><span class="n">Owner</span><span class="p">);</span>
        <span class="n">Thread</span> <span class="n">visitors</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="p">(</span><span class="n">Visitors</span><span class="p">);</span>
        <span class="n">owner</span><span class="p">.</span><span class="n">Start</span><span class="p">(</span><span class="n">owner</span><span class="p">.</span><span class="n">ManagedThreadId</span><span class="p">);</span>
        <span class="n">visitors</span><span class="p">.</span><span class="n">Start</span><span class="p">(</span><span class="n">visitors</span><span class="p">.</span><span class="n">ManagedThreadId</span><span class="p">);</span>
    <span class="k">}</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">Owner</span><span class="p">(</span><span class="kt">object</span> <span class="n">threadID</span><span class="p">)</span> <span class="k">{</span>
        <span class="k">do</span> <span class="k">{</span>
            <span class="k">lock</span><span class="p">(</span><span class="n">chair</span><span class="p">)</span> <span class="k">{</span>
                <span class="k">if</span><span class="p">(</span><span class="n">chair</span><span class="p">.</span><span class="n">Sum</span><span class="p">()</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="k">{</span>
                    <span class="k">if</span><span class="p">(!</span><span class="n">ownerSleep</span><span class="p">)</span> <span class="k">{</span>
                        <span class="n">ownerSleep</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;[{0}] 床屋、眠る&quot;</span><span class="p">,</span> <span class="n">threadID</span><span class="p">);</span>
                    <span class="k">}</span>
                <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">ownerSleep</span><span class="p">)</span> <span class="k">{</span>
                        <span class="n">ownerSleep</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;[{0}] 床屋、目覚める&quot;</span><span class="p">,</span> <span class="n">threadID</span><span class="p">);</span>
                    <span class="k">}</span>
                <span class="k">}</span>
            <span class="k">}</span>

            <span class="k">if</span><span class="p">(!</span><span class="n">ownerSleep</span><span class="p">)</span> <span class="k">{</span>
                <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">chair</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span> <span class="k">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">chair</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span> <span class="k">{</span>
                        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;[{0}] 散髪開始 {1}&quot;</span><span class="p">,</span> <span class="n">threadID</span><span class="p">,</span> <span class="n">chair</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                        <span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">rnd</span><span class="p">.</span><span class="n">Next</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="m">401</span><span class="p">));</span>
                        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;[{0}] 散髪完了 {1}&quot;</span><span class="p">,</span> <span class="n">threadID</span><span class="p">,</span> <span class="n">chair</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                        <span class="n">count</span><span class="p">++;</span>
                        <span class="n">chair</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                    <span class="k">}</span>
                <span class="k">}</span>
            <span class="k">}</span>
        <span class="k">}</span> <span class="k">while</span><span class="p">(</span><span class="n">chair</span><span class="p">.</span><span class="n">Sum</span><span class="p">()</span> <span class="p">!=</span> <span class="m">0</span> <span class="p">||</span> <span class="p">!</span><span class="n">end</span><span class="p">);</span>

        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;[{0}] 床屋、眠る&quot;</span><span class="p">,</span> <span class="n">threadID</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;※ 16人のうち {0}人を散髪&quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">();</span>
    <span class="k">}</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">Visitors</span><span class="p">(</span><span class="kt">object</span> <span class="n">threadID</span><span class="p">)</span> <span class="k">{</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;=</span> <span class="m">16</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span> <span class="k">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;[{0}] 来店 {1}&quot;</span><span class="p">,</span> <span class="n">threadID</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
            <span class="kt">bool</span> <span class="n">packed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

            <span class="k">lock</span><span class="p">(</span><span class="n">chair</span><span class="p">)</span> <span class="k">{</span>
                <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="n">chair</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span> <span class="k">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">chair</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="k">{</span>
                        <span class="n">chair</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">=</span> <span class="n">i</span><span class="p">;</span>
                        <span class="n">packed</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">}</span>
                <span class="k">}</span>
            <span class="k">}</span>

            <span class="k">if</span><span class="p">(</span><span class="n">packed</span><span class="p">)</span> <span class="k">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;[{0}] 満席で立ち去る {1}&quot;</span><span class="p">,</span> <span class="n">threadID</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
            <span class="k">}</span>

            <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="p">==</span> <span class="m">8</span><span class="p">)</span> <span class="k">{</span>
                <span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="m">1200</span><span class="p">);</span>
            <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
                <span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">rnd</span><span class="p">.</span><span class="n">Next</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">201</span><span class="p">));</span>
            <span class="k">}</span>
        <span class="k">}</span>

        <span class="n">end</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="k">}</span>
<span class="k">}</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9628/addtag/" class="addtag" id="addtag_9628">タグ</a>:
	
	タグなし
	&nbsp;

	
      [<a href="/web/20100712030912/http://ja.doukaku.org/lang/csharp/">
		C#
      </a>]
	  
      [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9628/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9628/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_9628"
  >-</span><span
  class="button yellow"
  id="rating_z_9628"
  >0</span><span 
  class="button green"
  id="rating_p_9628"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20100712030912/http://ja.doukaku.org/285/reply_to/9628/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment9629">
  <p class="banner"><a href="/web/20100712030912/http://ja.doukaku.org/user/88/" target="_top">sumim</a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9629/">#9629</a>(<script language="JavaScript">print_time(new Date("2009/10/12 07:46 GMT"));</script><noscript>2009/10/12 07:46 GMT</noscript>)
	
	
	
	[<a href="/web/20100712030912/http://ja.doukaku.org/lang/smalltalk/">
	  Smalltalk
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <p>Squeak Smalltalk で。客を一人ずつ個別のスレッドにしてみました。</p>

	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90</pre></td><td class="code"><div class="highlight"><pre>| mutex queue tally total barber out log |
mutex := Semaphore forMutualExclusion.
queue := ValueHolder new contents: OrderedCollection new.
tally := 0.
out := SharedQueue new.
log := [:msg | out nextPut: &#39;[&#39;, Processor activeProcess name, &#39;] &#39;, msg].

barber := [
  [ queue contents
      ifEmpty: [
        log value: &#39;床屋、眠る&#39;.
        Processor activeProcess suspend.
        log value: &#39;床屋、目覚める&#39;]
      ifNotEmpty: [
        log value: &#39;散髪開始 &#39;, queue contents first printString.
            (100 to: 400) atRandom milliSeconds asDelay wait.
        log value: &#39;散髪完了 &#39;, queue contents first printString.
        mutex critical: [queue contents removeFirst].
        tally := tally + 1]
  ] repeat
] fork.

1 to: (total := 16) do: [:id |
  200 atRandom milliSeconds asDelay wait.
  [   log value: &#39;来店 &#39;, id printString.
    mutex critical: [
      queue contents size &lt; 3
        ifTrue: [
          queue contents add: id.
          barber isSuspended ifTrue: [barber resume]]
        ifFalse: [log value: &#39;満席で立ち去る &#39;, id printString]
    ]
  ] fixTemps fork.
  id = (total // 2) ifTrue: [1.2 seconds asDelay wait]].

2 seconds asDelay wait.
barber terminate.
out nextPut: (&#39;※ {1}人のうち {2}人を散髪&#39; format: {total. tally}).
World findATranscript: nil.
out size timesRepeat: [Transcript cr; show: out next]

&quot; =&gt;
[ 3680] 床屋、眠る
[ 2177] 来店 1
[ 3680] 床屋、目覚める
[ 3680] 散髪開始 1
[ 1094] 来店 2
[ 2635] 来店 3
[ 3680] 散髪完了 1
[ 3680] 散髪開始 2
[  233] 来店 4
[ 1666] 来店 5
[ 1666] 満席で立ち去る 5
[ 2269] 来店 6
[ 2269] 満席で立ち去る 6
[ 3680] 散髪完了 2
[ 3680] 散髪開始 3
[ 3450] 来店 7
[ 3680] 散髪完了 3
[ 3680] 散髪開始 4
[ 1056] 来店 8
[ 3680] 散髪完了 4
[ 3680] 散髪開始 7
[ 3680] 散髪完了 7
[ 3680] 散髪開始 8
[ 3680] 散髪完了 8
[ 3680] 床屋、眠る
[ 1513] 来店 9
[ 3680] 床屋、目覚める
[ 3680] 散髪開始 9
[ 3982] 来店 10
[ 2931] 来店 11
[  164] 来店 12
[  164] 満席で立ち去る 12
[ 2887] 来店 13
[ 2887] 満席で立ち去る 13
[ 3032] 来店 14
[ 3032] 満席で立ち去る 14
[ 3680] 散髪完了 9
[ 3680] 散髪開始 10
[ 2127] 来店 15
[  144] 来店 16
[  144] 満席で立ち去る 16
[ 3680] 散髪完了 10
[ 3680] 散髪開始 11
[ 3680] 散髪完了 11
[ 3680] 散髪開始 15
[ 3680] 散髪完了 15
[ 3680] 床屋、眠る
※ 16人のうち 10人を散髪 &quot;
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9629/addtag/" class="addtag" id="addtag_9629">タグ</a>:
	
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/Squeak_Smalltalk/">Squeak_Smalltalk</a>
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/nBaThBQcEap/">nBaThBQcEap</a>
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/vBvFEZZLAD/">vBvFEZZLAD</a>
    
	&nbsp;

	
      [<a href="/web/20100712030912/http://ja.doukaku.org/lang/smalltalk/">
		Smalltalk
      </a>]
	  
      [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9629/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9629/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_9629"
  >-</span><span
  class="button yellow"
  id="rating_z_9629"
  >0</span><span 
  class="button green"
  id="rating_p_9629"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20100712030912/http://ja.doukaku.org/285/reply_to/9629/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment9630">
  <p class="banner"><a href="/web/20100712030912/http://ja.doukaku.org/user/504/" target="_top">あにす</a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9630/">#9630</a>(<script language="JavaScript">print_time(new Date("2009/10/12 11:29 GMT"));</script><noscript>2009/10/12 11:29 GMT</noscript>)
	
	
	
	[<a href="/web/20100712030912/http://ja.doukaku.org/lang/csharp/">
	  C#
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #efffef;">1/1=1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <p>それぞれの客にスレッドを割り当て、客が居なくなると本当にスレッドが止まるようにしてみました。</p>
<p>[11] 床屋、眠る
[12] 来店 1
[11] 床屋、目覚める
[11] 散髪開始 1
[13] 来店 2
[11] 散髪完了 1
[11] 散髪開始 2
[14] 来店 3
[15] 来店 4
[16] 来店 5
[16] 満席で立ち去る 5
[11] 散髪完了 2
[11] 散髪開始 4
[17] 来店 6
[18] 来店 7
[18] 満席で立ち去る 7
[19] 来店 8
[19] 満席で立ち去る 8
[11] 散髪完了 4
[11] 床屋、目覚める
[11] 散髪開始 3
[11] 散髪完了 3
[11] 散髪開始 6
[11] 散髪完了 6
[11] 床屋、眠る
[20] 来店 9
[11] 床屋、目覚める
[11] 散髪開始 9
[21] 来店 10
[11] 散髪完了 9
[11] 散髪開始 10
[22] 来店 11
[23] 来店 12
[11] 散髪完了 10
[11] 散髪開始 12
[24] 来店 13
[25] 来店 14
[25] 満席で立ち去る 14
[26] 来店 15
[26] 満席で立ち去る 15
[27] 来店 16
[27] 満席で立ち去る 16
[11] 散髪完了 12
[11] 床屋、目覚める
[11] 散髪開始 11
[11] 散髪完了 11
[11] 散髪開始 13
[11] 散髪完了 13
[11] 床屋、眠る
※ 16人のうち 10人を散髪</p>

	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93</pre></td><td class="code"><div class="highlight"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Program</span> <span class="k">{</span>
    <span class="k">static</span> <span class="n">Random</span> <span class="n">rnd</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Random</span><span class="p">();</span>
    <span class="k">static</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">chair</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="m">3</span><span class="p">];</span>
    <span class="k">static</span> <span class="kt">int</span> <span class="n">count</span><span class="p">;</span>
    <span class="k">static</span> <span class="kt">bool</span> <span class="n">end</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">Thread</span> <span class="n">owner</span><span class="p">;</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="k">{</span>
        <span class="n">owner</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="p">(</span><span class="n">Owner</span><span class="p">);</span>
        <span class="n">Thread</span> <span class="n">visitors</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="p">(</span><span class="n">Visitors</span><span class="p">);</span>
        <span class="n">owner</span><span class="p">.</span><span class="n">Start</span><span class="p">(</span><span class="n">owner</span><span class="p">.</span><span class="n">ManagedThreadId</span><span class="p">);</span>
        <span class="n">visitors</span><span class="p">.</span><span class="n">Start</span><span class="p">(</span><span class="k">new</span> <span class="kt">object</span><span class="p">[]</span> <span class="k">{</span> <span class="n">visitors</span><span class="p">.</span><span class="n">ManagedThreadId</span><span class="p">,</span> <span class="m">1</span> <span class="k">}</span><span class="p">);</span>
    <span class="k">}</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">Owner</span><span class="p">(</span><span class="kt">object</span> <span class="n">threadID</span><span class="p">)</span> <span class="k">{</span>
        <span class="k">do</span> <span class="k">{</span>
            <span class="kt">bool</span> <span class="n">sleep</span><span class="p">;</span>
            <span class="k">lock</span><span class="p">(</span><span class="n">chair</span><span class="p">)</span> <span class="k">{</span>
                <span class="n">sleep</span> <span class="p">=</span> <span class="n">chair</span><span class="p">.</span><span class="n">Sum</span><span class="p">()</span> <span class="p">==</span> <span class="m">0</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">sleep</span> <span class="p">&amp;&amp;</span> <span class="n">owner</span><span class="p">.</span><span class="n">ThreadState</span> <span class="p">!=</span> <span class="n">ThreadState</span><span class="p">.</span><span class="n">Suspended</span><span class="p">)</span> <span class="k">{</span>
                    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;[{0}] 床屋、眠る&quot;</span><span class="p">,</span> <span class="n">threadID</span><span class="p">);</span>
                <span class="k">}</span>
            <span class="k">}</span>

            <span class="c">//ここで満席になると店主が永遠の眠りについてしまうでしょう…</span>

            <span class="k">if</span><span class="p">(</span><span class="n">sleep</span><span class="p">)</span> <span class="k">{</span>
                <span class="n">owner</span><span class="p">.</span><span class="n">Suspend</span><span class="p">();</span>
            <span class="k">}</span>

            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;[{0}] 床屋、目覚める&quot;</span><span class="p">,</span> <span class="n">threadID</span><span class="p">);</span>

            <span class="k">if</span><span class="p">(!</span><span class="n">ownerSleep</span><span class="p">)</span> <span class="k">{</span>
                <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">chair</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span> <span class="k">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">chair</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span> <span class="k">{</span>
                        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;[{0}] 散髪開始 {1}&quot;</span><span class="p">,</span> <span class="n">threadID</span><span class="p">,</span> <span class="n">chair</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                        <span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">rnd</span><span class="p">.</span><span class="n">Next</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="m">401</span><span class="p">));</span>
                        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;[{0}] 散髪完了 {1}&quot;</span><span class="p">,</span> <span class="n">threadID</span><span class="p">,</span> <span class="n">chair</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                        <span class="n">count</span><span class="p">++;</span>
                        <span class="n">chair</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                    <span class="k">}</span>
                <span class="k">}</span>
            <span class="k">}</span>
        <span class="k">}</span> <span class="k">while</span><span class="p">(</span><span class="n">chair</span><span class="p">.</span><span class="n">Sum</span><span class="p">()</span> <span class="p">!=</span> <span class="m">0</span> <span class="p">||</span> <span class="p">!</span><span class="n">end</span><span class="p">);</span>

        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;[{0}] 床屋、眠る&quot;</span><span class="p">,</span> <span class="n">threadID</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;※ 16人のうち {0}人を散髪&quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">();</span>
    <span class="k">}</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">Visitors</span><span class="p">(</span><span class="kt">object</span> <span class="n">threadID_i</span><span class="p">)</span> <span class="k">{</span>
        <span class="kt">int</span> <span class="n">threadID</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
        <span class="n">threadID</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(((</span><span class="kt">object</span><span class="p">[])</span><span class="n">threadID_i</span><span class="p">)[</span><span class="m">0</span><span class="p">]);</span>
        <span class="n">i</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(((</span><span class="kt">object</span><span class="p">[])</span><span class="n">threadID_i</span><span class="p">)[</span><span class="m">1</span><span class="p">]);</span>

        <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="p">==</span> <span class="m">9</span><span class="p">)</span> <span class="k">{</span>
            <span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="m">1200</span><span class="p">);</span>
        <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
            <span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">rnd</span><span class="p">.</span><span class="n">Next</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">201</span><span class="p">));</span>
        <span class="k">}</span>

        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;[{0}] 来店 {1}&quot;</span><span class="p">,</span> <span class="n">threadID</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="kt">bool</span> <span class="n">packed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="n">chair</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span> <span class="k">{</span>
            <span class="k">lock</span><span class="p">(</span><span class="n">chair</span><span class="p">)</span> <span class="k">{</span>
                <span class="k">if</span><span class="p">(</span><span class="n">chair</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="k">{</span>
                    <span class="n">chair</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="p">=</span> <span class="n">i</span><span class="p">;</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">owner</span><span class="p">.</span><span class="n">ThreadState</span> <span class="p">==</span> <span class="n">ThreadState</span><span class="p">.</span><span class="n">Suspended</span><span class="p">)</span> <span class="k">{</span>
                        <span class="n">owner</span><span class="p">.</span><span class="n">Resume</span><span class="p">();</span>
                    <span class="k">}</span>
                    <span class="n">packed</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">}</span>
            <span class="k">}</span>
        <span class="k">}</span>

        <span class="k">if</span><span class="p">(</span><span class="n">packed</span><span class="p">)</span> <span class="k">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;[{0}] 満席で立ち去る {1}&quot;</span><span class="p">,</span> <span class="n">threadID</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
        <span class="k">}</span>

        <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="p">&lt;</span> <span class="m">16</span><span class="p">)</span> <span class="k">{</span>
            <span class="n">Thread</span> <span class="n">visivor</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="p">(</span><span class="n">Visitors</span><span class="p">);</span>
            <span class="n">visivor</span><span class="p">.</span><span class="n">Start</span><span class="p">(</span><span class="k">new</span> <span class="kt">object</span><span class="p">[]</span> <span class="k">{</span> <span class="n">visivor</span><span class="p">.</span><span class="n">ManagedThreadId</span><span class="p">,</span> <span class="p">++</span><span class="n">i</span> <span class="k">}</span><span class="p">);</span>
        <span class="k">}</span> <span class="k">else</span> <span class="k">{</span>
            <span class="n">end</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="k">}</span>
    <span class="k">}</span>
<span class="k">}</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9630/addtag/" class="addtag" id="addtag_9630">タグ</a>:
	
	タグなし
	&nbsp;

	
      [<a href="/web/20100712030912/http://ja.doukaku.org/lang/csharp/">
		C#
      </a>]
	  
      [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9630/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9630/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #efffef;"
  >1/1=1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_9630"
  >-</span><span
  class="button yellow"
  id="rating_z_9630"
  >0</span><span 
  class="button green"
  id="rating_p_9630"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20100712030912/http://ja.doukaku.org/285/reply_to/9630/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment9631">
  <p class="banner"><a href="/web/20100712030912/http://ja.doukaku.org/user/959/" target="_top">uehaj</a>

	
	&nbsp;
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9631/">#9631</a>(<script language="JavaScript">print_time(new Date("2009/10/12 11:50 GMT"));</script><noscript>2009/10/12 11:50 GMT</noscript>)
	
	
	
	[<a href="/web/20100712030912/http://ja.doukaku.org/lang/groovy/">
	  Groovy
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  GParallelizer改め、GPars(Groovy&nbsp;Parallel&nbsp;Systems)のActorモデルを使って書いてみました。<br/>GPARSのドキュメントを良く読んでないのですが、排他制御あたりはもう少しましに書ける気がするな。<br/><br/>実行例はこんな感じ<br/><br/>$&nbsp;groovy&nbsp;barber.groovy<br/>[1]来店&nbsp;1<br/>床屋、目覚める<br/>[13]散髪開始&nbsp;1<br/>[1]来店&nbsp;2<br/>[13]散髪完了&nbsp;1<br/>[13]散髪開始&nbsp;2<br/>[1]来店&nbsp;3<br/>[1]来店&nbsp;4<br/>[1]来店&nbsp;5<br/>[1]満席で立ち去る&nbsp;5<br/>[13]散髪完了&nbsp;2<br/>[12]散髪開始&nbsp;3<br/>[1]来店&nbsp;6<br/>[12]散髪完了&nbsp;3<br/>[13]散髪開始&nbsp;4<br/>[1]来店&nbsp;7<br/>[13]散髪完了&nbsp;4<br/>[11]散髪開始&nbsp;6<br/>[1]来店&nbsp;8<br/>[11]散髪完了&nbsp;6<br/>[13]散髪開始&nbsp;7<br/>[13]散髪完了&nbsp;7<br/>[13]散髪開始&nbsp;8<br/>[13]散髪完了&nbsp;8<br/>床屋、眠る<br/>[1]来店&nbsp;9<br/>床屋、目覚める<br/>[12]散髪開始&nbsp;9<br/>[1]来店&nbsp;10<br/>[1]来店&nbsp;11<br/>[1]来店&nbsp;12<br/>[1]満席で立ち去る&nbsp;12<br/>[12]散髪完了&nbsp;9<br/>[11]散髪開始&nbsp;10<br/>[1]来店&nbsp;13<br/>[1]来店&nbsp;14<br/>[1]満席で立ち去る&nbsp;14<br/>[11]散髪完了&nbsp;10<br/>[11]散髪開始&nbsp;11<br/>[1]来店&nbsp;15<br/>[11]散髪完了&nbsp;11<br/>[11]散髪開始&nbsp;13<br/>[1]来店&nbsp;16<br/>[11]散髪完了&nbsp;13<br/>[13]散髪開始&nbsp;15<br/>[13]散髪完了&nbsp;15<br/>[13]散髪開始&nbsp;16<br/>[13]散髪完了&nbsp;16<br/>床屋、眠る
	</div>
	
	<p class="link">
	  参考: <a href="/web/20100712030912/http://gpars.codehaus.org/">Groovy Parallel Systems</a>
	</p>  
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90</pre></td><td class="code"><div class="highlight"><pre>import org.gparallelizer.actors.pooledActors.AbstractPooledActor
import static Rnd.randomValue

class Rnd {
  static random = new Random()
  static randomValue(IntRange r) {
    random.nextInt(r.to - r.from) + r.from
  }
}

class BarberShop extends AbstractPooledActor {

  Barber barber;
  def seat = []

  void visit(Customer c) {
    c.arrive()
    if (seat.size() &lt; 3) {
      synchronized (seat) {
        while (seat.size() &gt;= 3) {
        }
        if (seat.size() == 0) {
          println &quot;床屋、目覚める&quot;
        }
        seat += c
        c.bbs = this
        barber.send c
      }
    }
    else {
      c.goneSeatFull()
    }
  }

  void bye(Customer c) {
    synchronized (seat) {
      seat.remove(c)
      if (seat.size() == 0) {
        println &quot;床屋、眠る&quot;
      }
    }
  }

}

class Barber extends AbstractPooledActor {
  void act() {
    loop {
      react { Customer c -&gt;
        c.startCut()
        Thread.sleep(randomValue(100..400))
        c.finishCut()
      }
    }
  }
}

class Customer {
  def tid() {
    Thread.currentThread().id
  }

  String name
  BarberShop bbs

  void arrive() { println &quot;[${tid()}]来店 $name&quot; }
  void startCut() { println &quot;[${tid()}]散髪開始 $name&quot; }
  void finishCut() {
    println &quot;[${tid()}]散髪完了 $name&quot;
    bbs.bye(this)
  }
  void goneSeatFull() { println &quot;[${tid()}]満席で立ち去る $name&quot; }
}

bb = new Barber()
bb.start()

b = new BarberShop(barber:bb)
(1..16).each {
  if (it == 9) {
    Thread.sleep(1200)
  }
  else {
    Thread.sleep(randomValue(0..200))
  }
  def c = new Customer(name:it)
  b.visit(c)
}

bb.join()
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9631/addtag/" class="addtag" id="addtag_9631">タグ</a>:
	
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/GPars/">GPars</a>
    
	&nbsp;

	
      [<a href="/web/20100712030912/http://ja.doukaku.org/lang/groovy/">
		Groovy
      </a>]
	  
      [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9631/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9631/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_9631"
  >-</span><span
  class="button yellow"
  id="rating_z_9631"
  >0</span><span 
  class="button green"
  id="rating_p_9631"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20100712030912/http://ja.doukaku.org/285/reply_to/9631/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment9632">
  <p class="banner"><a href="/web/20100712030912/http://ja.doukaku.org/user/588/" target="_top">sekia</a>

	
	&nbsp;
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9632/">#9632</a>(<script language="JavaScript">print_time(new Date("2009/10/13 15:11 GMT"));</script><noscript>2009/10/13 15:11 GMT</noscript>)
	
	
	
	[<a href="/web/20100712030912/http://ja.doukaku.org/lang/perl/">
	  Perl
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  
<p>Coroを使って疑似並列処理しました。
   ついでに実行時間[sec]も表示しています。
</p>
<pre><code>[Coro=HASH(0x81d3a0)] [0.000] 床屋、眠る
[Coro=HASH(0x810ad0)] [0.199] 来店 1
[Coro=HASH(0x81d3a0)] [0.199] 床屋、目覚める
[Coro=HASH(0x81d3a0)] [0.199] 散髪開始 1
[Coro=HASH(0x810ad0)] [0.310] 来店 2
[Coro=HASH(0x810ad0)] [0.466] 来店 3
[Coro=HASH(0x81d3a0)] [0.504] 散髪完了 1
[Coro=HASH(0x81d3a0)] [0.505] 散髪開始 2
[Coro=HASH(0x810ad0)] [0.574] 来店 4
[Coro=HASH(0x810ad0)] [0.765] 来店 5
[Coro=HASH(0x812ce0)] [0.765] 満席で立ち去る 5
[Coro=HASH(0x81d3a0)] [0.812] 散髪完了 2
[Coro=HASH(0x81d3a0)] [0.812] 散髪開始 3
[Coro=HASH(0x810ad0)] [0.930] 来店 6
[Coro=HASH(0x810ad0)] [0.969] 来店 7
[Coro=HASH(0x812bd0)] [0.969] 満席で立ち去る 7
[Coro=HASH(0x810ad0)] [1.101] 来店 8
[Coro=HASH(0x812c90)] [1.102] 満席で立ち去る 8
[Coro=HASH(0x81d3a0)] [1.186] 散髪完了 3
[Coro=HASH(0x81d3a0)] [1.186] 散髪開始 4
[Coro=HASH(0x81d3a0)] [1.374] 散髪完了 4
[Coro=HASH(0x81d3a0)] [1.374] 散髪開始 6
[Coro=HASH(0x81d3a0)] [1.618] 散髪完了 6
[Coro=HASH(0x81d3a0)] [1.618] 床屋、眠る
[Coro=HASH(0x810ad0)] [2.302] 来店 9
[Coro=HASH(0x81d3a0)] [2.302] 床屋、目覚める
[Coro=HASH(0x81d3a0)] [2.302] 散髪開始 9
[Coro=HASH(0x810ad0)] [2.312] 来店 10
[Coro=HASH(0x810ad0)] [2.475] 来店 11
[Coro=HASH(0x810ad0)] [2.494] 来店 12
[Coro=HASH(0x812df0)] [2.494] 満席で立ち去る 12
[Coro=HASH(0x810ad0)] [2.545] 来店 13
[Coro=HASH(0x812be0)] [2.545] 満席で立ち去る 13
[Coro=HASH(0x81d3a0)] [2.612] 散髪完了 9
[Coro=HASH(0x81d3a0)] [2.612] 散髪開始 10
[Coro=HASH(0x810ad0)] [2.687] 来店 14
[Coro=HASH(0x810ad0)] [2.862] 来店 15
[Coro=HASH(0x812e00)] [2.863] 満席で立ち去る 15
[Coro=HASH(0x81d3a0)] [2.878] 散髪完了 10
[Coro=HASH(0x81d3a0)] [2.878] 散髪開始 11
[Coro=HASH(0x81d3a0)] [3.034] 散髪完了 11
[Coro=HASH(0x81d3a0)] [3.034] 散髪開始 14
[Coro=HASH(0x810ad0)] [3.046] 来店 16
[Coro=HASH(0x81d3a0)] [3.248] 散髪完了 14
[Coro=HASH(0x81d3a0)] [3.248] 散髪開始 16
[Coro=HASH(0x81d3a0)] [3.547] 散髪完了 16
[Coro=HASH(0x81d3a0)] [3.547] 床屋、眠る
※16人のうち10人を散髪
</code></pre>


	</div>
	
	<p class="link">
	  参考: <a href="/web/20100712030912/http://search.cpan.org/~mlehmann/Coro-5.2/Coro.pm">Coro - search.cpan.org</a>
	</p>  
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86</pre></td><td class="code"><div class="highlight"><pre><span class="c1">#!/usr/bin/env perl</span>

<span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>
<span class="k">use</span> <span class="n">feature</span> <span class="n">qw</span><span class="sr">/say/</span><span class="p">;</span>
<span class="k">use</span> <span class="n">utf8</span><span class="p">;</span>

<span class="k">use</span> <span class="n">Coro</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Coro::</span><span class="n">Semaphore</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Time::</span><span class="n">HiRes</span> <span class="n">qw</span><span class="sr">/time/</span><span class="p">;</span>

<span class="k">sub </span><span class="nf">rand_int</span><span class="p">($$)</span> <span class="p">{</span>
  <span class="k">my</span> <span class="p">(</span><span class="nv">$min</span><span class="p">,</span> <span class="nv">$max</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
  <span class="nv">$min</span> <span class="o">+</span> <span class="nb">int</span> <span class="nb">rand</span> <span class="p">(</span><span class="nv">$max</span> <span class="o">-</span> <span class="nv">$min</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">{</span>
  <span class="k">my</span> <span class="nv">$start_time</span><span class="p">;</span>
  <span class="k">sub </span><span class="nf">init_time</span><span class="p">()</span> <span class="p">{</span> <span class="nv">$start_time</span> <span class="o">=</span> <span class="nb">time</span> <span class="p">}</span>
  <span class="k">sub </span><span class="nf">elapse</span><span class="p">()</span> <span class="p">{</span> <span class="nb">sprintf</span> <span class="s">&#39;%5.3f&#39;</span><span class="p">,</span> <span class="nb">time</span> <span class="o">-</span> <span class="nv">$start_time</span> <span class="p">}</span>
<span class="p">}</span>

<span class="nb">binmode</span> <span class="bp">STDOUT</span><span class="p">,</span> <span class="s">&#39;:utf8&#39;</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$free_seats</span> <span class="o">=</span> <span class="nn">Coro::</span><span class="n">Semaphore</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">$barber_awaken</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$all_customers_done</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$num_cut</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@customer_queue</span><span class="p">;</span>

<span class="n">init_time</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$barber</span> <span class="o">=</span> <span class="n">async</span> <span class="p">{</span>
  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">@customer_queue</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">unless</span> <span class="p">(</span><span class="nv">$barber_awaken</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$barber_awaken</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">say</span> <span class="s">&quot;[$Coro::current] [@{[elapse]}] 床屋、目覚める&quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">my</span> <span class="p">(</span><span class="nv">$customer</span><span class="p">,</span> <span class="nv">$cutting_done</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@</span><span class="p">{</span> <span class="nb">shift</span> <span class="nv">@customer_queue</span> <span class="p">};</span>
      <span class="k">my</span> <span class="nv">$wait_sec0</span> <span class="o">=</span> <span class="nb">time</span><span class="p">;</span>
      <span class="k">my</span> <span class="nv">$wait_sec</span> <span class="o">=</span> <span class="n">rand_int</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">;</span>
      <span class="n">say</span> <span class="s">&quot;[$Coro::current] [@{[elapse]}] 散髪開始 $customer&quot;</span><span class="p">;</span>
      <span class="n">cede</span> <span class="k">until</span> <span class="nb">time</span> <span class="o">-</span> <span class="nv">$wait_sec0</span> <span class="o">&gt;</span> <span class="nv">$wait_sec</span><span class="p">;</span>

      <span class="nv">$cutting_done</span><span class="o">-&gt;</span><span class="p">();</span>
      <span class="nv">$num_cut</span><span class="o">++</span><span class="p">;</span>
      <span class="n">say</span> <span class="s">&quot;[$Coro::current] [@{[elapse]}] 散髪完了 $customer&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span><span class="nv">$barber_awaken</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$barber_awaken</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">say</span> <span class="s">&quot;[$Coro::current] [@{[elapse]}] 床屋、眠る&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elsif</span><span class="p">(</span><span class="nv">$all_customers_done</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">last</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">cede</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="k">my</span> <span class="nv">@customers</span><span class="p">;</span>
<span class="k">for</span> <span class="k">my</span> <span class="nv">$i</span> <span class="p">(</span><span class="mi">1</span> <span class="o">..</span> <span class="mi">16</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">my</span> <span class="nv">$wait_sec0</span> <span class="o">=</span> <span class="nb">time</span><span class="p">;</span>
  <span class="k">my</span> <span class="nv">$wait_sec</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">==</span> <span class="mi">9</span> <span class="p">?</span> <span class="mi">1200</span> <span class="p">:</span> <span class="n">rand_int</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">;</span>
  <span class="n">cede</span> <span class="k">until</span> <span class="nb">time</span> <span class="o">-</span> <span class="nv">$wait_sec0</span> <span class="o">&gt;</span> <span class="nv">$wait_sec</span><span class="p">;</span>

  <span class="n">say</span> <span class="s">&quot;[$Coro::current] [@{[elapse]}] 来店 $i&quot;</span><span class="p">;</span>
  <span class="nb">push</span> <span class="nv">@customers</span><span class="p">,</span> <span class="n">async</span> <span class="p">{</span>
    <span class="k">unless</span> <span class="p">(</span><span class="nv">$free_seats</span><span class="o">-&gt;</span><span class="n">try</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">say</span> <span class="s">&quot;[$Coro::current] [@{[elapse]}] 満席で立ち去る $i&quot;</span><span class="p">;</span>
      <span class="n">terminate</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">my</span> <span class="nv">$cutting_done</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nb">push</span> <span class="nv">@customer_queue</span><span class="p">,</span> <span class="p">[</span><span class="nv">$i</span><span class="p">,</span>
                           <span class="k">sub </span><span class="p">{</span>
                             <span class="nv">$cutting_done</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                             <span class="nv">$free_seats</span><span class="o">-&gt;</span><span class="n">up</span><span class="p">;</span>
                           <span class="p">}];</span>
    <span class="n">cede</span> <span class="k">until</span> <span class="nv">$cutting_done</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="n">cede</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$_</span><span class="o">-&gt;</span><span class="nb">join</span> <span class="k">for</span> <span class="nv">@customers</span><span class="p">;</span>
<span class="nv">$all_customers_done</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$barber</span><span class="o">-&gt;</span><span class="nb">join</span><span class="p">;</span>
<span class="n">say</span> <span class="s">&quot;※16人のうち${num_cut}人を散髪&quot;</span><span class="p">;</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9632/addtag/" class="addtag" id="addtag_9632">タグ</a>:
	
	タグなし
	&nbsp;

	
      [<a href="/web/20100712030912/http://ja.doukaku.org/lang/perl/">
		Perl
      </a>]
	  
      [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9632/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9632/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_9632"
  >-</span><span
  class="button yellow"
  id="rating_z_9632"
  >0</span><span 
  class="button green"
  id="rating_p_9632"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20100712030912/http://ja.doukaku.org/285/reply_to/9632/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment9633">
  <p class="banner"><a href="/web/20100712030912/http://ja.doukaku.org/user/570/" target="_top">horiuchi</a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9633/">#9633</a>(<script language="JavaScript">print_time(new Date("2009/10/16 09:34 GMT"));</script><noscript>2009/10/16 09:34 GMT</noscript>)
	
	
	
	[<a href="/web/20100712030912/http://ja.doukaku.org/lang/java/">
	  Java
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <div class="section">
<p>せっかくの同期の問題だったので、java.util.concurrent パッケージのセマフォとBlockingQueueを使って実装してみました。</p>
<p>しかし、これBlockingQueueだけでも実装できるかな？</p>
</div>
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87</pre></td><td class="code"><div class="highlight"><pre><span class="k">import</span> <span class="nn">java.util.concurrent.BlockingQueue</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">java.util.concurrent.LinkedBlockingQueue</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">java.util.concurrent.Semaphore</span><span class="o">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Sample285</span> <span class="o">{</span>
    <span class="k">private</span> <span class="k">static</span> <span class="k">final</span> <span class="kt">int</span> <span class="n">SEAT_COUNT</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>

    <span class="k">private</span> <span class="k">final</span> <span class="n">Semaphore</span> <span class="n">semaphore_</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Semaphore</span><span class="o">(</span><span class="n">SEAT_COUNT</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
    <span class="k">private</span> <span class="k">final</span> <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">seat_</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedBlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;();</span>

    <span class="k">private</span> <span class="kt">int</span> <span class="n">counter_</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

    <span class="k">public</span> <span class="n">Sample285</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">public</span> <span class="kt">void</span> <span class="n">run</span><span class="o">()</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">synchronized</span> <span class="o">(</span><span class="n">seat_</span><span class="o">)</span> <span class="o">{</span>
                            <span class="k">if</span> <span class="o">(</span><span class="n">seat_</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
                                <span class="n">printMessage</span><span class="o">(</span><span class="s">&quot;床屋 寝る&quot;</span><span class="o">);</span>
                                <span class="k">while</span> <span class="o">(</span><span class="n">seat_</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
                                    <span class="n">seat_</span><span class="o">.</span><span class="na">wait</span><span class="o">();</span>
                                <span class="o">}</span>
                                <span class="n">printMessage</span><span class="o">(</span><span class="s">&quot;床屋、目覚める&quot;</span><span class="o">);</span>
                            <span class="o">}</span>
                        <span class="o">}</span>
                        <span class="n">Runnable</span> <span class="n">runnable</span> <span class="o">=</span> <span class="n">seat_</span><span class="o">.</span><span class="na">poll</span><span class="o">();</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">runnable</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                            <span class="n">runnable</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
                            <span class="n">counter_</span><span class="o">++;</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">},</span> <span class="s">&quot;Sleeping barber&quot;</span><span class="o">).</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="k">public</span> <span class="kt">int</span> <span class="n">getCounter</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">counter_</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="k">public</span> <span class="kt">void</span> <span class="nf">join</span><span class="o">()</span> <span class="k">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
        <span class="n">semaphore_</span><span class="o">.</span><span class="na">acquire</span><span class="o">(</span><span class="n">SEAT_COUNT</span><span class="o">);</span>
        <span class="n">Thread</span><span class="o">.</span><span class="na">yield</span><span class="o">();</span>
        <span class="n">semaphore_</span><span class="o">.</span><span class="na">release</span><span class="o">(</span><span class="n">SEAT_COUNT</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">public</span> <span class="kt">void</span> <span class="n">addGuest</span><span class="o">(</span><span class="k">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">printMessage</span><span class="o">(</span><span class="s">&quot;来店 &quot;</span> <span class="o">+</span> <span class="n">id</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">semaphore_</span><span class="o">.</span><span class="na">tryAcquire</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">printMessage</span><span class="o">(</span><span class="s">&quot;満席で立ち去る &quot;</span> <span class="o">+</span> <span class="n">id</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">seat_</span><span class="o">.</span><span class="na">offer</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">public</span> <span class="kt">void</span> <span class="n">run</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">printMessage</span><span class="o">(</span><span class="s">&quot;散髪開始 &quot;</span> <span class="o">+</span> <span class="n">id</span><span class="o">);</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">((</span><span class="kt">long</span><span class="o">)</span> <span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="mi">300</span> <span class="o">+</span> <span class="mi">100</span><span class="o">));</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="n">printMessage</span><span class="o">(</span><span class="s">&quot;散髪完了 &quot;</span> <span class="o">+</span> <span class="n">id</span><span class="o">);</span>
                <span class="n">semaphore_</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="k">synchronized</span> <span class="o">(</span><span class="n">seat_</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">seat_</span><span class="o">.</span><span class="na">notifyAll</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="k">private</span> <span class="k">static</span> <span class="kt">void</span> <span class="n">printMessage</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%d %s%n&quot;</span><span class="o">,</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getId</span><span class="o">(),</span> <span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="k">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="k">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">Sample285</span> <span class="n">barber</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Sample285</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">index</span> <span class="o">&lt;=</span> <span class="mi">16</span><span class="o">;</span> <span class="n">index</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">((</span><span class="n">index</span> <span class="o">==</span> <span class="mi">9</span><span class="o">)?</span> <span class="mi">1200</span><span class="o">:</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="mi">200</span><span class="o">));</span>
            <span class="n">barber</span><span class="o">.</span><span class="na">addGuest</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">barber</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%d人のうち %d人を散髪%n&quot;</span><span class="o">,</span> <span class="mi">16</span><span class="o">,</span> <span class="n">barber</span><span class="o">.</span><span class="na">getCounter</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9633/addtag/" class="addtag" id="addtag_9633">タグ</a>:
	
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/Java1.5/">Java1.5</a>
    
	&nbsp;

	
      [<a href="/web/20100712030912/http://ja.doukaku.org/lang/java/">
		Java
      </a>]
	  
      [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9633/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9633/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_9633"
  >-</span><span
  class="button yellow"
  id="rating_z_9633"
  >0</span><span 
  class="button green"
  id="rating_p_9633"
  >+</span></span></span>
  

<p>

  

  <a href="/web/20100712030912/http://ja.doukaku.org/comment/9633/">
    6
    replies
  </a>

  [<a href="/web/20100712030912/http://ja.doukaku.org/285/reply_to/9633/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment9634">
  <p class="banner"><a href="/web/20100712030912/http://ja.doukaku.org/user/1109/" target="_top">fgshun</a>

	
	&nbsp;
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9634/">#9634</a>(<script language="JavaScript">print_time(new Date("2009/10/17 00:12 GMT"));</script><noscript>2009/10/17 00:12 GMT</noscript>)
	
	
	
	[<a href="/web/20100712030912/http://ja.doukaku.org/lang/python/">
	  Python
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <p>Python 2.6 , 3.0 から加わった multiprocessing をつかってみました。 Python 2.6 で動作確認しています。</p>
<p>はじめは席を multiprocessing.Queue(maxsize=3) としていたのですが、これには中身を取り出さずにのぞき見る術がないのに気づきました。これでは「散髪用兼順番待ち用椅子」ではなくただの「順番待ち用椅子」であり、店に散髪中 1 人、待機 3 人の計 4 人の状態もありえる作りでした。</p>
<p>このため、席は Seats クラスとして作り直しています。客がいるかどうかは check メソッドで見ます。客の着席退席は sit, stand メソッドです。</p>
<p>1回目</p>
<pre class="literal-block">
[barber 1332] 床屋、眠る
[shop 1052] 来店 0
[shop 1052] 床屋を起こす 0
[barber 1332] 床屋、目覚める
[barber 1332] 散発開始 0
[shop 1052] 来店 1
[barber 1332] 散発終了 0
[barber 1332] 散発開始 1
[shop 1052] 来店 2
[shop 1052] 来店 3
[shop 1052] 来店 4
[shop 1052] 満席で立ち去る 4
[barber 1332] 散発終了 1
[barber 1332] 散発開始 2
[shop 1052] 来店 5
[shop 1052] 来店 6
[shop 1052] 満席で立ち去る 6
[barber 1332] 散発終了 2
[barber 1332] 散発開始 5
[shop 1052] 来店 7
[barber 1332] 散発終了 5
[barber 1332] 散発開始 7
[barber 1332] 散発終了 7
[barber 1332] 散発開始 3
[barber 1332] 散発終了 3
[barber 1332] 床屋、眠る
[shop 1052] 来店 8
[shop 1052] 床屋を起こす 8
[barber 1332] 床屋、目覚める
[barber 1332] 散発開始 8
[shop 1052] 来店 9
[shop 1052] 来店 10
[shop 1052] 来店 11
[shop 1052] 満席で立ち去る 11
[barber 1332] 散発終了 8
[barber 1332] 散発開始 9
[shop 1052] 来店 12
[shop 1052] 来店 13
[shop 1052] 満席で立ち去る 13
[shop 1052] 来店 14
[shop 1052] 満席で立ち去る 14
[shop 1052] 来店 15
[shop 1052] 満席で立ち去る 15
[barber 1332] 散発終了 9
[barber 1332] 散発開始 12
[barber 1332] 散発終了 12
[barber 1332] 散発開始 10
[barber 1332] 散発終了 10
[barber 1332] 床屋、眠る
</pre>
<p>2回目</p>
<pre class="literal-block">
[barber 2356] 床屋、眠る
[shop 2180] 来店 0
[shop 2180] 床屋を起こす 0
[barber 2356] 床屋、目覚める
[barber 2356] 散発開始 0
[shop 2180] 来店 1
[barber 2356] 散発終了 0
[barber 2356] 散発開始 1
[shop 2180] 来店 2
[shop 2180] 来店 3
[shop 2180] 来店 4
[shop 2180] 満席で立ち去る 4
[shop 2180] 来店 5
[shop 2180] 満席で立ち去る 5
[shop 2180] 来店 6
[shop 2180] 満席で立ち去る 6
[shop 2180] 来店 7
[shop 2180] 満席で立ち去る 7
[barber 2356] 散発終了 1
[barber 2356] 散発開始 2
[barber 2356] 散発終了 2
[barber 2356] 散発開始 3
[barber 2356] 散発終了 3
[barber 2356] 床屋、眠る
[shop 2180] 来店 8
[shop 2180] 床屋を起こす 8
[barber 2356] 床屋、目覚める
[barber 2356] 散発開始 8
[barber 2356] 散発終了 8
[barber 2356] 床屋、眠る
[shop 2180] 来店 9
[shop 2180] 床屋を起こす 9
[barber 2356] 床屋、目覚める
[barber 2356] 散発開始 9
[shop 2180] 来店 10
[shop 2180] 来店 11
[shop 2180] 来店 12
[shop 2180] 満席で立ち去る 12
[shop 2180] 来店 13
[shop 2180] 満席で立ち去る 13
[shop 2180] 来店 14
[barber 2356] 散発終了 9
[barber 2356] 散発開始 10
[shop 2180] 来店 15
[shop 2180] 満席で立ち去る 15
[barber 2356] 散発終了 10
[barber 2356] 散発開始 14
[barber 2356] 散発終了 14
[barber 2356] 散発開始 11
[barber 2356] 散発終了 11
[barber 2356] 床屋、眠る
</pre>

	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123</pre></td><td class="code"><div class="highlight"><pre><span class="c"># coding: utf-8</span>

<span class="k">from</span> <span class="nn">multiprocessing</span> <span class="k">import</span> \
        <span class="n">Process</span><span class="p">,</span> <span class="n">Queue</span><span class="p">,</span> <span class="n">Lock</span><span class="p">,</span> <span class="n">Event</span><span class="p">,</span> <span class="n">Array</span><span class="p">,</span> <span class="n">current_process</span>
<span class="k">from</span> <span class="nn">Queue</span> <span class="k">import</span> <span class="n">Empty</span>
<span class="k">import</span> <span class="nn">time</span>
<span class="k">import</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">barber</span><span class="p">(</span><span class="n">seats</span><span class="p">,</span> <span class="n">output_data</span><span class="p">,</span> <span class="n">barber_waking</span><span class="p">):</span>
    <span class="n">pid</span> <span class="o">=</span> <span class="n">current_process</span><span class="p">()</span><span class="o">.</span><span class="n">pid</span>

    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">seat_num</span><span class="p">,</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">seats</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">SeatsEmpty</span><span class="p">:</span>
            <span class="n">seat_num</span><span class="p">,</span> <span class="n">customer</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">customer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">output_data</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">u&quot;[barber </span><span class="si">%d</span><span class="s">] 散発開始 </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">customer</span><span class="p">))</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span>
            <span class="n">output_data</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">u&quot;[barber </span><span class="si">%d</span><span class="s">] 散発終了 </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">customer</span><span class="p">))</span>
            <span class="n">seats</span><span class="o">.</span><span class="n">stand</span><span class="p">(</span><span class="n">seat_num</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># 客がいないので寝る</span>
            <span class="n">barber_waking</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">output_data</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">u&quot;[barber </span><span class="si">%d</span><span class="s">] 床屋、眠る&quot;</span> <span class="o">%</span> <span class="n">pid</span><span class="p">)</span>
            <span class="n">barber_waking</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span> <span class="c"># 寝た</span>
            <span class="c"># 起こされた</span>
            <span class="n">output_data</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">u&quot;[barber </span><span class="si">%d</span><span class="s">] 床屋、目覚める&quot;</span> <span class="o">%</span> <span class="n">pid</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">shop</span><span class="p">(</span><span class="n">seats</span><span class="p">,</span> <span class="n">output_data</span><span class="p">,</span> <span class="n">barber_waking</span><span class="p">):</span>
    <span class="n">pid</span> <span class="o">=</span> <span class="n">current_process</span><span class="p">()</span><span class="o">.</span><span class="n">pid</span>

    <span class="k">for</span> <span class="n">customer</span> <span class="ow">in</span>  <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">output_data</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">u&quot;[shop </span><span class="si">%d</span><span class="s">] 来店 </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">customer</span><span class="p">))</span>
            <span class="n">seats</span><span class="o">.</span><span class="n">sit</span><span class="p">(</span><span class="n">customer</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">SeatsFull</span><span class="p">:</span>
            <span class="n">output_data</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">u&quot;[shop </span><span class="si">%d</span><span class="s">] 満席で立ち去る </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">pid</span><span class="p">,</span> <span class="n">customer</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">barber_waking</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
                <span class="n">output_data</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">u&quot;[shop </span><span class="si">%d</span><span class="s">] 床屋を起こす </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">pid</span><span class="p">,</span> <span class="n">customer</span><span class="p">))</span>
            <span class="n">barber_waking</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">customer</span> <span class="o">!=</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1200</span><span class="p">,</span> <span class="mi">1400</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">SeatsEmpty</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">SeatsFull</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Seats</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="c"># seats には客の id  (&gt;= 0) が入る。負の値は空席を意味する</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seats</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">lock</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">u&quot;&quot;&quot;客がいるかどうか見る</span>
<span class="s">        </span>
<span class="s">        客がいなければ SeatsEmpty 例外を送出する。&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">seat_num</span><span class="p">,</span> <span class="n">customer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seats</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">customer</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">seat_num</span><span class="p">,</span> <span class="n">customer</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SeatsEmpty</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">sit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">customer</span><span class="p">):</span>
        <span class="s">u&quot;&quot;&quot;客を空席に座らせる</span>
<span class="s">        </span>
<span class="s">        空席がない場合 SeatsFull 例外を送出する。&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">seat_num</span><span class="p">,</span> <span class="n">seat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seats</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">seat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="n">seat_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">customer</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SeatsFull</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">stand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seat_num</span><span class="p">):</span>
        <span class="s">u&quot;&quot;&quot;seat_num 番目の席に座っている客に席を立たせる&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="n">seat_num</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seats</span><span class="p">[</span><span class="n">seat_num</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">seats</span> <span class="o">=</span> <span class="n">Seats</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c"># 席</span>
    <span class="n">output_data</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span> <span class="c"># 出力バッファ</span>
    <span class="c"># 出力を別プロセスもしくは親プロセスで</span>
    <span class="n">barber_waking</span> <span class="o">=</span> <span class="n">Event</span><span class="p">()</span> <span class="c"># 床屋が起きているか</span>
    <span class="n">barber_waking</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

    <span class="n">process_shop</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span>
            <span class="n">target</span><span class="o">=</span><span class="n">shop</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">seats</span><span class="p">,</span> <span class="n">output_data</span><span class="p">,</span> <span class="n">barber_waking</span><span class="p">))</span>
    <span class="n">process_barber</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span>
            <span class="n">target</span><span class="o">=</span><span class="n">barber</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">seats</span><span class="p">,</span> <span class="n">output_data</span><span class="p">,</span> <span class="n">barber_waking</span><span class="p">))</span>

    <span class="n">process_barber</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">process_shop</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">process_shop</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span> <span class="ow">or</span>
           <span class="n">barber_waking</span><span class="o">.</span><span class="n">is_set</span><span class="p">()</span> <span class="ow">or</span>
           <span class="ow">not</span> <span class="n">output_data</span><span class="o">.</span><span class="n">empty</span><span class="p">()):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">output_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Empty</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="n">process_barber</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
    <span class="n">process_barber</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9634/addtag/" class="addtag" id="addtag_9634">タグ</a>:
	
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/Python2.6/">Python2.6</a>
    
	&nbsp;

	
      [<a href="/web/20100712030912/http://ja.doukaku.org/lang/python/">
		Python
      </a>]
	  
      [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9634/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9634/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_9634"
  >-</span><span
  class="button yellow"
  id="rating_z_9634"
  >0</span><span 
  class="button green"
  id="rating_p_9634"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20100712030912/http://ja.doukaku.org/285/reply_to/9634/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment9635">
  <p class="banner"><a href="/web/20100712030912/http://ja.doukaku.org/user/766/" target="_top">syat</a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9635/">#9635</a>(<script language="JavaScript">print_time(new Date("2009/10/17 00:22 GMT"));</script><noscript>2009/10/17 00:22 GMT</noscript>)
	
	
	
	[<a href="/web/20100712030912/http://ja.doukaku.org/lang/javascript/">
	  JavaScript
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  JavaScriptで。マルチスレッドライブラリのConcurrent.Threadを使用しました。<br/>床屋と客の2スレッド構成です。スレッドIDに相当するものはない（と思う）ので、自分で付けました。<br/>寝ていますフラグがないと、床屋が起きているときに&nbsp;notify&nbsp;が飛んで、床屋の機嫌を損ねて（＝エラー終了）しまいます。<br/>＜実行例＞<br/>[床屋]&nbsp;床屋、眠る<br/>[&nbsp;客&nbsp;]&nbsp;来店&nbsp;1<br/>[床屋]&nbsp;床屋、目覚める<br/>[床屋]&nbsp;散髪開始&nbsp;1<br/>[&nbsp;客&nbsp;]&nbsp;来店&nbsp;2<br/>[&nbsp;客&nbsp;]&nbsp;来店&nbsp;3<br/>[床屋]&nbsp;散髪完了&nbsp;1<br/>[床屋]&nbsp;散髪開始&nbsp;2<br/>[床屋]&nbsp;散髪完了&nbsp;2<br/>[床屋]&nbsp;散髪開始&nbsp;3<br/>[&nbsp;客&nbsp;]&nbsp;来店&nbsp;4<br/>[&nbsp;客&nbsp;]&nbsp;来店&nbsp;5<br/>[&nbsp;客&nbsp;]&nbsp;来店&nbsp;6<br/>[&nbsp;客&nbsp;]&nbsp;満席で立ち去る&nbsp;6<br/>[床屋]&nbsp;散髪完了&nbsp;3<br/>[床屋]&nbsp;散髪開始&nbsp;4<br/>[&nbsp;客&nbsp;]&nbsp;来店&nbsp;7<br/>[&nbsp;客&nbsp;]&nbsp;来店&nbsp;8<br/>[&nbsp;客&nbsp;]&nbsp;満席で立ち去る&nbsp;8<br/>[床屋]&nbsp;散髪完了&nbsp;4<br/>[床屋]&nbsp;散髪開始&nbsp;5<br/>[床屋]&nbsp;散髪完了&nbsp;5<br/>[床屋]&nbsp;散髪開始&nbsp;7<br/>[床屋]&nbsp;散髪完了&nbsp;7<br/>[床屋]&nbsp;床屋、眠る<br/>[&nbsp;客&nbsp;]&nbsp;来店&nbsp;9<br/>[床屋]&nbsp;床屋、目覚める<br/>[床屋]&nbsp;散髪開始&nbsp;9<br/>[&nbsp;客&nbsp;]&nbsp;来店&nbsp;10<br/>[&nbsp;客&nbsp;]&nbsp;来店&nbsp;11<br/>[&nbsp;客&nbsp;]&nbsp;来店&nbsp;12<br/>[&nbsp;客&nbsp;]&nbsp;満席で立ち去る&nbsp;12<br/>[床屋]&nbsp;散髪完了&nbsp;9<br/>[床屋]&nbsp;散髪開始&nbsp;10<br/>[&nbsp;客&nbsp;]&nbsp;来店&nbsp;13<br/>[&nbsp;客&nbsp;]&nbsp;来店&nbsp;14<br/>[&nbsp;客&nbsp;]&nbsp;満席で立ち去る&nbsp;14<br/>[&nbsp;客&nbsp;]&nbsp;来店&nbsp;15<br/>[&nbsp;客&nbsp;]&nbsp;満席で立ち去る&nbsp;15<br/>[床屋]&nbsp;散髪完了&nbsp;10<br/>[床屋]&nbsp;散髪開始&nbsp;11<br/>[&nbsp;客&nbsp;]&nbsp;来店&nbsp;16<br/>[床屋]&nbsp;散髪完了&nbsp;11<br/>[床屋]&nbsp;散髪開始&nbsp;13<br/>[床屋]&nbsp;散髪完了&nbsp;13<br/>[床屋]&nbsp;散髪開始&nbsp;16<br/>[床屋]&nbsp;散髪完了&nbsp;16<br/>[床屋]&nbsp;床屋、眠る<br/>
	</div>
	
	<p class="link">
	  参考: <a href="/web/20100712030912/http://www.infoq.com/jp/articles/js_multithread">JavaScriptへのマルチスレッド・プログラミングの導入</a>
	</p>  
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre></td><td class="code"><div class="highlight"><pre><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;Concurrent.Thread-full-20090713.js&quot;</span><span class="o">&gt;&lt;/</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span><span class="o">&gt;</span>
<span class="k">var</span> <span class="nx">queue</span> <span class="o">=</span> <span class="p">[];</span>                 <span class="c">//客行列</span>
<span class="k">var</span> <span class="nx">barber</span><span class="o">;</span>                     <span class="c">//床屋スレッド</span>
<span class="k">var</span> <span class="nx">customer</span><span class="o">;</span>                   <span class="c">//客スレッド</span>
<span class="k">var</span> <span class="nx">barber_is_sleeping</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="c">//寝ていますフラグ</span>

<span class="c">//床屋スレッド本体</span>
<span class="k">var</span> <span class="nx">barber_func</span> <span class="o">=</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">queue</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">cust</span> <span class="o">=</span> <span class="nx">queue</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="nx">log</span><span class="p">(</span><span class="nx">barber</span><span class="o">,</span> <span class="s2">&quot;散髪開始 &quot;</span> <span class="o">+</span> <span class="nx">cust</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
      <span class="nx">Concurrent</span><span class="p">.</span><span class="nx">Thread</span><span class="p">.</span><span class="nx">sleep</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">300</span><span class="o">+</span><span class="mi">100</span><span class="p">);</span>
      <span class="nx">log</span><span class="p">(</span><span class="nx">barber</span><span class="o">,</span> <span class="s2">&quot;散髪完了 &quot;</span> <span class="o">+</span> <span class="nx">cust</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
      <span class="nx">queue</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="nx">log</span><span class="p">(</span><span class="nx">barber</span><span class="o">,</span> <span class="s2">&quot;床屋、眠る&quot;</span><span class="p">);</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">barber_is_sleeping</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
      <span class="nx">stop</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">ex</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">log</span><span class="p">(</span><span class="nx">barber</span><span class="o">,</span> <span class="s2">&quot;床屋、目覚める&quot;</span><span class="p">);</span>
      <span class="nx">barber_is_sleeping</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="c">//客スレッド本体</span>
<span class="k">var</span> <span class="nx">customer_func</span> <span class="o">=</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="nx">count</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">count</span><span class="o">++;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">count</span> <span class="o">!=</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">Concurrent</span><span class="p">.</span><span class="nx">Thread</span><span class="p">.</span><span class="nx">sleep</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">200</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">Concurrent</span><span class="p">.</span><span class="nx">Thread</span><span class="p">.</span><span class="nx">sleep</span><span class="p">(</span><span class="mi">1200</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">log</span><span class="p">(</span><span class="nx">customer</span><span class="o">,</span> <span class="s2">&quot;来店 &quot;</span> <span class="o">+</span> <span class="nx">count</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">queue</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">log</span><span class="p">(</span><span class="nx">customer</span><span class="o">,</span> <span class="s2">&quot;満席で立ち去る &quot;</span> <span class="o">+</span> <span class="nx">count</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">queue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">count</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">barber_is_sleeping</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">barber</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="s2">&quot;wake!&quot;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">yield</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="c">//ログ出力</span>
<span class="k">function</span> <span class="nx">log</span><span class="p">(</span><span class="nx">t</span><span class="o">,</span> <span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;result&#39;</span><span class="p">);</span>
  <span class="nx">o</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="nx">t</span><span class="p">.</span><span class="nx">ID</span> <span class="o">+</span> <span class="s1">&#39;] &#39;</span> <span class="o">+</span> <span class="nx">s</span> <span class="o">+</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="o">;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">barber</span> <span class="o">=</span> <span class="nx">Concurrent</span><span class="p">.</span><span class="nx">Thread</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">barber_func</span><span class="p">);</span>
  <span class="nx">barber</span><span class="p">.</span><span class="nx">ID</span> <span class="o">=</span> <span class="s2">&quot;床屋&quot;</span><span class="o">;</span>
  <span class="nx">customer</span> <span class="o">=</span> <span class="nx">Concurrent</span><span class="p">.</span><span class="nx">Thread</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">customer_func</span><span class="p">);</span>
  <span class="nx">customer</span><span class="p">.</span><span class="nx">ID</span> <span class="o">=</span> <span class="s2">&quot; 客 &quot;</span><span class="o">;</span>
<span class="p">}</span>
<span class="o">&lt;/</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="nx">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">body</span> <span class="nx">onload</span><span class="o">=</span><span class="s2">&quot;init();&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;result&quot;</span><span class="o">&gt;&lt;/</span><span class="nx">div</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="nx">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="nx">html</span><span class="o">&gt;</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9635/addtag/" class="addtag" id="addtag_9635">タグ</a>:
	
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/Concurrent.Thread/">Concurrent.Thread</a>
    
	&nbsp;

	
      [<a href="/web/20100712030912/http://ja.doukaku.org/lang/javascript/">
		JavaScript
      </a>]
	  
      [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9635/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9635/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_9635"
  >-</span><span
  class="button yellow"
  id="rating_z_9635"
  >0</span><span 
  class="button green"
  id="rating_p_9635"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20100712030912/http://ja.doukaku.org/285/reply_to/9635/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment9638">
  <p class="banner"><a href="/web/20100712030912/http://ja.doukaku.org/user/4/" target="_top">匿名</a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9638/">#9638</a>(<script language="JavaScript">print_time(new Date("2009/10/18 10:33 GMT"));</script><noscript>2009/10/18 10:33 GMT</noscript>)
	
	
	
	[<a href="/web/20100712030912/http://ja.doukaku.org/lang/scala/">
	  Scala
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <p>Scala Actorで実装しました。考え方を理解するのに苦労しましたが、シンプルにできたと思います。</p>

	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></td><td class="code"><div class="highlight"><pre>import scala.actors._
import scala.actors.Actor._
import scala.util._

object Log {
    def apply(msg:String, id:Any):Unit = printf(&quot;[%d] %s %s\n&quot;, currentThread.getId, msg, id)
    def apply(msg:String):Unit = apply(msg, &quot;&quot;)
}

object SleepingBarber {
    object Close
    def main(args : Array[String]) : Unit = {
        val barber = self
        var entered = 0
        var result = 0
        var chair = 3
        val owner = actor {
              var sleeping = false
              def wakeup = { sleeping = false; Log(&quot;床屋、目覚める &quot;) }
              def sleep = { sleeping = true; Log(&quot;床屋、眠る &quot;) }
              sleep
              loop {
                  receive {
                        case id:Int =&gt; {
                            if (sleeping) wakeup
                            Log(&quot;散髪開始&quot;, id)
                            Thread.sleep((Math.random * 300).toInt + 100)
                            Log(&quot;散髪完了&quot;, id)
                            if (mailboxSize == 0) sleep
                            result += 1
                            reply(id)
                        }
                        case Close =&gt; exit
                  }
            }
        }
        val visitors = 1 to 16
        visitors.foreach { id =&gt;
              Thread.sleep(if (id == 9) 1200 else (Math.random * 200).toInt)
              Log(&quot;来店&quot;, id)
              entered += 1
            if (chair == 0) {
                Log(&quot;満席で立ち去る &quot;, id)
                    barber ! id
            } else {
                chair -= 1
                actor {
                    owner !? id
                        chair += 1
                        barber ! id
                }
            }
        }
         visitors.foreach { id =&gt; receive { case vid if vid == id =&gt; /*join*/ } }
        owner ! Close
        printf(&quot;※ %d人のうち %d人を散髪 \n&quot;, entered, result)
    }
}
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9638/addtag/" class="addtag" id="addtag_9638">タグ</a>:
	
	タグなし
	&nbsp;

	
      [<a href="/web/20100712030912/http://ja.doukaku.org/lang/scala/">
		Scala
      </a>]
	  
      [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9638/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9638/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_9638"
  >-</span><span
  class="button yellow"
  id="rating_z_9638"
  >0</span><span 
  class="button green"
  id="rating_p_9638"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20100712030912/http://ja.doukaku.org/285/reply_to/9638/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment9642">
  <p class="banner"><a href="/web/20100712030912/http://ja.doukaku.org/user/1111/" target="_top">hoge</a>

	
	&nbsp;
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9642/">#9642</a>(<script language="JavaScript">print_time(new Date("2009/10/24 14:55 GMT"));</script><noscript>2009/10/24 14:55 GMT</noscript>)
	
	
	
	[<a href="/web/20100712030912/http://ja.doukaku.org/lang/c/">
	  C
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>　Win32API&amp;VC++で。参照先のWikipediaの擬似コードに忠実にしたつもりが、かなり泥臭くなってしまいました。
エラー処理とか書いてたら何行になるやら。

＜実行結果＞
[ThreadID,     Time] イベント
[   0xe74,      0ms] 床屋、眠る
[   0x114,    187ms] 来店 1(空き席数=3)
[   0xe74,    187ms] 床屋、目覚める
[   0xe74,    187ms] 散髪開始 1
[   0x548,    218ms] 来店 2(空き席数=2)
[   0xe74,    297ms] 散髪終了 1
[   0xe74,    297ms] 散髪開始 2
[   0x1fc,    422ms] 来店 3(空き席数=2)
[   0xe74,    578ms] 散髪終了 2
[   0xe74,    578ms] 散髪開始 3
[   0xa04,    609ms] 来店 4(空き席数=2)
[   0xe74,    750ms] 散髪終了 3
[   0xe74,    750ms] 散髪開始 4
[   0xbec,    765ms] 来店 5(空き席数=2)
[   0xe90,    890ms] 来店 6(空き席数=1)
[   0xeb0,   1078ms] 来店 7(空き席数=0)
[   0xeb0,   1078ms] 満席で立ち去る 7
[   0xe74,   1093ms] 散髪終了 4
[   0xe74,   1093ms] 散髪開始 5
[   0x150,   1203ms] 来店 8(空き席数=1)
[   0xe74,   1375ms] 散髪終了 5
[   0xe74,   1375ms] 散髪開始 6
[   0xe74,   1625ms] 散髪終了 6
[   0xe74,   1625ms] 散髪開始 8
[   0xe74,   1843ms] 散髪終了 8
[   0xe74,   1843ms] 床屋、眠る
[   0x380,   2406ms] 来店 9(空き席数=3)
[   0xe74,   2406ms] 床屋、目覚める
[   0xe74,   2406ms] 散髪開始 9
[   0x618,   2500ms] 来店 10(空き席数=2)
[   0xc80,   2687ms] 来店 11(空き席数=1)
[   0xe74,   2781ms] 散髪終了 9
[   0xe74,   2781ms] 散髪開始 10
[   0xaac,   2859ms] 来店 12(空き席数=1)
[   0x310,   2968ms] 来店 13(空き席数=0)
[   0x310,   2968ms] 満席で立ち去る 13
[   0x790,   3125ms] 来店 14(空き席数=0)
[   0x790,   3125ms] 満席で立ち去る 14
[   0xe74,   3140ms] 散髪終了 10
[   0xe74,   3140ms] 散髪開始 11
[   0xa24,   3312ms] 来店 15(空き席数=1)
[   0xe04,   3390ms] 来店 16(空き席数=0)
[   0xe04,   3390ms] 満席で立ち去る 16
[   0xe74,   3468ms] 散髪終了 11
[   0xe74,   3468ms] 散髪開始 12
[   0xe74,   3625ms] 散髪終了 12
[   0xe74,   3625ms] 散髪開始 15
[   0xe74,   3984ms] 散髪終了 15
[   0xe74,   3984ms] 床屋、眠る
16人のうち 12人を散髪</pre>
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239</pre></td><td class="code"><div class="highlight"><pre><span class="cp">#include &lt;windows.h&gt;</span>
<span class="cp">#include &lt;process.h&gt;</span>
<span class="cp">#include &lt;stdio.h&gt;</span>

<span class="cp">#define NUMBER_OF_CUSTOMERS                     (16)</span>
<span class="cp">#define NUMBER_OF_SEATS                         (3)</span>
<span class="cp">#define HAIRCUT_INTERVAL_FROM                   (100)</span>
<span class="cp">#define HAIRCUT_INTERVAL_TO                     (300+HAIRCUT_INTERVAL_FROM)</span>
<span class="cp">#define HAIRCUT_INTERVAL                        (GetInterval(HAIRCUT_INTERVAL_FROM,HAIRCUT_INTERVAL_TO))</span>
<span class="cp">#define CUSTOMER_INTERVAL_FROM                  (0)</span>
<span class="cp">#define CUSTOMER_INTERVAL_TO                    (200+CUSTOMER_INTERVAL_FROM)</span>
<span class="cp">#define CUSTOMER_INTERVAL                       (GetInterval(CUSTOMER_INTERVAL_FROM,CUSTOMER_INTERVAL_TO))</span>
<span class="cp">#define CUSTOMER_9TH_INTERVAL_FROM              (1200)</span>
<span class="cp">#define CUSTOMER_9TH_INTERVAL_TO                (0+CUSTOMER_9TH_INTERVAL_FROM)</span>
<span class="cp">#define CUSTOMER_9TH_INTERVAL                   (GetInterval(CUSTOMER_9TH_INTERVAL_FROM,CUSTOMER_9TH_INTERVAL_TO))</span>
<span class="cp">#define OUTPUT                                  OutputMessage</span>

<span class="n">HANDLE</span> <span class="n">hBarbar</span><span class="p">;</span> <span class="c">/* 床屋の手が空くまで待機するためのセマフォ */</span>
<span class="n">HANDLE</span> <span class="n">hCustomers</span><span class="p">;</span> <span class="c">/* 来客まで待機するためのセマフォ */</span>
<span class="n">CRITICAL_SECTION</span> <span class="n">csAccessThreadData</span><span class="p">;</span>
<span class="n">CRITICAL_SECTION</span> <span class="n">csAccessSeats</span><span class="p">;</span>
<span class="n">HANDLE</span> <span class="n">hBeginHairCut</span><span class="p">;</span> <span class="c">/* 散髪開始イベント */</span>
<span class="n">HANDLE</span> <span class="n">hEndHairCut</span><span class="p">;</span> <span class="c">/* 散髪終了イベント */</span>
<span class="n">HANDLE</span> <span class="n">hCloseBarbar</span><span class="p">;</span> <span class="c">/* 閉店イベント */</span>
<span class="n">INT</span> <span class="n">iNumberOfFreeSeats</span><span class="o">=</span><span class="n">NUMBER_OF_SEATS</span><span class="p">;</span> <span class="c">/* 空き席数 */</span>
<span class="n">INT</span> <span class="n">iCurrentCustomerID</span><span class="p">;</span> <span class="c">/* 散髪中の客のID */</span>
<span class="n">INT</span> <span class="n">iNumberOfCustomersHairCut</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="c">/* 散髪した人数 */</span>
<span class="n">DWORD</span> <span class="n">dwOpenTime</span><span class="p">;</span>
<span class="n">HANDLE</span> <span class="n">hBarbarThread</span><span class="p">;</span><span class="c">/* 床屋(店主)のスレッド */</span>
<span class="n">HANDLE</span> <span class="n">hCustomerThreads</span><span class="p">[</span><span class="n">NUMBER_OF_CUSTOMERS</span><span class="p">];</span> <span class="c">/* 客のスレッド */</span>

<span class="n">DWORD</span> <span class="nf">GetTime</span><span class="p">(</span><span class="n">VOID</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c">/* 経過時間を返す。 */</span>
    <span class="k">return</span> <span class="n">GetTickCount</span><span class="p">()</span><span class="o">-</span><span class="n">dwOpenTime</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">INT</span> <span class="nf">GetInterval</span><span class="p">(</span><span class="n">INT</span> <span class="n">iFrom</span><span class="p">,</span><span class="n">INT</span> <span class="n">iTo</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c">/* 待機時間を返す。 */</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">INT</span><span class="p">)(</span><span class="n">iFrom</span><span class="o">+</span><span class="p">(</span><span class="n">DOUBLE</span><span class="p">)(</span><span class="n">iTo</span><span class="o">-</span><span class="n">iFrom</span><span class="p">)</span><span class="o">*</span><span class="n">rand</span><span class="p">()</span><span class="o">/</span><span class="n">RAND_MAX</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">VOID</span> <span class="nf">OutputMessage</span><span class="p">(</span><span class="n">LPCSTR</span> <span class="n">lpszFormat</span><span class="p">,...)</span>
<span class="p">{</span>
    <span class="n">va_list</span> <span class="n">va</span><span class="p">;</span>
    <span class="n">CHAR</span><span class="o">*</span> <span class="n">lpBuffer</span><span class="p">;</span>
    <span class="n">size_t</span> <span class="n">cbBufferSize</span><span class="p">;</span>

    <span class="n">va_start</span><span class="p">(</span><span class="n">va</span><span class="p">,</span><span class="n">lpszFormat</span><span class="p">);</span>
    <span class="n">cbBufferSize</span><span class="o">=</span><span class="n">_vscprintf</span><span class="p">(</span><span class="n">lpszFormat</span><span class="p">,</span><span class="n">va</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">lpBuffer</span><span class="o">=</span><span class="n">_alloca</span><span class="p">(</span><span class="n">cbBufferSize</span><span class="p">);</span>
    <span class="n">vsprintf_s</span><span class="p">(</span><span class="n">lpBuffer</span><span class="p">,</span><span class="n">cbBufferSize</span><span class="p">,</span><span class="n">lpszFormat</span><span class="p">,</span><span class="n">va</span><span class="p">);</span>
    <span class="n">va_end</span><span class="p">(</span><span class="n">va</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;[%#*lx, %6lums] %s</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">DWORD</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="n">GetCurrentThreadId</span><span class="p">(),</span><span class="n">GetTime</span><span class="p">(),</span><span class="n">lpBuffer</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">VOID</span> <span class="nf">WaitForHairCut</span><span class="p">(</span><span class="n">CRITICAL_SECTION</span><span class="o">*</span> <span class="n">lpcsAccessSeats</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c">/* Win32APIの待機関数は、呼ばれた順番で実行権を渡してくれないので修正する。 */</span>
    <span class="k">static</span> <span class="n">DWORD</span> <span class="n">dwThreadQueue</span><span class="p">[</span><span class="n">NUMBER_OF_CUSTOMERS</span><span class="p">];</span>
    <span class="k">static</span> <span class="n">INT</span> <span class="n">iQueueIndex</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">static</span> <span class="n">INT</span> <span class="n">iCustomerIndex</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">DWORD</span> <span class="n">dwThreadID</span><span class="o">=</span><span class="n">GetCurrentThreadId</span><span class="p">();</span>

    <span class="n">EnterCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csAccessThreadData</span><span class="p">);</span>
    <span class="n">dwThreadQueue</span><span class="p">[</span><span class="n">iQueueIndex</span><span class="o">++</span><span class="p">]</span><span class="o">=</span><span class="n">dwThreadID</span><span class="p">;</span>
    <span class="n">LeaveCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csAccessThreadData</span><span class="p">);</span>
    <span class="n">LeaveCriticalSection</span><span class="p">(</span><span class="n">lpcsAccessSeats</span><span class="p">);</span>

    <span class="k">while</span><span class="p">(</span><span class="n">TRUE</span><span class="p">){</span>
        <span class="n">WaitForSingleObject</span><span class="p">(</span><span class="n">hBarbar</span><span class="p">,</span><span class="n">INFINITE</span><span class="p">);</span>

        <span class="n">EnterCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csAccessThreadData</span><span class="p">);</span>
        <span class="kr">__try</span><span class="p">{</span>
            <span class="c">/* 順番通りに呼ばれていれば、ループを抜ける。 */</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dwThreadID</span><span class="o">==</span><span class="n">dwThreadQueue</span><span class="p">[</span><span class="n">iCustomerIndex</span><span class="p">]){</span>
                <span class="n">iCustomerIndex</span><span class="o">++</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">ReleaseSemaphore</span><span class="p">(</span><span class="n">hBarbar</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
        <span class="p">}</span><span class="kr">__finally</span><span class="p">{</span>
            <span class="n">LeaveCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csAccessThreadData</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">DWORD</span> <span class="n">CALLBACK</span> <span class="nf">BarbarThread</span><span class="p">(</span><span class="n">LPVOID</span> <span class="n">lpParam</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">HANDLE</span> <span class="n">hEvents</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="n">hCustomers</span><span class="p">,</span> <span class="p">(</span><span class="n">HANDLE</span><span class="p">)</span><span class="n">lpParam</span><span class="p">};</span>
    <span class="n">DWORD</span> <span class="n">dwResult</span><span class="p">;</span>

    <span class="k">while</span><span class="p">(</span><span class="n">TRUE</span><span class="p">){</span>
        <span class="c">/* 客がいるか調べる。 */</span>
        <span class="n">dwResult</span><span class="o">=</span><span class="n">WaitForMultipleObjects</span><span class="p">(</span><span class="n">_countof</span><span class="p">(</span><span class="n">hEvents</span><span class="p">),</span><span class="n">hEvents</span><span class="p">,</span><span class="n">FALSE</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="n">dwResult</span><span class="o">!=</span><span class="n">WAIT_OBJECT_0</span><span class="p">){</span>
            <span class="c">/* いなければ寝る。 */</span>
            <span class="n">OUTPUT</span><span class="p">(</span><span class="s">&quot;床屋、眠る&quot;</span><span class="p">);</span>

            <span class="c">/* もう、客が来ないなら店を閉める。 */</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dwResult</span><span class="o">==</span><span class="n">WAIT_OBJECT_0</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">if</span><span class="p">(</span><span class="n">WaitForMultipleObjects</span><span class="p">(</span><span class="n">_countof</span><span class="p">(</span><span class="n">hEvents</span><span class="p">),</span><span class="n">hEvents</span><span class="p">,</span><span class="n">FALSE</span><span class="p">,</span><span class="n">INFINITE</span><span class="p">)</span><span class="o">==</span><span class="n">WAIT_OBJECT_0</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="n">dwResult</span><span class="o">==</span><span class="n">WAIT_TIMEOUT</span><span class="p">)</span>
            <span class="n">OUTPUT</span><span class="p">(</span><span class="s">&quot;床屋、目覚める&quot;</span><span class="p">);</span>

        <span class="c">/* 散髪する客を1人選ぶ。 */</span>
        <span class="n">ReleaseSemaphore</span><span class="p">(</span><span class="n">hBarbar</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>

        <span class="c">/* 散髪開始。 */</span>
        <span class="n">WaitForSingleObject</span><span class="p">(</span><span class="n">hBeginHairCut</span><span class="p">,</span><span class="n">INFINITE</span><span class="p">);</span>
        <span class="n">OUTPUT</span><span class="p">(</span><span class="s">&quot;散髪開始 %d&quot;</span><span class="p">,</span><span class="n">iCurrentCustomerID</span><span class="p">);</span>
        <span class="n">Sleep</span><span class="p">(</span><span class="n">HAIRCUT_INTERVAL</span><span class="p">);</span>

        <span class="c">/* 散髪終了。 */</span>
        <span class="n">SetEvent</span><span class="p">(</span><span class="n">hEndHairCut</span><span class="p">);</span>

        <span class="n">EnterCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csAccessSeats</span><span class="p">);</span>
        <span class="n">OUTPUT</span><span class="p">(</span><span class="s">&quot;散髪終了 %d&quot;</span><span class="p">,</span><span class="n">iCurrentCustomerID</span><span class="p">);</span>
        <span class="n">iNumberOfFreeSeats</span><span class="o">++</span><span class="p">;</span>
        <span class="n">LeaveCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csAccessSeats</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c">/* 店を閉める。 */</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">DWORD</span> <span class="n">CALLBACK</span> <span class="nf">CustomerThread</span><span class="p">(</span><span class="n">LPVOID</span> <span class="n">lpParam</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="n">INT</span> <span class="n">iCustmerID_</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">INT</span> <span class="n">iCustomerID</span><span class="p">;</span>

    <span class="c">/* 来客間隔が0msだとResumeThread()した順番すら入れ替わるので、実行(来店)した順番でIDを割り振る。 */</span>
    <span class="n">EnterCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csAccessSeats</span><span class="p">);</span>
    <span class="n">iCustomerID</span><span class="o">=++</span><span class="n">iCustmerID_</span><span class="p">;</span>
    <span class="n">OUTPUT</span><span class="p">(</span><span class="s">&quot;来店 %d(空き席数=%d)&quot;</span><span class="p">,</span><span class="n">iCustomerID</span><span class="p">,</span><span class="n">iNumberOfFreeSeats</span><span class="p">);</span>

    <span class="c">/* 空き席数を確認する。 */</span>
    <span class="k">if</span><span class="p">(</span><span class="n">iNumberOfFreeSeats</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">){</span>
        <span class="n">iNumberOfFreeSeats</span><span class="o">--</span><span class="p">;</span>
        <span class="n">ReleaseSemaphore</span><span class="p">(</span><span class="n">hCustomers</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>

        <span class="c">/* 散髪の番を待つ。 */</span>
        <span class="n">WaitForHairCut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csAccessSeats</span><span class="p">);</span>

        <span class="c">/* 散髪開始。 */</span>
        <span class="n">iCurrentCustomerID</span><span class="o">=</span><span class="n">iCustomerID</span><span class="p">;</span>
        <span class="n">SetEvent</span><span class="p">(</span><span class="n">hBeginHairCut</span><span class="p">);</span>

        <span class="c">/* 散髪終了。 */</span>
        <span class="n">iNumberOfCustomersHairCut</span><span class="o">++</span><span class="p">;</span>
        <span class="n">WaitForSingleObject</span><span class="p">(</span><span class="n">hEndHairCut</span><span class="p">,</span><span class="n">INFINITE</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="n">OUTPUT</span><span class="p">(</span><span class="s">&quot;満席で立ち去る %d&quot;</span><span class="p">,</span><span class="n">iCustomerID</span><span class="p">);</span>
        <span class="n">LeaveCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csAccessSeats</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c">/* 店から出る。 */</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">VOID</span> <span class="nf">OpenBarbar</span><span class="p">(</span><span class="n">VOID</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">INT</span> <span class="n">i</span><span class="p">;</span>

    <span class="c">/* 開店準備をする。 */</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;[%*s, %8s] イベント</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">DWORD</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;ThreadID&quot;</span><span class="p">,</span> <span class="s">&quot;Time&quot;</span><span class="p">);</span>

    <span class="n">srand</span><span class="p">(</span><span class="n">GetTickCount</span><span class="p">());</span>
    <span class="n">hBarbar</span><span class="o">=</span><span class="n">CreateSemaphore</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
    <span class="n">hCustomers</span><span class="o">=</span><span class="n">CreateSemaphore</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">NUMBER_OF_SEATS</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
    <span class="n">InitializeCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csAccessThreadData</span><span class="p">);</span>
    <span class="n">InitializeCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csAccessSeats</span><span class="p">);</span>
    <span class="n">hBeginHairCut</span><span class="o">=</span><span class="n">CreateEvent</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="n">FALSE</span><span class="p">,</span><span class="n">FALSE</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
    <span class="n">hEndHairCut</span><span class="o">=</span><span class="n">CreateEvent</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="n">FALSE</span><span class="p">,</span><span class="n">FALSE</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
    <span class="n">hCloseBarbar</span><span class="o">=</span><span class="n">CreateEvent</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="n">FALSE</span><span class="p">,</span><span class="n">FALSE</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
    <span class="n">dwOpenTime</span><span class="o">=</span><span class="n">GetTickCount</span><span class="p">();</span>

    <span class="n">hBarbarThread</span><span class="o">=</span><span class="p">(</span><span class="n">HANDLE</span><span class="p">)</span><span class="n">_beginthreadex</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">BarbarThread</span><span class="p">,</span><span class="n">hCloseBarbar</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">NUMBER_OF_CUSTOMERS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">hCustomerThreads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">((</span><span class="n">HANDLE</span><span class="p">)</span><span class="n">_beginthreadex</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">CustomerThread</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">CREATE_SUSPENDED</span><span class="p">,</span><span class="nb">NULL</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">VOID</span> <span class="nf">CloseBarbar</span><span class="p">(</span><span class="n">VOID</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">INT</span> <span class="n">i</span><span class="p">;</span>

    <span class="c">/* 全ての客を処理したら店を閉める。 */</span>
    <span class="n">WaitForMultipleObjects</span><span class="p">(</span><span class="n">_countof</span><span class="p">(</span><span class="n">hCustomerThreads</span><span class="p">),</span><span class="n">hCustomerThreads</span><span class="p">,</span><span class="n">TRUE</span><span class="p">,</span><span class="n">INFINITE</span><span class="p">);</span>
    <span class="n">SetEvent</span><span class="p">(</span><span class="n">hCloseBarbar</span><span class="p">);</span>
    <span class="n">WaitForSingleObject</span><span class="p">(</span><span class="n">hBarbarThread</span><span class="p">,</span><span class="n">INFINITE</span><span class="p">);</span>

    <span class="n">CloseHandle</span><span class="p">(</span><span class="n">hBarbar</span><span class="p">);</span>
    <span class="n">CloseHandle</span><span class="p">(</span><span class="n">hCustomers</span><span class="p">);</span>
    <span class="n">DeleteCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csAccessThreadData</span><span class="p">);</span>
    <span class="n">DeleteCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csAccessSeats</span><span class="p">);</span>
    <span class="n">CloseHandle</span><span class="p">(</span><span class="n">hBeginHairCut</span><span class="p">);</span>
    <span class="n">CloseHandle</span><span class="p">(</span><span class="n">hEndHairCut</span><span class="p">);</span>
    <span class="n">CloseHandle</span><span class="p">(</span><span class="n">hCloseBarbar</span><span class="p">);</span>
    <span class="n">CloseHandle</span><span class="p">(</span><span class="n">hBarbarThread</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">_countof</span><span class="p">(</span><span class="n">hCustomerThreads</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">CloseHandle</span><span class="p">(</span><span class="n">hCustomerThreads</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

    <span class="c">/* 結果を表示する。 */</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d人のうち %d人を散髪</span><span class="se">\r\n\r\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">NUMBER_OF_CUSTOMERS</span><span class="p">,</span><span class="n">iNumberOfCustomersHairCut</span><span class="p">);</span>

    <span class="n">puts</span><span class="p">(</span><span class="s">&quot;終了するには、何かキーを押して下さい。&quot;</span><span class="p">);</span>
    <span class="n">getchar</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">INT</span> <span class="nf">main</span><span class="p">(</span><span class="n">INT</span> <span class="n">argc</span><span class="p">,</span><span class="n">CHAR</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">INT</span> <span class="n">i</span><span class="p">;</span>

    <span class="n">OpenBarbar</span><span class="p">();</span>

    <span class="c">/* 指定された時間間隔で客が来店するようにする。 */</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">NUMBER_OF_CUSTOMERS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">8</span><span class="p">)</span>
            <span class="n">Sleep</span><span class="p">(</span><span class="n">CUSTOMER_9TH_INTERVAL</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="n">Sleep</span><span class="p">(</span><span class="n">CUSTOMER_INTERVAL</span><span class="p">);</span>

        <span class="n">ResumeThread</span><span class="p">(</span><span class="n">hCustomerThreads</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="n">CloseBarbar</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9642/addtag/" class="addtag" id="addtag_9642">タグ</a>:
	
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/VC%2B%2B/">VC++</a>
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/Win32API/">Win32API</a>
    
	&nbsp;

	
      [<a href="/web/20100712030912/http://ja.doukaku.org/lang/c/">
		C
      </a>]
	  
      [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9642/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9642/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_9642"
  >-</span><span
  class="button yellow"
  id="rating_z_9642"
  >0</span><span 
  class="button green"
  id="rating_p_9642"
  >+</span></span></span>
  

<p>

  

  <a href="/web/20100712030912/http://ja.doukaku.org/comment/9642/">
    2
    replies
  </a>

  [<a href="/web/20100712030912/http://ja.doukaku.org/285/reply_to/9642/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment9646">
  <p class="banner"><a href="/web/20100712030912/http://ja.doukaku.org/user/1111/" target="_top">hoge</a>

	
	&nbsp;
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9646/">#9646</a>(<script language="JavaScript">print_time(new Date("2009/10/24 11:50 GMT"));</script><noscript>2009/10/24 11:50 GMT</noscript>)
	
	
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>　ものすごいスペリングミスを発見してしまったのですが、華麗にスルーして下さいね！</pre>
	</div>
	
	
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9646/addtag/" class="addtag" id="addtag_9646">タグ</a>:
	
	タグなし
	&nbsp;

	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_9646"
  >-</span><span
  class="button yellow"
  id="rating_z_9646"
  >0</span><span 
  class="button green"
  id="rating_p_9646"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20100712030912/http://ja.doukaku.org/comment/9642/"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20100712030912/http://ja.doukaku.org/comment/9646/root/"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  

  [<a href="/web/20100712030912/http://ja.doukaku.org/285/reply_to/9646/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment9649">
  <p class="banner"><a href="/web/20100712030912/http://ja.doukaku.org/user/1111/" target="_top">hoge</a>

	
	&nbsp;
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9649/">#9649</a>(<script language="JavaScript">print_time(new Date("2009/10/25 05:27 GMT"));</script><noscript>2009/10/25 05:27 GMT</noscript>)
	
	
	
	[<a href="/web/20100712030912/http://ja.doukaku.org/lang/c/">
	  C
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>　スペルミスの修正も兼ねて、セマフォを使わずに席の数の方を排他処理して、
床屋のスレッドを止めるという方向で書きました。こっちの方がいいかも。
　あと、できるだけ短くしたつもり。</pre>
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147</pre></td><td class="code"><div class="highlight"><pre><span class="cp">#define _CRT_RAND_S</span>
<span class="cp">#include &lt;windows.h&gt;</span>
<span class="cp">#include &lt;process.h&gt;</span>
<span class="cp">#include &lt;stdio.h&gt;</span>

<span class="cp">#define NUMBER_OF_CUSTOMERS                     (16)</span>
<span class="cp">#define NUMBER_OF_SEATS                         (3)</span>
<span class="cp">#define LOG                                     OutputMessage</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">Customer</span><span class="p">{</span>
    <span class="n">HANDLE</span> <span class="n">hThread</span><span class="p">;</span>
    <span class="n">HANDLE</span> <span class="n">hHaircutEvent</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Customer</span><span class="p">;</span>

<span class="n">CRITICAL_SECTION</span> <span class="n">csAccessSeats</span><span class="p">;</span>
<span class="n">HANDLE</span> <span class="n">hBarberThread</span><span class="p">,</span> <span class="n">hCustomerThreads</span><span class="p">[</span><span class="n">NUMBER_OF_CUSTOMERS</span><span class="p">];</span> <span class="c">/* 床屋と客のスレッド */</span>
<span class="n">Customer</span> <span class="n">seats</span><span class="p">[</span><span class="n">NUMBER_OF_SEATS</span><span class="p">];</span> <span class="c">/* 席の数(FIFO) */</span>
<span class="n">INT</span> <span class="n">iNumberOfCustomersHairCut</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="c">/* 散髪した人数 */</span>
<span class="n">DWORD</span> <span class="n">dwOpenTime</span><span class="p">;</span>
<span class="n">BOOL</span> <span class="n">bExit</span><span class="o">=</span><span class="n">FALSE</span><span class="p">;</span>

<span class="n">INT</span> <span class="nf">GetInterval</span><span class="p">(</span><span class="n">INT</span> <span class="n">iFrom</span><span class="p">,</span><span class="n">INT</span> <span class="n">iTo</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">UINT</span> <span class="n">ui</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">rand_s</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ui</span><span class="p">),</span> <span class="p">(</span><span class="n">INT</span><span class="p">)(</span><span class="n">iFrom</span><span class="o">+</span><span class="p">(</span><span class="n">DOUBLE</span><span class="p">)(</span><span class="n">iTo</span><span class="o">-</span><span class="n">iFrom</span><span class="p">)</span><span class="o">*</span><span class="n">ui</span><span class="o">/</span><span class="n">UINT_MAX</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">VOID</span> <span class="nf">OutputMessage</span><span class="p">(</span><span class="n">LPCSTR</span> <span class="n">lpszFormat</span><span class="p">,...)</span>
<span class="p">{</span>
    <span class="n">va_list</span> <span class="n">va</span><span class="p">;</span> <span class="n">CHAR</span><span class="o">*</span> <span class="n">lpBuffer</span><span class="p">;</span> <span class="n">size_t</span> <span class="n">cbBufferSize</span><span class="p">;</span>

    <span class="n">va_start</span><span class="p">(</span><span class="n">va</span><span class="p">,</span><span class="n">lpszFormat</span><span class="p">);</span>
    <span class="n">lpBuffer</span><span class="o">=</span><span class="n">_alloca</span><span class="p">(</span><span class="n">cbBufferSize</span><span class="o">=</span><span class="n">_vscprintf</span><span class="p">(</span><span class="n">lpszFormat</span><span class="p">,</span><span class="n">va</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">vsprintf_s</span><span class="p">(</span><span class="n">lpBuffer</span><span class="p">,</span><span class="n">cbBufferSize</span><span class="p">,</span><span class="n">lpszFormat</span><span class="p">,</span><span class="n">va</span><span class="p">);</span>
    <span class="n">va_end</span><span class="p">(</span><span class="n">va</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;[%#*lx, %6lums] %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">DWORD</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="n">GetCurrentThreadId</span><span class="p">(),</span><span class="n">GetTickCount</span><span class="p">()</span><span class="o">-</span><span class="n">dwOpenTime</span><span class="p">,</span><span class="n">lpBuffer</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">DWORD</span> <span class="n">CALLBACK</span> <span class="nf">BarberThread</span><span class="p">(</span><span class="n">LPVOID</span> <span class="n">lpParam</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">BOOL</span> <span class="n">bSleeping</span><span class="o">=</span><span class="n">FALSE</span><span class="p">;</span>

    <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">bExit</span><span class="p">){</span>
        <span class="n">Customer</span> <span class="n">customer</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>

        <span class="n">EnterCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csAccessSeats</span><span class="p">);</span>
        <span class="n">customer</span><span class="o">=</span><span class="n">seats</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="c">/* 客を順番に処理 */</span>
        <span class="n">LeaveCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csAccessSeats</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">customer</span><span class="p">.</span><span class="n">hThread</span><span class="p">){</span> <span class="n">LOG</span><span class="p">(</span><span class="s">&quot;床屋、眠る&quot;</span><span class="p">);</span> <span class="n">bSleeping</span><span class="o">=</span><span class="n">TRUE</span><span class="p">;</span> <span class="n">SuspendThread</span><span class="p">(</span><span class="n">GetCurrentThread</span><span class="p">());</span> <span class="k">continue</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="n">bSleeping</span><span class="p">){</span> <span class="n">LOG</span><span class="p">(</span><span class="s">&quot;床屋、目覚める&quot;</span><span class="p">);</span> <span class="n">bSleeping</span><span class="o">=</span><span class="n">FALSE</span><span class="p">;</span> <span class="p">}</span>

        <span class="n">SetEvent</span><span class="p">(</span><span class="n">customer</span><span class="p">.</span><span class="n">hHaircutEvent</span><span class="p">);</span>
        <span class="n">WaitForSingleObject</span><span class="p">(</span><span class="n">customer</span><span class="p">.</span><span class="n">hThread</span><span class="p">,</span><span class="n">INFINITE</span><span class="p">);</span>
        <span class="n">iNumberOfCustomersHairCut</span><span class="o">++</span><span class="p">;</span>

        <span class="n">EnterCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csAccessSeats</span><span class="p">);</span> <span class="c">/* 終わった客を席から取り除く */</span>
        <span class="n">CloseHandle</span><span class="p">(</span><span class="n">seats</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">hThread</span><span class="p">);</span> <span class="n">CloseHandle</span><span class="p">(</span><span class="n">seats</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">hHaircutEvent</span><span class="p">);</span>
        <span class="n">memmove</span><span class="p">(</span><span class="o">&amp;</span><span class="n">seats</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="o">&amp;</span><span class="n">seats</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Customer</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">_countof</span><span class="p">(</span><span class="n">seats</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
        <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">seats</span><span class="p">[</span><span class="n">_countof</span><span class="p">(</span><span class="n">seats</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Customer</span><span class="p">));</span>
        <span class="n">LeaveCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csAccessSeats</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">DWORD</span> <span class="n">CALLBACK</span> <span class="nf">CustomerThread</span><span class="p">(</span><span class="n">LPVOID</span> <span class="n">lpParam</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="n">INT</span> <span class="n">iCustmerID_</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">INT</span> <span class="n">iCustomerID</span><span class="p">,</span> <span class="n">iSeatIndex</span><span class="p">;</span>
    <span class="n">Customer</span> <span class="n">customer</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>

    <span class="n">EnterCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csAccessSeats</span><span class="p">);</span>
    <span class="kr">__try</span><span class="p">{</span>
        <span class="n">iCustomerID</span><span class="o">=++</span><span class="n">iCustmerID_</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="n">iSeatIndex</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">iSeatIndex</span><span class="o">&lt;</span><span class="n">_countof</span><span class="p">(</span><span class="n">seats</span><span class="p">);</span> <span class="n">iSeatIndex</span><span class="o">++</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">seats</span><span class="p">[</span><span class="n">iSeatIndex</span><span class="p">].</span><span class="n">hThread</span><span class="p">){</span> <span class="c">/* 席が空いていれば座る */</span>
                <span class="n">customer</span><span class="p">.</span><span class="n">hThread</span><span class="o">=</span><span class="n">OpenThread</span><span class="p">(</span><span class="n">STANDARD_RIGHTS_REQUIRED</span><span class="o">|</span><span class="n">SYNCHRONIZE</span><span class="p">,</span><span class="n">FALSE</span><span class="p">,</span><span class="n">GetCurrentThreadId</span><span class="p">());</span>
                <span class="n">customer</span><span class="p">.</span><span class="n">hHaircutEvent</span><span class="o">=</span><span class="n">CreateEvent</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="n">FALSE</span><span class="p">,</span><span class="n">FALSE</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>
                <span class="n">seats</span><span class="p">[</span><span class="n">iSeatIndex</span><span class="p">]</span><span class="o">=</span><span class="n">customer</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="n">LOG</span><span class="p">(</span><span class="s">&quot;来店 %d(空き席数=%d)&quot;</span><span class="p">,</span><span class="n">iCustomerID</span><span class="p">,</span><span class="n">_countof</span><span class="p">(</span><span class="n">seats</span><span class="p">)</span><span class="o">-</span><span class="n">iSeatIndex</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">_countof</span><span class="p">(</span><span class="n">seats</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">iSeatIndex</span><span class="p">){</span> <span class="n">LOG</span><span class="p">(</span><span class="s">&quot;満席で立ち去る %d&quot;</span><span class="p">,</span><span class="n">iCustomerID</span><span class="p">);</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span><span class="kr">__finally</span><span class="p">{</span>
        <span class="n">LeaveCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csAccessSeats</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">ResumeThread</span><span class="p">(</span><span class="n">hBarberThread</span><span class="p">);</span> <span class="c">/* 既に実行されていてもかまわない */</span>
    <span class="n">WaitForSingleObject</span><span class="p">(</span><span class="n">customer</span><span class="p">.</span><span class="n">hHaircutEvent</span><span class="p">,</span><span class="n">INFINITE</span><span class="p">);</span>
    <span class="n">LOG</span><span class="p">(</span><span class="s">&quot;散髪開始 %d&quot;</span><span class="p">,</span><span class="n">iCustomerID</span><span class="p">);</span>
    <span class="n">Sleep</span><span class="p">(</span><span class="n">GetInterval</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">400</span><span class="p">));</span>
    <span class="n">LOG</span><span class="p">(</span><span class="s">&quot;散髪終了 %d&quot;</span><span class="p">,</span><span class="n">iCustomerID</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">VOID</span> <span class="nf">OpenBarber</span><span class="p">(</span><span class="n">VOID</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">INT</span> <span class="n">i</span><span class="p">;</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;[%*s, %8s] イベント</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">DWORD</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;ThreadID&quot;</span><span class="p">,</span><span class="s">&quot;Time&quot;</span><span class="p">);</span>

    <span class="n">InitializeCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csAccessSeats</span><span class="p">);</span>
    <span class="n">dwOpenTime</span><span class="o">=</span><span class="n">GetTickCount</span><span class="p">();</span>
    <span class="n">hBarberThread</span><span class="o">=</span><span class="p">(</span><span class="n">HANDLE</span><span class="p">)</span><span class="n">_beginthreadex</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">BarberThread</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">NULL</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">NUMBER_OF_CUSTOMERS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">hCustomerThreads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">((</span><span class="n">HANDLE</span><span class="p">)</span><span class="n">_beginthreadex</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">CustomerThread</span><span class="p">,</span><span class="nb">NULL</span><span class="p">,</span><span class="n">CREATE_SUSPENDED</span><span class="p">,</span><span class="nb">NULL</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">VOID</span> <span class="nf">CloseBarber</span><span class="p">(</span><span class="n">VOID</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">INT</span> <span class="n">i</span><span class="p">;</span>

    <span class="n">WaitForMultipleObjects</span><span class="p">(</span><span class="n">_countof</span><span class="p">(</span><span class="n">hCustomerThreads</span><span class="p">),</span><span class="n">hCustomerThreads</span><span class="p">,</span><span class="n">TRUE</span><span class="p">,</span><span class="n">INFINITE</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="n">WaitForSingleObject</span><span class="p">(</span><span class="n">hBarberThread</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span><span class="o">==</span><span class="n">WAIT_TIMEOUT</span><span class="p">){</span> <span class="n">bExit</span><span class="o">=</span><span class="n">TRUE</span><span class="p">;</span> <span class="n">ResumeThread</span><span class="p">(</span><span class="n">hBarberThread</span><span class="p">);</span> <span class="p">};</span>

    <span class="n">DeleteCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">csAccessSeats</span><span class="p">);</span>
    <span class="n">CloseHandle</span><span class="p">(</span><span class="n">hBarberThread</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">_countof</span><span class="p">(</span><span class="n">hCustomerThreads</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">CloseHandle</span><span class="p">(</span><span class="n">hCustomerThreads</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d人のうち %d人を散髪</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">NUMBER_OF_CUSTOMERS</span><span class="p">,</span><span class="n">iNumberOfCustomersHairCut</span><span class="p">);</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">&quot;終了するには、何かキーを押して下さい。&quot;</span><span class="p">);</span> <span class="n">getchar</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">INT</span> <span class="nf">main</span><span class="p">(</span><span class="n">INT</span> <span class="n">argc</span><span class="p">,</span><span class="n">CHAR</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">INT</span> <span class="n">i</span><span class="p">;</span>

    <span class="n">OpenBarber</span><span class="p">();</span>

    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">NUMBER_OF_CUSTOMERS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">8</span><span class="p">)</span> <span class="n">Sleep</span><span class="p">(</span><span class="n">GetInterval</span><span class="p">(</span><span class="mi">1200</span><span class="p">,</span><span class="mi">1200</span><span class="p">));</span>
        <span class="k">else</span> <span class="n">Sleep</span><span class="p">(</span><span class="n">GetInterval</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">200</span><span class="p">));</span>

        <span class="n">ResumeThread</span><span class="p">(</span><span class="n">hCustomerThreads</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="n">CloseBarber</span><span class="p">();</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9649/addtag/" class="addtag" id="addtag_9649">タグ</a>:
	
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/VC%2B%2B/">VC++</a>
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/Win32API/">Win32API</a>
    
	&nbsp;

	
      [<a href="/web/20100712030912/http://ja.doukaku.org/lang/c/">
		C
      </a>]
	  
      [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9649/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9649/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_9649"
  >-</span><span
  class="button yellow"
  id="rating_z_9649"
  >0</span><span 
  class="button green"
  id="rating_p_9649"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20100712030912/http://ja.doukaku.org/comment/9642/"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20100712030912/http://ja.doukaku.org/comment/9649/root/"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  <a href="/web/20100712030912/http://ja.doukaku.org/comment/9649/">
    1
    reply
  </a>

  [<a href="/web/20100712030912/http://ja.doukaku.org/285/reply_to/9649/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment9651">
  <p class="banner"><a href="/web/20100712030912/http://ja.doukaku.org/user/570/" target="_top">horiuchi</a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9651/">#9651</a>(<script language="JavaScript">print_time(new Date("2009/10/26 08:24 GMT"));</script><noscript>2009/10/26 08:24 GMT</noscript>)
	
	
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>実行結果を貼り付けてなかったので、いまさらですが追記。

8 床屋 寝る
1 来店 1
8 床屋、目覚める
8 散髪開始 1
1 来店 2
8 散髪完了 1
8 散髪開始 2
1 来店 3
1 来店 4
1 来店 5
1 満席で立ち去る 5
1 来店 6
1 満席で立ち去る 6
1 来店 7
1 満席で立ち去る 7
8 散髪完了 2
8 散髪開始 3
1 来店 8
8 散髪完了 3
8 散髪開始 4
8 散髪完了 4
8 散髪開始 8
8 散髪完了 8
8 床屋 寝る
1 来店 9
8 床屋、目覚める
8 散髪開始 9
1 来店 10
1 来店 11
8 散髪完了 9
8 散髪開始 10
1 来店 12
1 来店 13
1 満席で立ち去る 13
1 来店 14
1 満席で立ち去る 14
8 散髪完了 10
8 散髪開始 11
1 来店 15
1 来店 16
1 満席で立ち去る 16
8 散髪完了 11
8 散髪開始 12
8 散髪完了 12
8 散髪開始 15
8 散髪完了 15
8 床屋 寝る
16人のうち 10人を散髪
</pre>
	</div>
	
	
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9651/addtag/" class="addtag" id="addtag_9651">タグ</a>:
	
	タグなし
	&nbsp;

	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_9651"
  >-</span><span
  class="button yellow"
  id="rating_z_9651"
  >0</span><span 
  class="button green"
  id="rating_p_9651"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20100712030912/http://ja.doukaku.org/comment/9633/"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20100712030912/http://ja.doukaku.org/comment/9651/root/"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  

  [<a href="/web/20100712030912/http://ja.doukaku.org/285/reply_to/9651/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment9654">
  <p class="banner"><a href="/web/20100712030912/http://ja.doukaku.org/user/1111/" target="_top">hoge</a>

	
	&nbsp;
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9654/">#9654</a>(<script language="JavaScript">print_time(new Date("2009/10/31 06:54 GMT"));</script><noscript>2009/10/31 06:54 GMT</noscript>)
	
	
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #efffef;">1/1=1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>　冷静に考えたら、床屋のスレッドを止めるところも排他処理しなきゃ駄目でした。
でも、そうすると排他オブジェクトのリリースができないジレンマに。
　やはり、セマフォか管理スレッドもう１つ追加するとかしないと駄目なのでしょうか。</pre>
	</div>
	
	
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9654/addtag/" class="addtag" id="addtag_9654">タグ</a>:
	
	タグなし
	&nbsp;

	

  
  <span class="rating">
  評価<span style="background-color: #efffef;"
  >1/1=1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_9654"
  >-</span><span
  class="button yellow"
  id="rating_z_9654"
  >0</span><span 
  class="button green"
  id="rating_p_9654"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20100712030912/http://ja.doukaku.org/comment/9649/"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20100712030912/http://ja.doukaku.org/comment/9654/root/"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  

  [<a href="/web/20100712030912/http://ja.doukaku.org/285/reply_to/9654/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment9655">
  <p class="banner"><a href="/web/20100712030912/http://ja.doukaku.org/user/498/" target="_top">eo-oe-aaaa</a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/star_silver.png" border=0/></a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9655/">#9655</a>(<script language="JavaScript">print_time(new Date("2009/11/03 10:15 GMT"));</script><noscript>2009/11/03 10:15 GMT</noscript>)
	
	
	
	[<a href="/web/20100712030912/http://ja.doukaku.org/lang/ruby/">
	  Ruby
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  ruby 1.9.1です。
普通にQueueを使いました。

●実行結果
[#&lt;Thread:0x279c99c&gt;] 床屋、眠る
[#&lt;Thread:0x279c9f0&gt;] 来店 1
[#&lt;Thread:0x279c99c&gt;] 床屋、目覚める
[#&lt;Thread:0x279c99c&gt;] 散髪、開始 1
[#&lt;Thread:0x279c9f0&gt;] 来店 2
[#&lt;Thread:0x279c9f0&gt;] 来店 3
[#&lt;Thread:0x279c9f0&gt;] 来店 4
[#&lt;Thread:0x279c9f0&gt;] 満席で立ち去る 4
[#&lt;Thread:0x279c9f0&gt;] 来店 5
[#&lt;Thread:0x279c9f0&gt;] 満席で立ち去る 5
[#&lt;Thread:0x279c99c&gt;] 散髪、完了 1
[#&lt;Thread:0x279c99c&gt;] 散髪、開始 2
[#&lt;Thread:0x279c9f0&gt;] 来店 6
[#&lt;Thread:0x279c9f0&gt;] 来店 7
[#&lt;Thread:0x279c9f0&gt;] 満席で立ち去る 7
[#&lt;Thread:0x279c99c&gt;] 散髪、完了 2
[#&lt;Thread:0x279c99c&gt;] 散髪、開始 3
[#&lt;Thread:0x279c9f0&gt;] 来店 8
[#&lt;Thread:0x279c99c&gt;] 散髪、完了 3
[#&lt;Thread:0x279c99c&gt;] 散髪、開始 6
[#&lt;Thread:0x279c99c&gt;] 散髪、完了 6
[#&lt;Thread:0x279c99c&gt;] 散髪、開始 8
[#&lt;Thread:0x279c99c&gt;] 散髪、完了 8
[#&lt;Thread:0x279c99c&gt;] 床屋、眠る
[#&lt;Thread:0x279c9f0&gt;] 来店 9
[#&lt;Thread:0x279c99c&gt;] 床屋、目覚める
[#&lt;Thread:0x279c99c&gt;] 散髪、開始 9
[#&lt;Thread:0x279c9f0&gt;] 来店 10
[#&lt;Thread:0x279c9f0&gt;] 来店 11
[#&lt;Thread:0x279c9f0&gt;] 来店 12
[#&lt;Thread:0x279c9f0&gt;] 満席で立ち去る 12
[#&lt;Thread:0x279c99c&gt;] 散髪、完了 9
[#&lt;Thread:0x279c99c&gt;] 散髪、開始 10
[#&lt;Thread:0x279c9f0&gt;] 来店 13
[#&lt;Thread:0x279c9f0&gt;] 来店 14
[#&lt;Thread:0x279c9f0&gt;] 満席で立ち去る 14
[#&lt;Thread:0x279c99c&gt;] 散髪、完了 10
[#&lt;Thread:0x279c99c&gt;] 散髪、開始 11
[#&lt;Thread:0x279c9f0&gt;] 来店 15
[#&lt;Thread:0x279c9f0&gt;] 来店 16
[#&lt;Thread:0x279c9f0&gt;] 満席で立ち去る 16
[#&lt;Thread:0x279c99c&gt;] 散髪、完了 11
[#&lt;Thread:0x279c99c&gt;] 散髪、開始 13
[#&lt;Thread:0x279c99c&gt;] 散髪、完了 13
[#&lt;Thread:0x279c99c&gt;] 散髪、開始 15
[#&lt;Thread:0x279c99c&gt;] 散髪、完了 15
16人のうち 10人を散髪

	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre></td><td class="code"><div class="highlight"><pre><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="nb">require</span> <span class="s1">&#39;thread&#39;</span>

<span class="k">def</span> <span class="nf">log</span><span class="p">(</span> <span class="n">s</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">)</span>
  <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
    <span class="nb">puts</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;[%s] %s&quot;</span><span class="p">,</span> <span class="no">Thread</span><span class="o">.</span><span class="n">current</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="nb">puts</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;[%s] %s %d&quot;</span><span class="p">,</span> <span class="no">Thread</span><span class="o">.</span><span class="n">current</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">cus_q</span> <span class="o">=</span> <span class="no">Queue</span><span class="o">.</span><span class="n">new</span>
<span class="n">m</span> <span class="o">=</span> <span class="no">Mutex</span><span class="o">.</span><span class="n">new</span>
<span class="n">cus_num</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">cut_num</span> <span class="o">=</span> <span class="mi">0</span>

<span class="no">Thread</span><span class="o">.</span><span class="n">start</span> <span class="p">{</span>
  <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
    <span class="nb">sleep</span><span class="p">(</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">9</span> <span class="k">then</span> <span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="k">else</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="o">.</span><span class="mi">0</span> <span class="k">end</span><span class="p">)</span>

    <span class="n">log</span><span class="p">(</span> <span class="s2">&quot;来店&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">synchronize</span> <span class="k">do</span>
      <span class="k">if</span> <span class="n">cus_num</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">then</span>
        <span class="n">log</span><span class="p">(</span> <span class="s2">&quot;満席で立ち去る&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="p">)</span>
      <span class="k">else</span>
        <span class="n">cus_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">cut_num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">cus_q</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="n">cus_q</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="kp">nil</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">barber</span> <span class="o">=</span> <span class="no">Thread</span><span class="o">.</span><span class="n">start</span> <span class="p">{</span>
  <span class="kp">loop</span> <span class="k">do</span>
    <span class="k">if</span> <span class="n">cus_q</span><span class="o">.</span><span class="n">empty?</span> <span class="k">then</span>
      <span class="n">log</span><span class="p">(</span> <span class="s2">&quot;床屋、眠る&quot;</span><span class="p">)</span>
      <span class="n">i</span> <span class="o">=</span> <span class="n">cus_q</span><span class="o">.</span><span class="n">pop</span>
      <span class="n">log</span><span class="p">(</span> <span class="s2">&quot;床屋、目覚める&quot;</span> <span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="kp">nil</span>
    <span class="k">else</span>
      <span class="n">i</span> <span class="o">=</span> <span class="n">cus_q</span><span class="o">.</span><span class="n">pop</span>
    <span class="k">end</span>

    <span class="no">Thread</span><span class="o">.</span><span class="n">exit</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="kp">nil</span>

    <span class="n">log</span><span class="p">(</span> <span class="s2">&quot;散髪、開始&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="nb">sleep</span><span class="p">(</span> <span class="p">(</span> <span class="mi">100</span> <span class="o">+</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">))</span> <span class="o">/</span> <span class="mi">1000</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">synchronize</span> <span class="p">{</span>
      <span class="n">log</span><span class="p">(</span> <span class="s2">&quot;散髪、完了&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
      <span class="n">cus_num</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="p">}</span>
  <span class="k">end</span>
<span class="p">}</span>

<span class="n">barber</span><span class="o">.</span><span class="n">join</span>
<span class="nb">puts</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;16人のうち %d人を散髪&quot;</span><span class="p">,</span> <span class="n">cut_num</span> <span class="p">)</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9655/addtag/" class="addtag" id="addtag_9655">タグ</a>:
	
	タグなし
	&nbsp;

	
      [<a href="/web/20100712030912/http://ja.doukaku.org/lang/ruby/">
		Ruby
      </a>]
	  
      [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9655/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20100712030912/http://ja.doukaku.org/comment/9655/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_9655"
  >-</span><span
  class="button yellow"
  id="rating_z_9655"
  >0</span><span 
  class="button green"
  id="rating_p_9655"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20100712030912/http://ja.doukaku.org/285/reply_to/9655/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment9737">
  <p class="banner"><a href="/web/20100712030912/http://ja.doukaku.org/user/4/" target="_top">匿名</a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9737/">#9737</a>(<script language="JavaScript">print_time(new Date("2009/12/25 10:31 GMT"));</script><noscript>2009/12/25 10:31 GMT</noscript>)
	
	
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffefef;">-1/1=-1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <p>Casino Free Game  tyuueooru
<a class="reference" href="/web/20100712030912/http://stonewalljacksoncarnival.org/">http://stonewalljacksoncarnival.org/</a> - Casino Games</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">&lt;string&gt;</tt>, line 3)</p>
Unexpected indentation.</div>
<blockquote>
There are several advantages of playing online casino and some of them include: 1.</blockquote>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">&lt;string&gt;</tt>, line 4)</p>
Block quote ends without a blank line; unexpected unindent.</div>
<dl class="docutils">
<dt>&lt;a href=http://stonewalljacksoncarnival.org/&gt;Online Casinos Free&lt;/a&gt;</dt>
<dd>You can enjoy online casino simply by getting connected to the Internet.</dd>
<dt>&lt;a href=http://stonewalljacksoncarnival.org/&gt;Web Casino&lt;/a&gt;</dt>
<dd>All you need to is a well operating computer and an Internet connection and you?re done with your gambling.</dd>
</dl>

	</div>
	
	<p class="link">
	  参考: <a href="/web/20100712030912/http://www.nhgaa.org/">Casino Gambling </a>
	</p>  
	
	
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/9737/addtag/" class="addtag" id="addtag_9737">タグ</a>:
	
	タグなし
	&nbsp;

	

  
  <span class="rating">
  評価<span style="background-color: #ffefef;"
  >-1/1=-1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_9737"
  >-</span><span
  class="button yellow"
  id="rating_z_9737"
  >0</span><span 
  class="button green"
  id="rating_p_9737"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20100712030912/http://ja.doukaku.org/comment/9633/"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20100712030912/http://ja.doukaku.org/comment/9737/root/"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  

  [<a href="/web/20100712030912/http://ja.doukaku.org/285/reply_to/9737/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment10276">
  <p class="banner"><a href="/web/20100712030912/http://ja.doukaku.org/user/4/" target="_top">匿名</a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/10276/">#10276</a>(<script language="JavaScript">print_time(new Date("2010/02/17 11:21 GMT"));</script><noscript>2010/02/17 11:21 GMT</noscript>)
	
	
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffdfdf;">-2/2=-1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <p>Hi, rioutyrr &lt;a href=http://bisco-if.com&gt;valium pharmacy&lt;/a&gt; &lt;a href=http://hillarymoveon.org&gt;purchase valium&lt;/a&gt; <a class="reference" href="/web/20100712030912/http://forestfire-survival.com/">http://forestfire-survival.com</a> - valium drug <a class="reference" href="/web/20100712030912/http://aquarium-fish-guide.com/">http://aquarium-fish-guide.com</a> - cheap viagra online &lt;a href=http://courtofcamelot.com&gt;viagra drug&lt;/a&gt; &lt;a href=http://aszureartists.com&gt;cheap generic viagra&lt;/a&gt; &lt;a href=http://cdennisart.com&gt;Webcam Chat Rooms&lt;/a&gt; &lt;a href=http://cdennisart.com&gt;Girl Webcam&lt;/a&gt; <a class="reference" href="/web/20100712030912/http://cdennisart.com/">http://cdennisart.com</a> - Webcam Striptease <a class="reference" href="/web/20100712030912/http://medseaproperty.com/">http://medseaproperty.com</a> - xanax cost &lt;a href=http://clevelandcubs.com&gt;buy xanax online&lt;/a&gt; &lt;a href=http://neurosy.org&gt;xanax online&lt;/a&gt; &lt;a href=http://aivit.com&gt;zithromax medication&lt;/a&gt; &lt;a href=http://jigoloelcin.com&gt;zithromax azithromycin&lt;/a&gt; <a class="reference" href="/web/20100712030912/http://stealthtronix.com/">http://stealthtronix.com</a> - zithromax medication <a class="reference" href="/web/20100712030912/http://upsidedownhealth.com/">http://upsidedownhealth.com</a> - antidepressant zoloft &lt;a href=http://upsidedownhealth.com&gt;zoloft no prescription&lt;/a&gt; &lt;a href=http://bestpoolcleanersonline.com&gt;zoloft online&lt;/a&gt; &lt;a href=http://bethjudahmessianic.org&gt;zyban without prescription&lt;/a&gt; &lt;a href=http://bethjudahmessianic.org&gt;zyban no prescription&lt;/a&gt; <a class="reference" href="/web/20100712030912/http://bethjudahmessianic.org/">http://bethjudahmessianic.org</a> - cheap zyban &lt;a href=http://assistancedogsofamerica.org/&gt;accutane pharmacy&lt;/a&gt; &lt;a href=http://hillviewonbuckatabon.com/&gt;accutane without prescription&lt;/a&gt; <a class="reference" href="/web/20100712030912/http://hillviewonbuckatabon.com/">http://hillviewonbuckatabon.com/</a> - buy accutane online <a class="reference" href="/web/20100712030912/http://quartetoemmim.com/">http://quartetoemmim.com</a> - purchase acomplia &lt;a href=http://quartetoemmim.com&gt;discount acomplia online&lt;/a&gt; &lt;a href=http://quartetoemmim.com&gt;acomplia pills&lt;/a&gt; <a class="reference" href="/web/20100712030912/http://lampsofnote.com/">http://lampsofnote.com</a> - purchase adipex &lt;a href=http://mounttrashmore.org&gt;adipex phentermine&lt;/a&gt; &lt;a href=http://lampsofnote.com&gt;buy adipex&lt;/a&gt; &lt;a href=http://beykozkurek.org&gt;ambien 5&lt;/a&gt; &lt;a href=http://jayprofeit.com&gt;order ambien online&lt;/a&gt; <a class="reference" href="/web/20100712030912/http://ernestofonseca.com/">http://ernestofonseca.com</a> - zolpidem online <a class="reference" href="/web/20100712030912/http://frebass.com/">http://frebass.com</a> - ativan pharmacy &lt;a href=http://broadrivertheatre.org&gt;buy lorazepam online&lt;/a&gt; &lt;a href=http://geteyeliner.com&gt;buy lorazepam online&lt;/a&gt; &lt;a href=http://dbsearchexpert.com&gt;Best Casino&lt;/a&gt; &lt;a href=http://dbsearchexpert.com&gt;Casino Gambling&lt;/a&gt; <a class="reference" href="/web/20100712030912/http://dbsearchexpert.com/">http://dbsearchexpert.com</a> - Free Casino Game <a class="reference" href="/web/20100712030912/http://thefoundationhouse.org/">http://thefoundationhouse.org</a> - Purchase Celebrex &lt;a href=http://thefoundationhouse.org&gt;Celebrex Overnight&lt;/a&gt; &lt;a href=http://thefoundationhouse.org&gt;Celebrex Without Prescription&lt;/a&gt; <a class="reference" href="/web/20100712030912/http://billselleck.net/">http://billselleck.net</a> - purchase celexa &lt;a href=http://billselleck.net&gt;celexa online&lt;/a&gt; &lt;a href=http://billselleck.net&gt;celexa drug&lt;/a&gt; &lt;a href=http://catalystradio.com&gt;cialis sale&lt;/a&gt; &lt;a href=http://auctionbaylivesearch.com&gt;cheap cialis online&lt;/a&gt; <a class="reference" href="/web/20100712030912/http://zaxxonrecords.com/">http://zaxxonrecords.com</a> - cialis for sale <a class="reference" href="/web/20100712030912/http://frumslang.com/">http://frumslang.com</a> - cipro online &lt;a href=http://frumslang.com&gt;buy cipro online&lt;/a&gt; &lt;a href=http://frumslang.com&gt;ciprofloxacin 500mg&lt;/a&gt; &lt;a href=http://kengajone.com&gt;purchase clomid&lt;/a&gt;</p>

	</div>
	
	<p class="link">
	  参考: <a href="/web/20100712030912/http://cdennisart.com/">Marijuana Use As Medicinal Drug </a>
	</p>  
	
	
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/10276/addtag/" class="addtag" id="addtag_10276">タグ</a>:
	
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/For/">For</a>
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/Marijuana/">Marijuana</a>
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/Medicine/">Medicine</a>
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/Use/">Use</a>
    
	&nbsp;

	

  
  <span class="rating">
  評価<span style="background-color: #ffdfdf;"
  >-2/2=-1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_10276"
  >-</span><span
  class="button yellow"
  id="rating_z_10276"
  >0</span><span 
  class="button green"
  id="rating_p_10276"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20100712030912/http://ja.doukaku.org/comment/9633/"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20100712030912/http://ja.doukaku.org/comment/10276/root/"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  

  [<a href="/web/20100712030912/http://ja.doukaku.org/285/reply_to/10276/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment10278">
  <p class="banner"><a href="/web/20100712030912/http://ja.doukaku.org/user/4/" target="_top">匿名</a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/10278/">#10278</a>(<script language="JavaScript">print_time(new Date("2010/02/17 14:44 GMT"));</script><noscript>2010/02/17 14:44 GMT</noscript>)
	
	
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffdfdf;">-2/2=-1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <p>Hi, rioutyrr &lt;a href=http://quartetoemmim.com&gt;acomplia&lt;/a&gt; &lt;a href=http://quartetoemmim.com&gt;generic acomplia rimonabant&lt;/a&gt; <a class="reference" href="/web/20100712030912/http://lampsofnote.com/">http://lampsofnote.com</a> - adipex pills &lt;a href=http://lampsofnote.com&gt;buy adipex online&lt;/a&gt; &lt;a href=http://mounttrashmore.org&gt;buy cheap adipex&lt;/a&gt; &lt;a href=http://afyonluyuz.com&gt;ambien without prescription&lt;/a&gt; &lt;a href=http://alientalk.org&gt;buy generic ambien&lt;/a&gt; <a class="reference" href="/web/20100712030912/http://jayprofeit.com/">http://jayprofeit.com</a> - ambien drug <a class="reference" href="/web/20100712030912/http://frebass.com/">http://frebass.com</a> - ativan no prescription &lt;a href=http://10thpowermedia.com&gt;buy ativan&lt;/a&gt; &lt;a href=http://tvcrossdressing.org&gt;buy lorazepam online&lt;/a&gt; &lt;a href=http://dbsearchexpert.com&gt;Online Casinos Free&lt;/a&gt; &lt;a href=http://dbsearchexpert.com&gt;Free Casino&lt;/a&gt; <a class="reference" href="/web/20100712030912/http://dbsearchexpert.com/">http://dbsearchexpert.com</a> - Free Casino <a class="reference" href="/web/20100712030912/http://thefoundationhouse.org/">http://thefoundationhouse.org</a> - Discount Celebrex Online &lt;a href=http://thefoundationhouse.org&gt;Cheap Celebrex&lt;/a&gt; &lt;a href=http://thefoundationhouse.org&gt;Buying Celebrex Online&lt;/a&gt; <a class="reference" href="/web/20100712030912/http://billselleck.net/">http://billselleck.net</a> - buy citalopram &lt;a href=http://billselleck.net&gt;purchase celexa&lt;/a&gt; &lt;a href=http://billselleck.net&gt;buy celexa&lt;/a&gt; &lt;a href=http://crowbottomblues.com&gt;discount cialis&lt;/a&gt; &lt;a href=http://valleygardens.net&gt;buy cialis online&lt;/a&gt; <a class="reference" href="/web/20100712030912/http://brewersjam.com/">http://brewersjam.com</a> - discount cialis <a class="reference" href="/web/20100712030912/http://bloopddl.com/">http://bloopddl.com</a> - cipro without prescription &lt;a href=http://bloopddl.com&gt;cipro medication&lt;/a&gt; &lt;a href=http://poweryourpocket.com&gt;cheap cipro&lt;/a&gt; &lt;a href=http://kengajone.com&gt;purchase clomid&lt;/a&gt; &lt;a href=http://grandavenuemcalester.org&gt;clomid fertility drug&lt;/a&gt; <a class="reference" href="/web/20100712030912/http://grandavenuemcalester.org/">http://grandavenuemcalester.org</a> - buy clomiphene <a class="reference" href="/web/20100712030912/http://southernutahbaseballacademy.com/">http://southernutahbaseballacademy.com</a>   cymbalta - cymbalta pill &lt;a href=http://southernutahbaseballacademy.com&gt;cymbalta pharmacy&lt;/a&gt; &lt;a href=http://southernutahbaseballacademy.com   cymbalta&gt;cymbalta duloxetine&lt;/a&gt; &lt;a href=http://cultureloungeonline.com&gt;order doxycycline&lt;/a&gt; &lt;a href=http://cultureloungeonline.com&gt;doxycycline price&lt;/a&gt; <a class="reference" href="/web/20100712030912/http://denisecoatesblog.com/">http://denisecoatesblog.com</a> - doxycycline online <a class="reference" href="/web/20100712030912/http://black-harvest.com/">http://black-harvest.com</a> - order viagra online &lt;a href=http://black-harvest.com&gt;cialis online pharmacy&lt;/a&gt; &lt;a href=http://black-harvest.com&gt;tadalafil online&lt;/a&gt; &lt;a href=http://blackchambers-online.com&gt;buy venlafaxine online&lt;/a&gt; &lt;a href=http://blackchambers-online.com&gt;generic venlafaxine&lt;/a&gt; <a class="reference" href="/web/20100712030912/http://blackchambers-online.com/">http://blackchambers-online.com</a> - venlafaxine <a class="reference" href="/web/20100712030912/http://wardsoutdoorsports.com/">http://wardsoutdoorsports.com</a> - klonopin pharmacy &lt;a href=http://alexdavishomes.com&gt;klonopin clonazepam&lt;/a&gt; &lt;a href=http://wardsoutdoorsports.com&gt;klonopin mg&lt;/a&gt; &lt;a href=http://linleemaltese.com&gt;generic levitra online&lt;/a&gt; &lt;a href=http://sbvisioncenter.com&gt;cheap levitra online&lt;/a&gt; <a class="reference" href="/web/20100712030912/http://mainstreetcapital.org/">http://mainstreetcapital.org</a> - levitra cost <a class="reference" href="/web/20100712030912/http://uey-sj.org/">http://uey-sj.org</a> - purchase lexapro &lt;a href=http://nailsnow.net&gt;lexapro escitalopram&lt;/a&gt; &lt;a href=http://vfkhistory.com&gt;purchase lexapro&lt;/a&gt; &lt;a href=http://boulderwinefest.com&gt;Generic Lipitor&lt;/a&gt; &lt;a href=http://boulderwinefest.com&gt;Lipitor Drugs&lt;/a&gt;</p>

	</div>
	
	<p class="link">
	  参考: <a href="/web/20100712030912/http://cdennisart.com/">Why Sell Illegal Drugs Psychology </a>
	</p>  
	
	
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/10278/addtag/" class="addtag" id="addtag_10278">タグ</a>:
	
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/Medicine/">Medicine</a>
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/Prn/">Prn</a>
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/Serve/">Serve</a>
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/Why/">Why</a>
    
	&nbsp;

	

  
  <span class="rating">
  評価<span style="background-color: #ffdfdf;"
  >-2/2=-1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_10278"
  >-</span><span
  class="button yellow"
  id="rating_z_10278"
  >0</span><span 
  class="button green"
  id="rating_p_10278"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20100712030912/http://ja.doukaku.org/comment/9633/"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20100712030912/http://ja.doukaku.org/comment/10278/root/"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  

  [<a href="/web/20100712030912/http://ja.doukaku.org/285/reply_to/10278/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment10311">
  <p class="banner"><a href="/web/20100712030912/http://ja.doukaku.org/user/4/" target="_top">匿名</a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/10311/">#10311</a>(<script language="JavaScript">print_time(new Date("2010/02/28 22:37 GMT"));</script><noscript>2010/02/28 22:37 GMT</noscript>)
	
	
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffefef;">-1/1=-1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <p>What words... super   &lt;a href= <a class="reference" href="/web/20100712030912/http://jhngxlxdh.sitotop.com/watermellon-ciallis.html">http://jhngxlxdh.sitotop.com/watermellon-ciallis.html</a> &gt;watermellon ciallis  buy online&lt;/a&gt;  Good joke :)   What weighs 909 kg (2,000 pounds for all of you inefficient, non-metric &quot;people&quot;) and is bare to the bone? A skeleTON!!!</p>

	</div>
	
	<p class="link">
	  参考: <a href="/web/20100712030912/http://jhngxlxdh.sitotop.com/">gwenn zag</a>
	</p>  
	
	
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/10311/addtag/" class="addtag" id="addtag_10311">タグ</a>:
	
	タグなし
	&nbsp;

	

  
  <span class="rating">
  評価<span style="background-color: #ffefef;"
  >-1/1=-1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_10311"
  >-</span><span
  class="button yellow"
  id="rating_z_10311"
  >0</span><span 
  class="button green"
  id="rating_p_10311"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20100712030912/http://ja.doukaku.org/comment/9633/"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20100712030912/http://ja.doukaku.org/comment/10311/root/"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  

  [<a href="/web/20100712030912/http://ja.doukaku.org/285/reply_to/10311/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment10495">
  <p class="banner"><a href="/web/20100712030912/http://ja.doukaku.org/user/4/" target="_top">匿名</a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20100712030912/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/10495/">#10495</a>(<script language="JavaScript">print_time(new Date("2010/05/06 18:55 GMT"));</script><noscript>2010/05/06 18:55 GMT</noscript>)
	
	
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffefef;">-1/1=-1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <p>Medication Administration Carts
&lt;a href=http://www.hotfm105.com&gt;purchase ambien&lt;/a&gt;</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">&lt;string&gt;</tt>, line 3)</p>
Unexpected indentation.</div>
<blockquote>
Clinical trials on the drug have been conducted with almost 3,600 patients evaluated.</blockquote>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">&lt;string&gt;</tt>, line 4)</p>
Block quote ends without a blank line; unexpected unindent.</div>
<dl class="docutils">
<dt><a class="reference" href="/web/20100712030912/http://www.hotfm105.com/">http://www.hotfm105.com</a> - ambien price</dt>
<dd>Clinical trials on the drug have been conducted with almost 3,600 patients evaluated.</dd>
<dt>&lt;a href=http://www.hotfm105.com&gt;zolpidem without prescription&lt;/a&gt;</dt>
<dd>If ever problems do occur, these are normally minor and require no treatment or can easily be treated by your doctor.</dd>
</dl>

	</div>
	
	<p class="link">
	  参考: <a href="/web/20100712030912/http://www.aefforce.com/">Medication Administration Certificate </a>
	</p>  
	
	
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20100712030912/http://ja.doukaku.org/comment/10495/addtag/" class="addtag" id="addtag_10495">タグ</a>:
	
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/Administration/">Administration</a>
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/Certification/">Certification</a>
    
    <a href="/web/20100712030912/http://ja.doukaku.org/tag/Medication/">Medication</a>
    
	&nbsp;

	

  
  <span class="rating">
  評価<span style="background-color: #ffefef;"
  >-1/1=-1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_10495"
  >-</span><span
  class="button yellow"
  id="rating_z_10495"
  >0</span><span 
  class="button green"
  id="rating_p_10495"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20100712030912/http://ja.doukaku.org/comment/9633/"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20100712030912/http://ja.doukaku.org/comment/10495/root/"><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  

  [<a href="/web/20100712030912/http://ja.doukaku.org/285/reply_to/10495/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>







</div>

<div id="side_menu" class="compact">

<iframe src="/web/20100712030912if_/http://ja.doukaku.org/login_info/" frameborder=0 width=100% id="login_info">
iframe required
</iframe>

<h4 class="semi_compact">一覧</h4>

<ul>
<!--<li><a href="/web/20100712030912/http://ja.doukaku.org/user/">ユーザ</a>-->
<li><a href="/web/20100712030912/http://ja.doukaku.org/lang/">言語</a>
<li><a href="/web/20100712030912/http://ja.doukaku.org/challenge/">お題</a>
<li><a href="/web/20100712030912/http://ja.doukaku.org/topic/">トピック</a>
<li><a href="/web/20100712030912/http://ja.doukaku.org/comment/">投稿</a>
<li><a href="/web/20100712030912/http://ja.doukaku.org/good_comments/">評価の高い投稿</a>
<li><a href="/web/20100712030912/http://ja.doukaku.org/tag/">タグ</a>
</ul>

<h4 class="compact">フィード</h4>
<ul>
<li><a href="/web/20100712030912/http://ja.doukaku.org/feeds/challenges/">最新のお題</a><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/feed_icon.png">
<li><a href="/web/20100712030912/http://ja.doukaku.org/feeds/topics/">最新のトピック</a><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/feed_icon.png">
<li><a href="/web/20100712030912/http://ja.doukaku.org/feeds/comments/">新着投稿</a><img src="/web/20100712030912im_/http://ja.doukaku.org/static/image/feed_icon.png">
</ul>







<h4 class="compact">その他</h4>
<ul>
<li><a href="/web/20100712030912/http://ja.doukaku.org/qa/">Q&A</a>
<li><a href="/web/20100712030912/http://ja.doukaku.org/feedback/">フィードバック</a>
<!--<li><a href="/web/20100712030912/http://ja.doukaku.org/terms">用語集</a>-->
</ul>


<h4 class="compact">リンク</h4>
<ul>
<li><a href="/web/20100712030912/http://www.lingr.com/room/doukaku_ja">チャットルーム(Lingr)</a>
<li><a href="/web/20100712030912/http://labs.cybozu.co.jp/">サイボウズ・ラボ</a>
<li><a href="/web/20100712030912/http://www.djangoproject.com/">Django</a>
</ul>

<h4 id="pathtraq" class="compact"><a href="/web/20100712030912/http://pathtraq.com/analytics?url=http%3A%2F%2Fja.doukaku.org%2Fcomment%2F*%2F%20desc%3A%E3%81%A9%E3%81%86%E6%9B%B8%E3%81%8Forg&m=popular">Pathtraq</a></h4>
<div class="indent">
<span id="pathtraq_sentinel">loading...</span>
</div>


</div>
</div>


<div id="page_foot" class="bordered">

<a rel="license" href="/web/20100712030912/http://creativecommons.org/licenses/by/2.1/jp/">
<img alt="Creative Commons License" style="border-width:0" src="/web/20100712030912im_/http://i.creativecommons.org/l/by/2.1/jp/88x31.png" /></a>
このサイトの内容は、
<a rel="license" href="/web/20100712030912/http://creativecommons.org/licenses/by/2.1/jp/">クリエイティブ・コモンズ・ライセンス</a>の下でライセンスされています。
<a href="/web/20100712030912/http://ja.doukaku.org/qa/#licence">[詳細]</a>

</div>

</body>




<script type="text/javascript">
$(document).ready(function(){$("#doukaku_org").after("<script src='/web/20100712030912/http://api.pathtraq.com/pages?url=http%3A%2F%2Fja.doukaku.org%2Fcomment%2F*%2F%20desc%3A%E3%81%A9%E3%81%86%E6%9B%B8%E3%81%8Forg&api=json&callback=addPathtraq'><" + "/script>")});
</script>

<script src="/web/20100712030912js_/http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-2136157-1";
urchinTracker();
</script>




</html>





<!--
     FILE ARCHIVED ON 3:09:12 Jul 12, 2010 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 12:32:43 Nov 16, 2013.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
