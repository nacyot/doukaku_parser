
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja"> 
  <head>

<script type="text/javascript" src="/static/js/analytics.js" ></script>
<link type="text/css" rel="stylesheet" href="/static/css/banner-styles.css"/>




    <meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
    <title>
分散関数呼び出し
どう書く？org </title>

    <link rel="stylesheet" type="text/css"
	href="/web/20090404175547cs_/http://ja.doukaku.org/static/style/reset-fonts-grids.css" />
    <link rel="stylesheet" type="text/css"
	href="/web/20090404175547cs_/http://ja.doukaku.org/static/style/style.css?20071211?20071207" />
	
    <link rel="stylesheet" type="text/css"
	href="/web/20090404175547cs_/http://ja.doukaku.org/static/style/pygments.css" />


	
<meta name="robots" content="noindex,nofollow">

    <!--<script src="/web/20090404175547/http://ja.doukaku.org/static/js/ieerbug/ieerbug.js" type="text/javascript"></script>-->


<!--<script src="/web/20090404175547/http://ja.doukaku.org/static/js/ieerbug/ieerbug.js" type="text/javascript"></script>-->
<script src="/web/20090404175547js_/http://ja.doukaku.org/static/js/jquery-1.1.3.1.js" type="text/javascript"></script>
<script src="/web/20090404175547js_/http://ja.doukaku.org/static/js/rating.js" type="text/javascript"></script>
<script src="/web/20090404175547js_/http://ja.doukaku.org/static/js/addtag.js?20071129" type="text/javascript"></script>

<script type="text/javascript">
is_key_navigation_enable = true;
</script>
<script src="/web/20090404175547js_/http://ja.doukaku.org/static/js/utils.js?~~~" type="text/javascript"></script>

</head>


<body id="doukaku_org">
<!-- BEGIN WAYBACK TOOLBAR INSERT -->
<script> if (window.archive_analytics) { window.archive_analytics.values['server_name']="wwwb-app14.us.archive.org";}; </script>

<script type="text/javascript" src="/static/js/disclaim-element.js" ></script>
<script type="text/javascript" src="/static/js/graph-calc.js" ></script>
<script type="text/javascript" src="/static/jflot/jquery.min.js" ></script>
<script type="text/javascript">
//<![CDATA[
var firstDate = 820454400000;
var lastDate = 1388534399999;
var wbPrefix = "/web/";
var wbCurrentUrl = "http:\/\/ja.doukaku.org\/45\/flatten\/";

var curYear = -1;
var curMonth = -1;
var yearCount = 18;
var firstYear = 1996;
var imgWidth = 450;
var yearImgWidth = 25;
var monthImgWidth = 2;
var trackerVal = "none";
var displayDay = "4";
var displayMonth = "Apr";
var displayYear = "2009";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function showTrackers(val) {
	if(val == trackerVal) {
		return;
	}
	if(val == "inline") {
		document.getElementById("displayYearEl").style.color = "#ec008c";
		document.getElementById("displayMonthEl").style.color = "#ec008c";
		document.getElementById("displayDayEl").style.color = "#ec008c";		
	} else {
		document.getElementById("displayYearEl").innerHTML = displayYear;
		document.getElementById("displayYearEl").style.color = "#ff0";
		document.getElementById("displayMonthEl").innerHTML = displayMonth;
		document.getElementById("displayMonthEl").style.color = "#ff0";
		document.getElementById("displayDayEl").innerHTML = displayDay;
		document.getElementById("displayDayEl").style.color = "#ff0";
	}
   document.getElementById("wbMouseTrackYearImg").style.display = val;
   document.getElementById("wbMouseTrackMonthImg").style.display = val;
   trackerVal = val;
}
function getElementX2(obj) {
	var thing = jQuery(obj);
	if((thing == undefined) 
			|| (typeof thing == "undefined") 
			|| (typeof thing.offset == "undefined")) {
		return getElementX(obj);
	}
	return Math.round(thing.offset().left);
}
function trackMouseMove(event,element) {

   var eventX = getEventX(event);
   var elementX = getElementX2(element);
   var xOff = eventX - elementX;
	if(xOff < 0) {
		xOff = 0;
	} else if(xOff > imgWidth) {
		xOff = imgWidth;
	}
   var monthOff = xOff % yearImgWidth;

   var year = Math.floor(xOff / yearImgWidth);
	var yearStart = year * yearImgWidth;
   var monthOfYear = Math.floor(monthOff / monthImgWidth);
   if(monthOfYear > 11) {
       monthOfYear = 11;
   }
   // 1 extra border pixel at the left edge of the year:
   var month = (year * 12) + monthOfYear;
   var day = 1;
	if(monthOff % 2 == 1) {
		day = 15;
	}
	var dateString = 
		zeroPad(year + firstYear) + 
		zeroPad(monthOfYear+1,2) +
		zeroPad(day,2) + "000000";

	var monthString = prettyMonths[monthOfYear];
	document.getElementById("displayYearEl").innerHTML = year + 1996;
	document.getElementById("displayMonthEl").innerHTML = monthString;
	// looks too jarring when it changes..
	//document.getElementById("displayDayEl").innerHTML = zeroPad(day,2);

	var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
	document.getElementById('wm-graph-anchor').href = url;

   //document.getElementById("wmtbURL").value="evX("+eventX+") elX("+elementX+") xO("+xOff+") y("+year+") m("+month+") monthOff("+monthOff+") DS("+dateString+") Moy("+monthOfYear+") ms("+monthString+")";
   if(curYear != year) {
       var yrOff = year * yearImgWidth;
       document.getElementById("wbMouseTrackYearImg").style.left = yrOff + "px";
       curYear = year;
   }
   if(curMonth != month) {
       var mtOff = year + (month * monthImgWidth) + 1;
       document.getElementById("wbMouseTrackMonthImg").style.left = mtOff + "px";
       curMonth = month;
   }
}
//]]>
</script>

<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>
<div id="wm-ipp" lang="en" class="__wb_banner_div" style="display:none; position:relative;padding:0 5px;min-height:70px;min-width:800px">


<div id="wm-ipp-inside" class="__wb_banner_div" style="position:fixed;padding:0!important;margin:0!important;width:97%;min-width:780px;border:5px solid #000;border-top:none;background-image:url(/static/images/toolbar/wm_tb_bk_trns.png);text-align:center;-moz-box-shadow:1px 1px 3px #333;-webkit-box-shadow:1px 1px 3px #333;box-shadow:1px 1px 3px #333;font-size:11px!important;font-family:'Lucida Grande','Arial',sans-serif!important;">
   <table style="border-collapse:collapse;margin:0;padding:0;width:100%;"><tbody><tr>
   <td style="padding:10px;vertical-align:top;min-width:110px;">
   <a href="/web/" title="Wayback Machine home page" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0"/></a>
   </td>
   <td style="padding:0!important;text-align:center;vertical-align:top;width:100%;">

       <table style="border-collapse:collapse;margin:0 auto;padding:0;width:570px;"><tbody><tr>
       <td style="padding:3px 0;" colspan="2">
       <form target="_top" method="get" action="/web/form-submit.jsp" name="wmtb" id="wmtb" style="margin:0!important;padding:0!important;"><input type="text" name="url" id="wmtbURL" value="http://ja.doukaku.org/45/flatten/" style="width:400px;font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;" onfocus="javascript:this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20090404175547" /><input type="submit" value="Go" style="font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;margin-left:5px;width: inherit !important" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td style="vertical-align:bottom;padding:5px 0 0 0!important;" rowspan="2">
           <table style="border-collapse:collapse;width:110px;color:#99a;font-family:'Helvetica','Lucida Grande','Arial',sans-serif;"><tbody>
			
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr style="width:110px;height:16px;font-size:10px!important;">
           	<td style="padding-right:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20081120101818/http://ja.doukaku.org/45/flatten/" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="20 Nov 2008"><strong>NOV</strong></a>
		                
               </td>
               <td id="displayMonthEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight:bold;text-transform:uppercase;width:34px;height:15px;padding-top:1px;text-align:center;" title="You are here: 17:55:47 Apr 4, 2009">APR</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
                       May
                       
               </td>
           </tr>

           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr>
               <td style="padding-right:9px;white-space:nowrap;overflow:visible;text-align:right!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20081120101818/http://ja.doukaku.org/45/flatten/" title="10:18:18 Nov 20, 2008" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a>
		                
               </td>
               <td id="displayDayEl" style="background:#000;color:#ff0;width:34px;height:24px;padding:2px 0 0 0;text-align:center;font-size:24px;font-weight: bold;" title="You are here: 17:55:47 Apr 4, 2009">4</td>
				<td style="padding-left:9px;white-space:nowrap;overflow:visible;text-align:left!important;vertical-align:middle!important;" nowrap="nowrap">
               
                       <img src="/static/images/toolbar/wm_tb_nxt_off.png" alt="Next capture" width="14" height="16" border="0"/>
                       
			    </td>
           </tr>

           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr style="width:110px;height:13px;font-size:9px!important;">
				<td style="padding-right:9px;font-size:11px!important;font-weight: bold;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
                       2008
                       
               </td>
               <td id="displayYearEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight: bold;padding-top:1px;width:34px;height:13px;text-align:center;" title="You are here: 17:55:47 Apr 4, 2009">2009</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight: bold;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
                       2010
                       
				</td>
           </tr>
           </tbody></table>
       </td>

       </tr>
       <tr>
       <td style="vertical-align:middle;padding:0!important;">
           <a href="/web/20090404175547*/http://ja.doukaku.org/45/flatten/" style="color:#33f;font-size:11px;font-weight:bold;background-color:transparent;border:none;" title="See a list of every capture for this URL"><strong>2 captures</strong></a>
           <div class="__wb_banner_div" style="margin:0!important;padding:0!important;color:#666;font-size:9px;padding-top:2px!important;white-space:nowrap;" title="Timespan for captures of this URL">20 Nov 08 - 4 Apr 09</div>
       </td>
       <td style="padding:0!important;">
       <a style="position:relative; white-space:nowrap; width:450px;height:27px;" href="" id="wm-graph-anchor">
       <div class="__wb_banner_div" id="wm-ipp-sparkline" style="position:relative; white-space:nowrap; width:450px;height:27px;background-color:#fff;cursor:pointer;border-right:1px solid #ccc;" title="Explore captures for this URL">
			<img id="sparklineImgId" style="position:absolute; z-index:9012; top:0px; left:0px;"
				onmouseover="showTrackers('inline');" 
				onmouseout="showTrackers('none');"
				onmousemove="trackMouseMove(event,this)"
				alt="sparklines"
				width="450"
				height="27"
				border="0"
				src="/web/jsp/graph.jsp?graphdata=450_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000000000000_2004:-1:000000000000_2005:-1:000000000000_2006:-1:000000000000_2007:-1:000000000000_2008:-1:000000000010_2009:3:000100000000_2010:-1:000000000000_2011:-1:000000000000_2012:-1:000000000000_2013:-1:000000000000"></img>
			<img id="wbMouseTrackYearImg" 
				style="display:none; position:absolute; z-index:9010;"
				width="25" 
				height="27"
				border="0"
				src="/static/images/toolbar/transp-yellow-pixel.png"></img>
			<img id="wbMouseTrackMonthImg"
				style="display:none; position:absolute; z-index:9011; " 
				width="2"
				height="27" 
				border="0"
				src="/static/images/toolbar/transp-red-pixel.png"></img>
       </div>
		</a>

       </td>
       </tr></tbody></table>
   </td>
   <td style="text-align:right;padding:5px;width:65px;font-size:11px!important;">
       <a href="javascript:;" onclick="document.getElementById('wm-ipp').style.display='none';" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_close.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;margin-bottom:23px;background-color:transparent;border:none;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_help.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;background-color:transparent;border:none;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>

</div>
</div>
<script type="text/javascript">
 var wmDisclaimBanner = document.getElementById("wm-ipp");
 if(wmDisclaimBanner != null) {
   disclaimElement(wmDisclaimBanner);
 }
</script>
<!-- END WAYBACK TOOLBAR INSERT -->


<div id="page_head" class="compact">
  <h1 class="compact">
    <a href="/web/20090404175547/http://ja.doukaku.org/">どう書く？org</a><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/beta.png" alt="beta">
  </h1>
</div>

<div id="page_body" class="compact">
<div id="content" class="compact">




<h2 class="compact">
<img src='/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png' alt=お題(出題済み)>
<a href="/web/20090404175547/http://ja.doukaku.org/45/">分散関数呼び出し</a>
</h2>

    





<div class="comment" id="comment3401">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/101/" target="_top">沢渡 みかげ</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/3401/">#3401</a>(<script language="JavaScript">print_time(new Date("2007/08/15 23:17 GMT"));</script><noscript>2007/08/15 23:17 GMT</noscript>)
	
	
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content" >
	<div class="comment_body">
	  <pre class=box>
分散関数呼び出しを実装してください．

呼び出される関数は，定価を整数で，割引率(%)を整数で受け取り，
文字列で「販売価格 ○円（定価○円から○%引き）」を返すものとします．
また，数字は3桁のカンマ区切りにするものとします．

たとえば，pricestring(2000, 20) なら
"販売価格 1,600円 (定価2,000円から20%引き)"
を返します．

関数の呼び出し元と，呼び出される側は，物理的に異なる
サーバに配置できることを条件とします．
呼び出し方法は問いませんが，呼び出し方法に名前がある場合，
それをタグに加えてください．
（XML-RPC，SOAP，CORBA，RMI，など）

また，作成した関数を直列に1万回呼び出して，
実行にかかった時間を測定してください．
測定時は別サーバでなくても構いません．
（なるべく別サーバが望ましいです）

測定環境として，
・サーバとクライアントのCPU・メモリ
・同一サーバ内での実行か別サーバでの実行か
・別サーバの場合，通信経路．（100Mbps Ethernet等）
・言語のバージョン
・ミドルウェアを使用している場合，その名前とバージョン
も併記してください．

1つの言語で複数の分散関数呼び出しの実装方法がある場合，
複数の回答を歓迎します．

出題の意図は，様々な分散呼び出し方法の実装例と，
レスポンス速度の確認にあります．
</pre>
このお題は沢渡 みかげさんの投稿です。
まったく手を加えないでいい完成度の投稿で本当に助かります。
ありがとうございました。
	</div>
	
	
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/3401/addtag/" class="addtag" id="addtag_3401">タグ</a>:
	
	タグなし
	&nbsp;

	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_3401"
  >-</span><span
  class="button yellow"
  id="rating_z_3401"
  >0</span><span 
  class="button green"
  id="rating_p_3401"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/3401/">
  返信
  </a>]
  </div>
</div>
</div>




  



<div class="indent">
<a href="/web/20090404175547/http://ja.doukaku.org/45/post_comment/">
投稿する
</a>
</div>


<h2>投稿されたコメント - フラット表示</h2>
<a href="/web/20090404175547/http://ja.doukaku.org/45/nested/">ネスト表示</a>
<a href="/web/20090404175547/http://ja.doukaku.org/45/">非表示</a> 


  
  




<div class="comment" id="comment2205">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/172/" target="_top">cats</a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2205/">#2205</a>(<script language="JavaScript">print_time(new Date("2007/08/16 00:21 GMT"));</script><noscript>2007/08/16 00:21 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/csharp/">
	  C#
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #efffef;">1/1=1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>同一マシンのCoreDuo1.5GHz で1万回11秒</pre>
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></td><td class="code"><div class="highlight"><pre><span class="c">// サーバ</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Web.Services</span><span class="p">;</span>
<span class="na">[WebService(Namespace = &quot;http://tempuri.org/&quot;)]</span>
<span class="na">[WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">Service</span> <span class="p">:</span> <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">WebService</span>
<span class="k">{</span>
<span class="na">  [WebMethod]</span>
  <span class="k">public</span> <span class="kt">string</span> <span class="nf">Calc</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span> <span class="k">{</span>
    <span class="kt">int</span> <span class="n">p</span> <span class="p">=</span> <span class="n">n</span> <span class="p">*</span> <span class="p">(</span><span class="m">100</span> <span class="p">-</span> <span class="n">r</span><span class="p">)</span> <span class="p">/</span> <span class="m">100</span><span class="p">;</span>
    <span class="k">return</span> <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;販売価格 {0}円 (定価{1}円から{2}%引き)&quot;</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">ToString</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">).</span><span class="n">Substring</span><span class="p">(</span><span class="m">1</span><span class="p">),</span> <span class="n">n</span><span class="p">.</span><span class="n">ToString</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">).</span><span class="n">Substring</span><span class="p">(</span><span class="m">1</span><span class="p">),</span> <span class="n">r</span><span class="p">);</span>
  <span class="k">}</span>
<span class="k">}</span>

<span class="c">// クライアント</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Diagnostics</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">HowWrite.localhost</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">Program</span>
<span class="k">{</span>
  <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
  <span class="k">{</span>
    <span class="n">Service</span> <span class="n">srv</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Service</span><span class="p">();</span>
    <span class="n">Stopwatch</span> <span class="n">st</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Stopwatch</span><span class="p">();</span>
    <span class="n">st</span><span class="p">.</span><span class="n">Start</span><span class="p">();</span>
    <span class="kt">string</span> <span class="n">s</span> <span class="p">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">10000</span><span class="p">;</span> <span class="p">++</span><span class="n">i</span><span class="p">)</span> <span class="n">s</span> <span class="p">=</span> <span class="n">srv</span><span class="p">.</span><span class="n">Calc</span><span class="p">(</span><span class="m">2000</span><span class="p">,</span> <span class="m">20</span><span class="p">);</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
    <span class="n">st</span><span class="p">.</span><span class="n">Stop</span><span class="p">();</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">st</span><span class="p">.</span><span class="n">ElapsedMilliseconds</span> <span class="p">/</span> <span class="m">1000</span><span class="p">);</span>
  <span class="k">}</span>
<span class="k">}</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2205/addtag/" class="addtag" id="addtag_2205">タグ</a>:
	
	タグなし
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/csharp/">
		C#
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2205/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2205/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #efffef;"
  >1/1=1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2205"
  >-</span><span
  class="button yellow"
  id="rating_z_2205"
  >0</span><span 
  class="button green"
  id="rating_p_2205"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2205/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2206">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/41/" target="_top">shiro</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2206/">#2206</a>(<script language="JavaScript">print_time(new Date("2007/08/16 00:27 GMT"));</script><noscript>2007/08/16 00:27 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/scheme/">
	  Scheme
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #cfffcf;">3/3=1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>まずは一番乗り狙いで、最もナイーブな実装をば。
エラー処理や効率は考えていません。
eval-remotelyはリモートホストでインタプリタを起動して評価式を送り込みます。

実行例:
gosh&gt; (ref (run-sample "scherzo" 1) 1)
"販売価格 1,600円 (定価2,000円から20%引き)"

ベンチマーク (CPU Pen4 2GHz, メモリ2GB, ループバック使用、Gauche 0.8.11_pre1, ミドルウェア無し)
gosh&gt; (time (run-sample "scherzo" 10000) (values))
;(time (run-sample "scherzo" 10000) (values))
; real   5.247
; user   0.460
; sys    0.130
</pre>
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></td><td class="code"><div class="highlight"><pre><span class="c1">;; -*- coding: utf-8 -*-</span>
<span class="p">(</span><span class="nf">use</span> <span class="nv">gauche</span><span class="o">.</span><span class="nv">process</span><span class="p">)</span>
<span class="p">(</span><span class="nf">use</span> <span class="nv">srfi-1</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">eval-remotely</span> <span class="nv">host</span> <span class="nv">exprs</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">let1</span> <span class="nv">p</span> <span class="p">(</span><span class="nf">run-process</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">gosh</span> <span class="nv">-E</span> <span class="s">&quot;&#39;read-eval-print-loop #f #f #f values&#39;&quot;</span><span class="p">)</span>
                       <span class="nv">:host</span> <span class="nv">host</span> <span class="nv">:input</span> <span class="nv">:pipe</span> <span class="nv">:output</span> <span class="nv">:pipe</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">unwind-protect</span>
        <span class="p">(</span><span class="nf">map-in-order</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">expr</span><span class="p">)</span>
                      <span class="p">(</span><span class="nb">write </span><span class="nv">expr</span> <span class="p">(</span><span class="nf">process-input</span> <span class="nv">p</span><span class="p">))</span>
                      <span class="p">(</span><span class="nb">newline </span><span class="p">(</span><span class="nf">process-input</span> <span class="nv">p</span><span class="p">))</span>
                      <span class="p">(</span><span class="nb">read </span><span class="p">(</span><span class="nf">process-output</span> <span class="nv">p</span><span class="p">)))</span>
                    <span class="nv">exprs</span><span class="p">)</span>
      <span class="p">(</span><span class="k">begin </span><span class="p">(</span><span class="nb">close-output-port </span><span class="p">(</span><span class="nf">process-input</span> <span class="nv">p</span><span class="p">))</span>
             <span class="p">(</span><span class="nf">process-wait</span> <span class="nv">p</span><span class="p">)))))</span>

<span class="c1">;; 実行サンプル</span>
<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">run-sample</span> <span class="nv">host</span> <span class="nv">repeat</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">eval-remotely</span> <span class="nv">host</span>
                 <span class="o">`</span><span class="p">((</span><span class="k">define </span><span class="p">(</span><span class="nf">pricestring</span> <span class="err">価格</span> <span class="err">割引率</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">format</span> <span class="s">&quot;販売価格 ~:d円 (定価~:d円から~d%引き)&quot;</span>
                            <span class="p">(</span><span class="nf">round-&gt;exact</span> <span class="p">(</span><span class="nb">* </span><span class="err">価格</span> <span class="p">(</span><span class="nf">/</span><span class="o">.</span> <span class="p">(</span><span class="nb">- </span><span class="mi">100</span> <span class="err">割引率</span><span class="p">)</span> <span class="mi">100</span><span class="p">)))</span>
                            <span class="err">価格</span> <span class="err">割引率</span><span class="p">))</span>
                   <span class="o">,@</span><span class="p">(</span><span class="nf">make-list</span> <span class="nv">repeat</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">pricestring</span> <span class="mi">2000</span> <span class="mi">20</span><span class="p">)))</span>
                 <span class="p">))</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2206/addtag/" class="addtag" id="addtag_2206">タグ</a>:
	
	タグなし
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/scheme/">
		Scheme
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2206/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2206/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #cfffcf;"
  >3/3=1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2206"
  >-</span><span
  class="button yellow"
  id="rating_z_2206"
  >0</span><span 
  class="button green"
  id="rating_p_2206"
  >+</span></span></span>
  

<p>

  

  <a href="/web/20090404175547/http://ja.doukaku.org/comment/2206/">
    2
    replies
  </a>

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2206/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2208">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/166/" target="_top">ところてん</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2208/">#2208</a>(<script language="JavaScript">print_time(new Date("2007/08/16 00:31 GMT"));</script><noscript>2007/08/16 00:31 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/python/">
	  Python
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  とりあえずPython使ってCGIサーバを立てて見ました。<br/>http://blueeye.bne.jp:7777/cgi-bin/discount.py?2000&amp;33<br/><br/>↑のアドレスにアクセスすると、次のように帰ってきます。<br/>&gt;&nbsp;販売価格&nbsp;1340円（定価2000円から33%引き）<br/><br/>以下の記事を参考にしてHTTPサーバを走らせて、その上で下にあるコードを走らせています。<br/>http://coreblog.org/ats/python-de-cgi<br/><br/>今日一日くらい、鯖を立てておきますので遊びたい方はご自由に。<br/>スレッドプールもないようなHTTP鯖なので、それなりに遅いと思いますが、速度測定はそのうちやります。<br/>（ネットゲームのサーバが動いているので、正確な速度測定は難しいと思います）
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></td><td class="code"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#-------------------------以下サーバー側コード</span>
<span class="k">import</span> <span class="nn">sys</span>

<span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
    <span class="p">(</span><span class="n">price</span><span class="p">,</span><span class="n">discount</span><span class="p">)</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;&amp;&quot;</span><span class="p">)</span>
    <span class="n">price</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
    <span class="n">discount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">discount</span><span class="p">)</span>

    <span class="k">print</span> <span class="s">&quot;Content-Type: text/plain&quot;</span>
    <span class="k">print</span> <span class="s">&quot;&quot;</span>
    <span class="k">print</span> <span class="s">&quot;販売価格 </span><span class="si">%d</span><span class="s">円（定価</span><span class="si">%d</span><span class="s">円から</span><span class="si">%d%%</span><span class="s">引き）&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">price</span> <span class="o">*</span> <span class="p">(</span><span class="mf">100.0</span><span class="o">-</span><span class="n">discount</span><span class="p">)</span><span class="o">/</span><span class="mf">100.0</span> <span class="p">),</span> <span class="n">price</span><span class="p">,</span> <span class="n">discount</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Content-Type: text/plain&quot;</span>
    <span class="k">print</span> <span class="s">&quot;&quot;</span>
    <span class="k">print</span> <span class="s">&quot;引数エラー&quot;</span>


<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#------------------------以下呼び出し側コード</span>
<span class="k">import</span> <span class="nn">urllib</span>
<span class="k">def</span> <span class="nf">pricestring</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">discount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">&quot;http://blueeye.bne.jp:7777/cgi-bin/discount.py?</span><span class="si">%d</span><span class="s">&amp;</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">discount</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="k">print</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">pricestring</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span> <span class="s">&quot;utf8&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2208/addtag/" class="addtag" id="addtag_2208">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/CGI/">CGI</a>
    
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/python/">
		Python
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2208/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2208/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2208"
  >-</span><span
  class="button yellow"
  id="rating_z_2208"
  >0</span><span 
  class="button green"
  id="rating_p_2208"
  >+</span></span></span>
  

<p>

  

  <a href="/web/20090404175547/http://ja.doukaku.org/comment/2208/">
    1
    reply
  </a>

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2208/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2210">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/41/" target="_top">shiro</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2210/">#2210</a>(<script language="JavaScript">print_time(new Date("2007/08/16 00:42 GMT"));</script><noscript>2007/08/16 00:42 GMT</noscript>)
	
	
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  ああ、一番争いに敗れた…<br/>ちょっと追加説明です。<br/><br/>リモートサーバに必要なのは、sshの公開鍵認証でログインできることと、Gaucheがインストールされていることのみです。特別にサーバ側で別コードを走らせる必要はありません。<br/><br/>インターネット越しにベンチマークを取ってみました。ハワイからロサンゼルスにあるサーバを叩くと、1000回呼び出しで82秒でした。<br/><br/>
	</div>
	
	
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2210/addtag/" class="addtag" id="addtag_2210">タグ</a>:
	
	タグなし
	&nbsp;

	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2210"
  >-</span><span
  class="button yellow"
  id="rating_z_2210"
  >0</span><span 
  class="button green"
  id="rating_p_2210"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2206/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2210/root/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2210/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2214">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/166/" target="_top">ところてん</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2214/">#2214</a>(<script language="JavaScript">print_time(new Date("2007/08/16 01:02 GMT"));</script><noscript>2007/08/16 01:02 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/python/">
	  Python
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>何なんだこの遅さは。
直列で100回実験したら18秒強。
10個のスレッドで、並列に10回ずつ取りに行ったら6.5秒。

多分コンソール周りのPrintに時間食っているのかなぁ。
コンソールを表示しなければ、早くなるのか？
まぁ、裏でネットゲームの鯖が動いているところで、実験ってのが無茶な話ですが。

鯖のPCのスペックはこんな感じ。
Pen4 2.8GHz HT
RAM 512MB
OS XP
so-net ADSL12M線
ネットゲームのサーバプログラムがCPUパワーの80％を常時消費

測定したクライアントPC
sinetに接続されている某大学のPC
Pen4 3.2GHz HT
RAM 2GB
OS XP</pre>
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></td><td class="code"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="k">import</span> <span class="nn">urllib</span>
<span class="k">import</span> <span class="nn">time</span>
<span class="k">import</span> <span class="nn">threading</span>

<span class="k">def</span> <span class="nf">pricestring</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">discount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">&quot;http://blueeye.bne.jp:7777/cgi-bin/discount.py?</span><span class="si">%d</span><span class="s">&amp;</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">discount</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>


<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="k">print</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">pricestring</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span><span class="s">&quot;utf8&quot;</span><span class="p">)</span>

<span class="n">t2</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">TEST_THREAD</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">discount</span><span class="p">):</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">price</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discount</span> <span class="o">=</span> <span class="n">discount</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="k">print</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">pricestring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">price</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">discount</span> <span class="o">+</span> <span class="n">x</span><span class="p">),</span><span class="s">&quot;utf8&quot;</span><span class="p">)</span>

<span class="n">threadList</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">threadList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TEST_THREAD</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">1000</span> <span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
    <span class="n">threadList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">threadList</span><span class="p">:</span>
    <span class="n">t</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
       
<span class="n">t3</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="k">print</span> <span class="s">&quot;series time&quot;</span><span class="p">,</span><span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span>
<span class="k">print</span> <span class="s">&quot;pararells time&quot;</span><span class="p">,</span><span class="n">t3</span> <span class="o">-</span> <span class="n">t2</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2214/addtag/" class="addtag" id="addtag_2214">タグ</a>:
	
	タグなし
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/python/">
		Python
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2214/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2214/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2214"
  >-</span><span
  class="button yellow"
  id="rating_z_2214"
  >0</span><span 
  class="button green"
  id="rating_p_2214"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2208/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2214/root/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2214/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2217">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/4/" target="_top">匿名</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2217/">#2217</a>(<script language="JavaScript">print_time(new Date("2007/08/16 04:56 GMT"));</script><noscript>2007/08/16 04:56 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/python/">
	  Python
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #efffef;">1/1=1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>pythonの標準ライブラリに含まれているXML-RPCを
使ってみました。

とはいっても、参考にしたIBMのサイトに乗っているサンプル
そのもののような気がしないでもない。

実は数値のコンマ区切りの方が大変でした。

測定環境
　同一マシン上で実行
　Athlon XP 1700+ 512MB
　python 2.5

実行時間
　画面出力を行う　　　　64秒
　画面出力を行わない　　112秒
</pre>
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></td><td class="code"><div class="highlight"><pre><span class="c">#</span>
<span class="c"># server.py</span>
<span class="c">#</span>

<span class="c"># -*- coding: utf-8 -*-</span>

<span class="k">import</span> <span class="nn">SimpleXMLRPCServer</span>

<span class="k">class</span> <span class="nc">PliceString</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">plicestring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
      <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
      <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
      <span class="k">return</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="o">-</span><span class="n">n</span> <span class="ow">or</span> <span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="p">)])</span>
    <span class="k">return</span> <span class="s">&#39;販売価格 </span><span class="si">%s</span><span class="s">円 (定価</span><span class="si">%s</span><span class="s">円から</span><span class="si">%d%%</span><span class="s">引き)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">d</span><span class="o">*</span><span class="mf">0.01</span><span class="p">))),</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">d</span><span class="p">)</span>

<span class="n">ps</span> <span class="o">=</span> <span class="n">PliceString</span><span class="p">()</span>
<span class="n">sv</span> <span class="o">=</span> <span class="n">SimpleXMLRPCServer</span><span class="o">.</span><span class="n">SimpleXMLRPCServer</span><span class="p">((</span><span class="s">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">8888</span><span class="p">))</span>
<span class="n">sv</span><span class="o">.</span><span class="n">register_instance</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
<span class="n">sv</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>

<span class="c">#</span>
<span class="c"># client.py</span>
<span class="c">#</span>

<span class="c"># -*- coding: utf-8 -*-</span>

<span class="k">import</span> <span class="nn">xmlrpclib</span>
<span class="k">import</span> <span class="nn">time</span>

<span class="n">sv</span> <span class="o">=</span> <span class="n">xmlrpclib</span><span class="o">.</span><span class="n">ServerProxy</span><span class="p">(</span><span class="s">&#39;http://localhost:8888/&#39;</span><span class="p">)</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
  <span class="n">sv</span><span class="o">.</span><span class="n">plicestring</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="c">#  print sv.plicestring(2000, 20)</span>
<span class="k">print</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2217/addtag/" class="addtag" id="addtag_2217">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/XML-RPC/">XML-RPC</a>
    
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/python/">
		Python
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2217/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2217/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #efffef;"
  >1/1=1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2217"
  >-</span><span
  class="button yellow"
  id="rating_z_2217"
  >0</span><span 
  class="button green"
  id="rating_p_2217"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2217/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2223">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/105/" target="_top">rubikitch</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2223/">#2223</a>(<script language="JavaScript">print_time(new Date("2007/08/16 05:31 GMT"));</script><noscript>2007/08/16 05:31 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/ruby/">
	  Ruby
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #efffef;">1/1=1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>Rubyの分散処理の定番dRuby！
DRB_URIを書き換えることで別サーバでも可能。

まず
ruby 45.rb server
でサーバを立ち上げる。そのあと
ruby 45.rb
でクライアントの実行。

・呼び出し10000回にかかった時間 7.9秒
・サーバとクライアントのCPU・メモリ  Pentium4 2.66GHz / 1GB
・同一サーバ内での実行か別サーバでの実行か  同一サーバ
・言語のバージョン  Ruby 1.8.5
</pre>
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;drb&#39;</span>
<span class="no">DRB_URI</span> <span class="o">=</span> <span class="s2">&quot;druby://localhost:2323&quot;</span>

<span class="k">if</span> <span class="no">ARGV</span><span class="o">.</span><span class="n">first</span> <span class="o">==</span> <span class="s1">&#39;server&#39;</span>
  <span class="n">obj</span> <span class="o">=</span> <span class="no">Object</span><span class="o">.</span><span class="n">new</span>
  <span class="k">def</span> <span class="nc">obj</span><span class="o">.</span><span class="nf">pricestring</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">cut_rate</span><span class="p">)</span>
    <span class="n">comma</span> <span class="o">=</span> <span class="nb">lambda</span><span class="p">{</span><span class="o">|</span><span class="n">n</span><span class="o">|</span> <span class="n">n</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">reverse</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="sr">/\d{1,3}/</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reverse</span><span class="p">}</span>
    <span class="s2">&quot;販売価格 %s円 (定価%s円から%d%%引き)&quot;</span> <span class="o">%</span> <span class="o">[</span><span class="n">comma</span><span class="o">[</span><span class="n">price</span><span class="o">*</span><span class="p">(</span><span class="mi">100</span><span class="o">-</span><span class="n">cut_rate</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="o">]</span><span class="p">,</span> <span class="n">comma</span><span class="o">[</span><span class="n">price</span><span class="o">]</span><span class="p">,</span> <span class="n">cut_rate</span><span class="o">]</span>
  <span class="k">end</span>
  <span class="no">DRb</span><span class="o">.</span><span class="n">start_service</span> <span class="no">DRB_URI</span><span class="p">,</span> <span class="n">obj</span>
  <span class="no">DRb</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">join</span>

<span class="k">else</span>                            <span class="c1"># client</span>
  <span class="nb">require</span> <span class="s1">&#39;benchmark&#39;</span>
  <span class="no">DRb</span><span class="o">.</span><span class="n">start_service</span>
  <span class="n">obj</span> <span class="o">=</span> <span class="no">DRbObject</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="kp">nil</span><span class="p">,</span> <span class="no">DRB_URI</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="n">obj</span><span class="o">.</span><span class="n">pricestring</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="no">Benchmark</span><span class="o">.</span><span class="n">measure</span> <span class="p">{</span> <span class="mi">10000</span><span class="o">.</span><span class="n">times</span><span class="p">{</span> <span class="n">obj</span><span class="o">.</span><span class="n">pricestring</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>  <span class="p">}</span> <span class="p">}</span><span class="o">.</span><span class="n">real</span>
<span class="k">end</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2223/addtag/" class="addtag" id="addtag_2223">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/dRuby/">dRuby</a>
    
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/ruby/">
		Ruby
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2223/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2223/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #efffef;"
  >1/1=1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2223"
  >-</span><span
  class="button yellow"
  id="rating_z_2223"
  >0</span><span 
  class="button green"
  id="rating_p_2223"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2223/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2228">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/172/" target="_top">cats</a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2228/">#2228</a>(<script language="JavaScript">print_time(new Date("2007/08/16 09:02 GMT"));</script><noscript>2007/08/16 09:02 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/csharp/">
	  C#
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #efffef;">1/1=1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>.NET Remoting版
CoreDuo 1.5GHz の同一マシンで1万回2.7秒</pre>
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></td><td class="code"><div class="highlight"><pre><span class="c">// サーバ用</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">Server</span> <span class="p">:</span> <span class="n">MarshalByRefObject</span>
<span class="k">{</span>
  <span class="k">public</span> <span class="kt">string</span> <span class="nf">Calc</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">)</span>
  <span class="k">{</span>
    <span class="kt">int</span> <span class="n">p</span> <span class="p">=</span> <span class="n">n</span> <span class="p">*</span> <span class="p">(</span><span class="m">100</span> <span class="p">-</span> <span class="n">r</span><span class="p">)</span> <span class="p">/</span> <span class="m">100</span><span class="p">;</span>
    <span class="k">return</span> <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;販売価格 {0}円 (定価{1}円から{2}%引き)&quot;</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">ToString</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">).</span><span class="n">Substring</span><span class="p">(</span><span class="m">1</span><span class="p">),</span> <span class="n">n</span><span class="p">.</span><span class="n">ToString</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">).</span><span class="n">Substring</span><span class="p">(</span><span class="m">1</span><span class="p">),</span> <span class="n">r</span><span class="p">);</span>
  <span class="k">}</span>
<span class="k">}</span>
<span class="k">class</span> <span class="nc">Program</span>
<span class="k">{</span>
  <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
  <span class="k">{</span>
    <span class="n">System</span><span class="p">.</span><span class="n">Runtime</span><span class="p">.</span><span class="n">Remoting</span><span class="p">.</span><span class="n">Channels</span><span class="p">.</span><span class="n">ChannelServices</span><span class="p">.</span><span class="n">RegisterChannel</span><span class="p">(</span>
      <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Runtime</span><span class="p">.</span><span class="n">Remoting</span><span class="p">.</span><span class="n">Channels</span><span class="p">.</span><span class="n">Tcp</span><span class="p">.</span><span class="n">TcpChannel</span><span class="p">(</span><span class="m">50000</span><span class="p">),</span> <span class="k">false</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="n">Runtime</span><span class="p">.</span><span class="n">Remoting</span><span class="p">.</span><span class="n">RemotingConfiguration</span>
      <span class="p">.</span><span class="n">RegisterWellKnownServiceType</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Server</span><span class="p">),</span> <span class="s">&quot;HowWrite&quot;</span><span class="p">,</span>
      <span class="n">System</span><span class="p">.</span><span class="n">Runtime</span><span class="p">.</span><span class="n">Remoting</span><span class="p">.</span><span class="n">WellKnownObjectMode</span><span class="p">.</span><span class="n">Singleton</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="n">ReadKey</span><span class="p">();</span>
  <span class="k">}</span>
<span class="k">}</span>

<span class="c">// クライアント用</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Diagnostics</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">Program</span>
<span class="k">{</span>
  <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
  <span class="k">{</span>
    <span class="n">Server</span>  <span class="n">svr</span> <span class="p">=</span> <span class="p">(</span><span class="n">Server</span><span class="p">)</span><span class="n">Activator</span><span class="p">.</span><span class="n">GetObject</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Server</span><span class="p">),</span> 
      <span class="s">&quot;tcp://localhost:50000/HowWrite&quot;</span><span class="p">);</span>
    <span class="n">Stopwatch</span> <span class="n">st</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Stopwatch</span><span class="p">();</span>
    <span class="n">st</span><span class="p">.</span><span class="n">Start</span><span class="p">();</span>
    <span class="kt">string</span> <span class="n">s</span> <span class="p">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">10000</span><span class="p">;</span> <span class="p">++</span><span class="n">i</span><span class="p">)</span> <span class="n">s</span> <span class="p">=</span> <span class="n">svr</span><span class="p">.</span><span class="n">Calc</span><span class="p">(</span><span class="m">2000</span><span class="p">,</span> <span class="m">20</span><span class="p">);</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
    <span class="n">st</span><span class="p">.</span><span class="n">Stop</span><span class="p">();</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">st</span><span class="p">.</span><span class="n">ElapsedMilliseconds</span> <span class="p">/</span> <span class="m">1000.0</span><span class="p">);</span>
  <span class="k">}</span>
<span class="k">}</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2228/addtag/" class="addtag" id="addtag_2228">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/.NET_Remoting/">.NET_Remoting</a>
    
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/csharp/">
		C#
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2228/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2228/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #efffef;"
  >1/1=1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2228"
  >-</span><span
  class="button yellow"
  id="rating_z_2228"
  >0</span><span 
  class="button green"
  id="rating_p_2228"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2228/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2233">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/98/" target="_top">nobsun</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2233/">#2233</a>(<script language="JavaScript">print_time(new Date("2007/08/16 10:15 GMT"));</script><noscript>2007/08/16 10:15 GMT</noscript>)
	
	
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>うへぇー rum-process で host を指定できたんだぁ
すげぇーっ</pre>
	</div>
	
	
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2233/addtag/" class="addtag" id="addtag_2233">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/Gauche/">Gauche</a>
    
	&nbsp;

	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2233"
  >-</span><span
  class="button yellow"
  id="rating_z_2233"
  >0</span><span 
  class="button green"
  id="rating_p_2233"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2206/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2233/root/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2233/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2235">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/4/" target="_top">匿名</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2235/">#2235</a>(<script language="JavaScript">print_time(new Date("2007/08/16 14:13 GMT"));</script><noscript>2007/08/16 14:13 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/java/">
	  Java
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #efffef;">1/1=1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>RMIの実装です（Java 5ではrmic不要になっているのですね）。

一万回呼び出しにかかった時間：4782 ms
・サーバとクライアントのCPU・メモリ：PowerPC G4 1.67 GHz・メモリ 1GB
・同一サーバ内での実行か別サーバでの実行か：同一サーバ内
・言語のバージョン：Java HotSpot(TM) Client VM build 1.5.0_07-87
・ミドルウェアを使用している場合，その名前とバージョン：使用していない
</pre>
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></td><td class="code"><div class="highlight"><pre><span class="err">共通のインタフェース（</span><span class="n">Price</span><span class="o">.</span><span class="na">java</span><span class="err">）</span>

<span class="k">import</span> <span class="nn">java.rmi.Remote</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">java.rmi.RemoteException</span><span class="o">;</span>

<span class="k">public</span> <span class="k">interface</span> <span class="n">Price</span> <span class="k">extends</span> <span class="n">Remote</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">priceString</span><span class="o">(</span><span class="kt">int</span> <span class="n">price</span><span class="o">,</span> <span class="kt">int</span> <span class="n">discunt</span><span class="o">)</span> <span class="k">throws</span> <span class="n">RemoteException</span><span class="o">;</span>
<span class="o">}</span>


<span class="err">サーバ側実装（</span><span class="n">Server</span><span class="o">.</span><span class="na">java</span><span class="err">）</span>

<span class="k">import</span> <span class="nn">java.rmi.registry.*</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">java.rmi.server.*</span><span class="o">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Server</span> <span class="k">implements</span> <span class="n">Price</span> <span class="o">{</span>
    <span class="k">public</span> <span class="n">String</span> <span class="n">priceString</span><span class="o">(</span><span class="kt">int</span> <span class="n">price</span><span class="o">,</span> <span class="kt">int</span> <span class="n">discount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;販売価格 %,d円（定価 %,d円から %d%%引き）&quot;</span><span class="o">,</span> 
                <span class="o">(</span><span class="kt">int</span><span class="o">)(</span><span class="kt">double</span><span class="o">)</span><span class="n">price</span> <span class="o">*</span> <span class="o">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">discount</span><span class="o">)</span> <span class="o">/</span> <span class="mi">100</span><span class="o">,</span> <span class="n">price</span><span class="o">,</span> <span class="n">discount</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="k">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">Server</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="o">();</span>
        <span class="n">Price</span> <span class="n">stub</span> <span class="o">=</span> <span class="o">(</span><span class="n">Price</span><span class="o">)</span> <span class="n">UnicastRemoteObject</span><span class="o">.</span><span class="na">exportObject</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="n">Registry</span>  <span class="n">reg</span> <span class="o">=</span> <span class="n">LocateRegistry</span><span class="o">.</span><span class="na">getRegistry</span><span class="o">();</span>
        <span class="n">reg</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="s">&quot;Price&quot;</span><span class="o">,</span> <span class="n">stub</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>


<span class="err">クライアント側実装（</span><span class="n">Client</span><span class="o">.</span><span class="na">java</span><span class="err">）</span>

<span class="k">import</span> <span class="nn">java.rmi.registry.*</span><span class="o">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Client</span> <span class="o">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="k">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">host</span> <span class="o">=</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">)?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
        <span class="n">Registry</span> <span class="n">reg</span> <span class="o">=</span> <span class="n">LocateRegistry</span><span class="o">.</span><span class="na">getRegistry</span><span class="o">(</span><span class="n">host</span><span class="o">);</span>
        <span class="n">Price</span> <span class="n">stub</span> <span class="o">=</span> <span class="o">(</span><span class="n">Price</span><span class="o">)</span> <span class="n">reg</span><span class="o">.</span><span class="na">lookup</span><span class="o">(</span><span class="s">&quot;Price&quot;</span><span class="o">);</span>
        <span class="kt">long</span> <span class="n">now</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">stub</span><span class="o">.</span><span class="na">priceString</span><span class="o">(</span><span class="mi">1000</span><span class="o">,</span> <span class="mi">20</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;%d ms%n&quot;</span><span class="o">,</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">now</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2235/addtag/" class="addtag" id="addtag_2235">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/RMI/">RMI</a>
    
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/java/">
		Java
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2235/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2235/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #efffef;"
  >1/1=1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2235"
  >-</span><span
  class="button yellow"
  id="rating_z_2235"
  >0</span><span 
  class="button green"
  id="rating_p_2235"
  >+</span></span></span>
  

<p>

  

  <a href="/web/20090404175547/http://ja.doukaku.org/comment/2235/">
    1
    reply
  </a>

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2235/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2236">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/382/" target="_top">miyamuko</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_bronze.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2236/">#2236</a>(<script language="JavaScript">print_time(new Date("2007/08/16 14:29 GMT"));</script><noscript>2007/08/16 14:29 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/ruby/">
	  Ruby
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #efffef;">1/1=1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>Rinda で実装してみました。
まず、ruby ts.rb でタプルスペースを起動します。タプルスペースは黒板みたいなものです。
次に ruby server.rb でサーバを起動。
最後に ruby client.rb でクライアントを起動します。
server.rb と client.rb の起動順は逆でもokです。
server.rb を複数個起動することもできます。もちろん複数プロセスで処理しますし、途中から起動してもokです。
# でも全然スケールしないですけど。

・10000回の実行結果
 　・サーバ1プロセス: 1分 (CPU 使用率 60%ぐらい)
 　・サーバ2プロセス: 1分 (同上)
 　　全然スケールしない。。。
・Intel Core Duo 1.66GHz、メモリ1G
・同一サーバ
・ruby 1.8.6 (2007-03-13 patchlevel 0) [i386-mswin32]
</pre>
	</div>
	
	<p class="link">
	  参考: <a href="/web/20090404175547/http://www.druby.org/ilikeruby/d208.html"></a>
	</p>  
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></td><td class="code"><div class="highlight"><pre><span class="o">--[</span><span class="n">ts</span><span class="o">.</span><span class="n">rb</span><span class="o">]----------------------------------------</span>

<span class="nb">require</span> <span class="s1">&#39;rinda/tuplespace&#39;</span>

<span class="vg">$ts</span> <span class="o">=</span> <span class="no">Rinda</span><span class="o">::</span><span class="no">TupleSpace</span><span class="o">.</span><span class="n">new</span>
<span class="no">DRb</span><span class="o">.</span><span class="n">start_service</span><span class="p">(</span><span class="s1">&#39;druby://:1234&#39;</span><span class="p">,</span> <span class="vg">$ts</span><span class="p">)</span>
<span class="nb">puts</span> <span class="no">DRb</span><span class="o">.</span><span class="n">uri</span>
<span class="no">DRb</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">join</span>

<span class="o">--</span> <span class="o">[</span><span class="n">server</span><span class="o">.</span><span class="n">rb</span><span class="o">]</span> <span class="o">--------------------------------------</span>

<span class="nb">require</span> <span class="s1">&#39;rinda/tuplespace&#39;</span>

<span class="k">class</span> <span class="nc">Integer</span>
  <span class="k">def</span> <span class="nf">commaize</span>
    <span class="nb">to_s</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/(\d)(?=(?:\d\d\d)+(?!\d))/</span><span class="p">,</span> <span class="s1">&#39;\1,&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">pricestring</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">discount</span><span class="p">)</span>
  <span class="s2">&quot;販売価格 %s円 (定価%s円から%d%%引き)&quot;</span> <span class="o">%</span> <span class="o">[</span><span class="p">(</span><span class="n">price</span><span class="o">*</span><span class="p">(</span><span class="mi">100</span><span class="o">-</span><span class="n">discount</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">commaize</span><span class="p">,</span> <span class="n">price</span><span class="o">.</span><span class="n">commaize</span><span class="p">,</span> <span class="n">discount</span><span class="o">]</span>
<span class="k">end</span>

<span class="no">DRb</span><span class="o">.</span><span class="n">start_service</span>
<span class="vg">$ts</span> <span class="o">=</span> <span class="no">DRbObject</span><span class="o">.</span><span class="n">new_with_uri</span><span class="p">(</span><span class="s1">&#39;druby://localhost:1234&#39;</span><span class="p">)</span>
<span class="kp">loop</span> <span class="p">{</span>
  <span class="n">req</span> <span class="o">=</span> <span class="vg">$ts</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="o">[</span><span class="ss">:pricestring</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="o">]</span><span class="p">)</span>
  <span class="n">price</span><span class="p">,</span> <span class="n">discount</span> <span class="o">=</span> <span class="n">req</span><span class="o">[</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">2</span><span class="o">]</span>
  <span class="vg">$ts</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="o">[</span><span class="ss">:pricestring_result</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">discount</span><span class="p">,</span> <span class="n">pricestring</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">discount</span><span class="p">)</span><span class="o">]</span><span class="p">)</span>
  <span class="nb">print</span> <span class="s2">&quot;.&quot;</span>
<span class="p">}</span>

<span class="o">--</span> <span class="o">[</span><span class="n">client</span><span class="o">.</span><span class="n">rb</span><span class="o">]</span> <span class="o">---------------------------------------</span>

<span class="nb">require</span> <span class="s1">&#39;rinda/tuplespace&#39;</span>
<span class="nb">require</span> <span class="s2">&quot;benchmark&quot;</span>

<span class="no">DRb</span><span class="o">.</span><span class="n">start_service</span>
<span class="vg">$ts</span> <span class="o">=</span> <span class="no">DRbObject</span><span class="o">.</span><span class="n">new_with_uri</span><span class="p">(</span><span class="s1">&#39;druby://localhost:1234&#39;</span><span class="p">)</span>
<span class="nb">puts</span> <span class="no">Benchmark</span><span class="o">.</span><span class="n">measure</span> <span class="p">{</span>
  <span class="mi">10000</span><span class="o">.</span><span class="n">times</span> <span class="p">{</span>
    <span class="vg">$ts</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="o">[</span><span class="ss">:pricestring</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">20</span><span class="o">]</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="vg">$ts</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="o">[</span><span class="ss">:pricestring_result</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="kp">nil</span><span class="o">]</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s2">&quot;.&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2236/addtag/" class="addtag" id="addtag_2236">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/rinda/">rinda</a>
    
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/ruby/">
		Ruby
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2236/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2236/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #efffef;"
  >1/1=1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2236"
  >-</span><span
  class="button yellow"
  id="rating_z_2236"
  >0</span><span 
  class="button green"
  id="rating_p_2236"
  >+</span></span></span>
  

<p>

  

  <a href="/web/20090404175547/http://ja.doukaku.org/comment/2236/">
    1
    reply
  </a>

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2236/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2238">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/82/" target="_top">yuin</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_bronze.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2238/">#2238</a>(<script language="JavaScript">print_time(new Date("2007/08/16 15:35 GMT"));</script><noscript>2007/08/16 15:35 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/scala/">
	  Scala
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffdf;">0/2=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  
<p>ScalaでActorを使って。
</p>
<p>そもそも非同期に使うのがメインなものなので、同期でやるなんて初めてでした。!?とreplyを使うと同期でメッセージを送受信できます。
</p>
<p>が・・・直列で使うと遅いですね。
</p>
<ul>
 <li>
     CPU:Athlon 3000+
 </li>

 <li>
     RAM: 1G
 </li>

 <li>
     同一ホスト
 </li>
</ul>
<p>で21218 msでした。直列に呼び出すなら素直にRMI使ったほうがいいですね。
</p>



	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre></td><td class="code"><div class="highlight"><pre>import scala.actors._
import scala.actors.Actor._
import scala.actors.remote._
import scala.actors.remote.RemoteActor._
import java.io.ByteArrayOutputStream

val PORT = 9010

if(args.length&gt;0 &amp;&amp; args(0) == &quot;server&quot;) {
//server side

  println(&quot;server:start&quot;)
  actor {
    alive(PORT)
    register(&#39;pricestring, self)
    loop {
      react{ 
        case (price:int, p:int) =&gt; 
          val s = new ByteArrayOutputStream
          Console.withOut[unit](s){
            printf(&quot;\u8ca9\u58f2\u4fa1\u683c {0}\u5186\uff08\u5b9a\u4fa1{1}\u5186\u304b\u3089{2}%\u5f15\u304d\uff09&quot;,
              (price*(1-p.toFloat/100)).ceil, price, p)
          }
          reply(s.toString)
      }
    }
  }

}else {
//client side

  val clientActor = actor {
    val c = select(Node(&quot;127.0.0.1&quot;, PORT), &#39;pricestring)
    loop {
      react {
        case r@(i:int,j:int) =&gt; reply((c!?r))
      }
    }
  }

  import scala.testing.Benchmark
  val test = new Benchmark {
    def run:unit = {
      var i = -1;while({i= i+1; i&lt;10000}) {
        clientActor !? ((2000, 20))
      }
      return ()
    }
  }
  println(test.runBenchmark(1)(0)+&quot; ms&quot;)
  System.exit(0)
}
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2238/addtag/" class="addtag" id="addtag_2238">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/rolcaol/">rolcaol</a>
    
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/scala/">
		Scala
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2238/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2238/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffdf;"
  >0/2=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2238"
  >-</span><span
  class="button yellow"
  id="rating_z_2238"
  >0</span><span 
  class="button green"
  id="rating_p_2238"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2238/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2239">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/101/" target="_top">沢渡 みかげ</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2239/">#2239</a>(<script language="JavaScript">print_time(new Date("2007/08/16 15:43 GMT"));</script><noscript>2007/08/16 15:43 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/erlang/">
	  Erlang
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #dfffdf;">2/2=1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>普通にErlangのプロセス間通信を使って実装してみました．
夏休み中なのでとりあえず自宅マシンで測定．

・Intel(R) Xeon(R) CPU 5130  @ 2.00GHz
・同一サーバ内
・Erlang 5.5.4

で 1.04秒くらいでした．

Erlangのプロセス間通信は関数呼び出しの形になっていないので，
呼び出し側が引数をメッセージで送り，
それを受け取ったサーバが呼び出し側に戻値をメッセージで
送り返す形で実装しています．


サーバ側
&gt; erl -noshell -name server@127.0.0.1 -s rcall_s start


クライアント側
&gt; time erl -noshell -name client@127.0.0.1 -s rcall_c main -s init stop
remote pid &lt;4053.36.0&gt;
ret = bench_ok
1.044240 sec.

real    0m2.352s
user    0m0.908s
sys     0m0.156s
</pre>
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64</pre></td><td class="code"><div class="highlight"><pre>==== rcall_s.erl

-module(rcall_s).
-export([start/0, init/0]).

start() -&gt;
  proc_lib:start(?MODULE, init, []),
  ok.

init() -&gt;
  global:register_name(calc, self()),
  proc_lib:init_ack(ok),
  loop().

loop() -&gt;
  receive
    {From, Price, Discount} -&gt;
      From ! calc(Price, Discount)
  end,
  loop().


calc(Price, Discount) -&gt;
  lists:flatten(io_lib:format(&quot;販売価格 ~s円（定価~s円から~w%引き）&quot;,
    [comma(Price * (100-Discount) div 100), comma(Price), Discount])).


comma([N1, N2, N3, N4 | RestN], Acc) -&gt;
  comma([N4 | RestN], [&quot;,&quot;, N3, N2, N1 | Acc]);
comma(RestN, Acc) -&gt;
  lists:flatten([lists:reverse(RestN), Acc]).

comma(N) when is_integer(N) -&gt;
  comma(lists:reverse(integer_to_list(N)), []).


==== rcall_c.erl

-module(rcall_c).
-export([main/0, bench/2]).

main() -&gt;
  init(),
  Pid = global:whereis_name(calc),
  io:format(&quot;remote pid ~w~n&quot;, [Pid]),
  {Time, Value} = timer:tc(?MODULE, bench, [Pid, 10000]),
  io:format(&quot;ret = ~w~n~f sec.~n&quot;, [Value, Time/1000000]).

init() -&gt;
  net_adm:ping(&#39;server@127.0.0.1&#39;),
  global:sync().
  % すぐにglobalnameが反映されないので，
  % pingしたあとsyncしてから利用する

bench(_, 0) -&gt;
  bench_ok;
bench(Pid, N) -&gt;
  % 送信元のPIDを知らせないと送り返せない
  Pid ! {self(), 2000, 20},
  receive
    _RetValue -&gt;
      ok
  end,
  bench(Pid, N-1).
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2239/addtag/" class="addtag" id="addtag_2239">タグ</a>:
	
	タグなし
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/erlang/">
		Erlang
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2239/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2239/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #dfffdf;"
  >2/2=1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2239"
  >-</span><span
  class="button yellow"
  id="rating_z_2239"
  >0</span><span 
  class="button green"
  id="rating_p_2239"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2239/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2240">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/25/" target="_top">hamano</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_silver.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2240/">#2240</a>(<script language="JavaScript">print_time(new Date("2007/08/16 16:31 GMT"));</script><noscript>2007/08/16 16:31 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/c/">
	  C
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #efffef;">1/1=1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>C言語 + libxmlrpc（サーバーは apache 経由のCGI)で実装しました。
サーバーサイドのスペック
* Celeron 1.3GHz
* メモリ1G
* xmlrpc-c-1.11.00
11.285 秒でした

最初はシリアルに問い合わせてみたのですが目も当てられないぐらい遅かったので非同期dで 100発 × 100回 というようにパラレルに問い合わせるようにしました。
あとは apache のチューニングでもう少し早くなりそうです。(prefork だったので)</pre>
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89</pre></td><td class="code"><div class="highlight"><pre><span class="c">/* サーバー側 CGIコード */</span>
<span class="cp">#include&lt;stdio.h&gt;</span>
<span class="cp">#include&lt;stdlib.h&gt;</span>
<span class="cp">#include&lt;string.h&gt;</span>
<span class="cp">#include&lt;xmlrpc.h&gt;</span>
<span class="cp">#include&lt;xmlrpc_cgi.h&gt;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">int2cstr</span><span class="p">(</span><span class="kt">int</span> <span class="n">num</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
    <span class="n">size_t</span> <span class="n">len</span><span class="p">;</span>
    <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="n">num</span><span class="p">);</span>
    <span class="n">len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">str</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">len</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">len</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">str</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;,&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">str</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">xmlrpc_value</span> <span class="o">*</span><span class="nf">pricestring</span><span class="p">(</span><span class="n">xmlrpc_env</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span> <span class="n">xmlrpc_value</span> <span class="o">*</span><span class="n">param_array</span><span class="p">,</span>
                                 <span class="kt">void</span> <span class="o">*</span><span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">xmlrpc_int32</span> <span class="n">price</span><span class="p">,</span> <span class="n">discount</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">value</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">str</span><span class="p">[</span><span class="mi">256</span><span class="p">],</span> <span class="n">value_str</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">price_str</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>

    <span class="n">xmlrpc_parse_value</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">param_array</span><span class="p">,</span> <span class="s">&quot;(ii)&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">price</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">discount</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">env</span><span class="o">-&gt;</span><span class="n">fault_occurred</span><span class="p">)</span> <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">price</span> <span class="o">-</span> <span class="p">(</span><span class="n">price</span> <span class="o">*</span> <span class="n">discount</span> <span class="o">/</span> <span class="mi">100</span><span class="p">);</span>

    <span class="n">int2cstr</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">price_str</span><span class="p">);</span>
    <span class="n">int2cstr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value_str</span><span class="p">);</span>
    <span class="n">snprintf</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">str</span><span class="p">),</span>
             <span class="s">&quot;販売価格 %s円 (定価%s円から%d%引き)&quot;</span><span class="p">,</span>
             <span class="n">value_str</span><span class="p">,</span> <span class="n">price_str</span><span class="p">,</span> <span class="n">discount</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">xmlrpc_build_value</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s">&quot;s&quot;</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">xmlrpc_cgi_init</span><span class="p">(</span><span class="n">XMLRPC_CGI_NO_FLAGS</span><span class="p">);</span>
    <span class="n">xmlrpc_cgi_add_method_w_doc</span><span class="p">(</span><span class="s">&quot;pricestring&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pricestring</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                                <span class="s">&quot;s:ii&quot;</span><span class="p">,</span> <span class="s">&quot;Add two integers.&quot;</span><span class="p">);</span>
    <span class="n">xmlrpc_cgi_process_call</span><span class="p">();</span>
    <span class="n">xmlrpc_cgi_cleanup</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>
<span class="p">}</span>

<span class="c">/* クライアント側コード */</span>
<span class="cp">#include &lt;stdio.h&gt;</span>
<span class="cp">#include &lt;stdlib.h&gt;</span>
<span class="cp">#include &lt;xmlrpc.h&gt;</span>
<span class="cp">#include &lt;xmlrpc_client.h&gt;</span>

<span class="cp">#define XMLRPC_URL &quot;http:</span><span class="c">//192.168.0.13/pricestring.cgi&quot;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">print_state_name_callback</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">server_url</span><span class="p">,</span>
                       <span class="kt">char</span> <span class="o">*</span><span class="n">method_name</span><span class="p">,</span>
                       <span class="n">xmlrpc_value</span> <span class="o">*</span><span class="n">param_array</span><span class="p">,</span>
                       <span class="kt">void</span> <span class="o">*</span><span class="n">user_data</span><span class="p">,</span>
                       <span class="n">xmlrpc_env</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span>
                       <span class="n">xmlrpc_value</span> <span class="o">*</span><span class="n">result</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">env</span><span class="o">-&gt;</span><span class="n">fault_occurred</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="n">xmlrpc_parse_value</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="s">&quot;s&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">str</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">env</span><span class="o">-&gt;</span><span class="n">fault_occurred</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
    
    <span class="n">xmlrpc_client_init</span><span class="p">(</span><span class="n">XMLRPC_CLIENT_NO_FLAGS</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">){</span>
            <span class="n">xmlrpc_client_call_asynch</span><span class="p">(</span><span class="n">XMLRPC_URL</span><span class="p">,</span> <span class="s">&quot;pricestring&quot;</span><span class="p">,</span>
                                      <span class="n">print_state_name_callback</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                                      <span class="s">&quot;(ii)&quot;</span><span class="p">,</span>
                                      <span class="p">(</span><span class="n">xmlrpc_int32</span><span class="p">)</span><span class="mi">2000</span><span class="p">,</span> <span class="p">(</span><span class="n">xmlrpc_int32</span><span class="p">)</span><span class="mi">20</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">xmlrpc_client_event_loop_finish_asynch</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="n">xmlrpc_client_cleanup</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2240/addtag/" class="addtag" id="addtag_2240">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/XML-RPC/">XML-RPC</a>
    
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/c/">
		C
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2240/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2240/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #efffef;"
  >1/1=1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2240"
  >-</span><span
  class="button yellow"
  id="rating_z_2240"
  >0</span><span 
  class="button green"
  id="rating_p_2240"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2240/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2241">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/98/" target="_top">nobsun</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2241/">#2241</a>(<script language="JavaScript">print_time(new Date("2007/08/16 17:17 GMT"));</script><noscript>2007/08/16 17:17 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/haskell/">
	  Haskell
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #efffef;">1/1=1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>Gaucheのコードを見て思いついた。
サーバー側の  ghci を ssh で起こす。
自宅のクライアントプログラムからインターネットにあるサーバーへアクセスして
pricestring を 10000回実行、結果の文字列10000行をプログラムで受けとる。 </pre>
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre></td><td class="code"><div class="highlight"><pre><span class="c1">-- サーバー側 pricestring.hs</span>

<span class="kr">import</span> <span class="nv">qualified</span> <span class="n">Data</span><span class="o">.</span><span class="n">UTF8</span> <span class="nv">as</span> <span class="n">U</span>
<span class="kr">import</span> <span class="n">Data</span><span class="o">.</span><span class="n">List</span>

<span class="nv">pricestring</span> <span class="o">::</span> <span class="n">Int</span> <span class="o">-&gt;</span> <span class="n">Int</span> <span class="o">-&gt;</span> <span class="n">String</span>
<span class="nv">pricestring</span> <span class="nv">x</span> <span class="nv">y</span> <span class="o">=</span> <span class="s">&quot;販売価格 &quot;</span><span class="o">++</span><span class="nv">h</span><span class="o">++</span><span class="s">&quot; 円 (定価 &quot;</span><span class="o">++</span><span class="nv">t</span><span class="o">++</span><span class="s">&quot; 円から &quot;</span><span class="o">++</span><span class="nv">r</span><span class="o">++</span><span class="s">&quot; %引き)&quot;</span>
  <span class="kr">where</span>  <span class="nv">h</span> <span class="o">=</span> <span class="nv">comint</span> <span class="p">(</span><span class="nv">x</span><span class="o">*</span><span class="p">(</span><span class="mi">100</span><span class="o">-</span><span class="nv">y</span><span class="p">)</span> <span class="p">`</span><span class="nv">div</span><span class="p">`</span> <span class="mi">100</span><span class="p">)</span>
         <span class="nv">t</span> <span class="o">=</span> <span class="nv">comint</span> <span class="nv">x</span> 
         <span class="nv">r</span> <span class="o">=</span> <span class="nv">comint</span> <span class="nv">y</span>

<span class="nv">comint</span> <span class="o">::</span> <span class="n">Int</span> <span class="o">-&gt;</span> <span class="n">String</span>
<span class="nv">comint</span> <span class="o">=</span> <span class="nv">reverse</span> <span class="o">.</span> <span class="nv">concat</span> <span class="o">.</span> <span class="nv">intersperse</span> <span class="s">&quot;,&quot;</span> <span class="o">.</span> <span class="nv">slice</span> <span class="mi">3</span> <span class="o">.</span> <span class="nv">reverse</span> <span class="o">.</span> <span class="nv">show</span>

<span class="nv">slice</span> <span class="o">::</span> <span class="n">Int</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nv">a</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[[</span><span class="nv">a</span><span class="p">]]</span>
<span class="nv">slice</span> <span class="nv">n</span> <span class="o">=</span> <span class="nv">unfoldr</span> <span class="nv">phi</span>
   <span class="kr">where</span> <span class="nv">phi</span> <span class="p">[]</span> <span class="o">=</span> <span class="n">Nothing</span>
         <span class="nv">phi</span> <span class="nv">xs</span> <span class="o">=</span> <span class="n">Just</span> <span class="o">$</span> <span class="nv">splitAt</span> <span class="nv">n</span> <span class="nv">xs</span>

<span class="c1">-- クライアント側</span>

<span class="kr">module</span> <span class="n">Main</span> <span class="p">(</span><span class="nv">main</span><span class="p">)</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="n">Data</span><span class="o">.</span><span class="n">List</span>
<span class="kr">import</span> <span class="n">Data</span><span class="o">.</span><span class="n">Char</span>
<span class="kr">import</span> <span class="nv">qualified</span> <span class="n">Data</span><span class="o">.</span><span class="n">UTF8</span> <span class="nv">as</span> <span class="n">U</span>
<span class="kr">import</span> <span class="n">System</span><span class="o">.</span><span class="n">IO</span>
<span class="kr">import</span> <span class="n">System</span><span class="o">.</span><span class="n">Process</span>

<span class="nv">remote</span> <span class="o">=</span> <span class="s">&quot;foo.example.org&quot;</span>

<span class="nv">main</span> <span class="o">::</span> <span class="n">IO</span> <span class="p">()</span>
<span class="nv">main</span> <span class="o">=</span> <span class="kr">do</span> <span class="p">{</span> <span class="p">(</span><span class="nv">i</span><span class="p">,</span><span class="nv">o</span><span class="p">,</span><span class="nv">e</span><span class="p">,</span><span class="nv">p</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nv">runInteractiveCommand</span> <span class="s">&quot;ssh &quot;</span><span class="o">++</span><span class="nv">host</span><span class="o">++</span><span class="s">&quot; ghci -v0 pricestring.hs&quot;</span>
          <span class="p">;</span> <span class="nv">cs</span> <span class="o">&lt;-</span> <span class="nv">hGetContents</span> <span class="nv">o</span>
          <span class="p">;</span> <span class="nv">es</span> <span class="o">&lt;-</span> <span class="nv">hGetContents</span> <span class="nv">e</span>
          <span class="p">;</span> <span class="nv">hPutStrLn</span> <span class="nv">i</span> <span class="s">&quot;U.putStr $ unlines $ map (uncurry pricestring) $ replicate 10000 (2000,20)&quot;</span>
          <span class="p">;</span> <span class="nv">hFlush</span> <span class="nv">i</span>
          <span class="p">;</span> <span class="nv">hPutStrLn</span> <span class="nv">i</span> <span class="s">&quot;:q&quot;</span>
          <span class="p">;</span> <span class="nv">hFlush</span> <span class="nv">i</span>
          <span class="p">;</span> <span class="nv">putStr</span> <span class="nv">cs</span>
          <span class="p">;</span> <span class="nv">putStr</span> <span class="nv">es</span>
          <span class="p">}</span>

<span class="nv">loop0</span> <span class="nv">h</span> <span class="o">=</span> <span class="kr">do</span> <span class="p">{</span> <span class="nv">l</span> <span class="o">&lt;-</span> <span class="nv">getLine</span>
            <span class="p">;</span> <span class="kr">if</span> <span class="s">&quot;&gt; &quot;</span> <span class="p">`</span><span class="nv">isSuffixOf</span><span class="p">`</span> <span class="nv">l</span> <span class="kr">then</span> <span class="nv">return</span> <span class="p">()</span>
              <span class="kr">else</span> <span class="nv">loop0</span> <span class="nv">h</span>
            <span class="p">}</span>

<span class="c1">--</span>
<span class="cm">{-</span>
<span class="cm">*Main&gt; :main</span>
<span class="cm">販売価格 1,600 円 (定価 2,000 円から 20 %引き)</span>
<span class="cm">販売価格 1,600 円 (定価 2,000 円から 20 %引き)</span>
<span class="cm">販売価格 1,600 円 (定価 2,000 円から 20 %引き)</span>
<span class="cm">...</span>
<span class="cm">... 結果が10000行</span>
<span class="cm">...</span>
<span class="cm">(1.04 secs, 183701028 bytes)</span>
<span class="cm">-}</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2241/addtag/" class="addtag" id="addtag_2241">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/ghci/">ghci</a>
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/ssh/">ssh</a>
    
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/haskell/">
		Haskell
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2241/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2241/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #efffef;"
  >1/1=1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2241"
  >-</span><span
  class="button yellow"
  id="rating_z_2241"
  >0</span><span 
  class="button green"
  id="rating_p_2241"
  >+</span></span></span>
  

<p>

  

  <a href="/web/20090404175547/http://ja.doukaku.org/comment/2241/">
    2
    replies
  </a>

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2241/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2242">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/98/" target="_top">nobsun</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2242/">#2242</a>(<script language="JavaScript">print_time(new Date("2007/08/16 17:20 GMT"));</script><noscript>2007/08/16 17:20 GMT</noscript>)
	
	
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>あれ？、コードのインデントが変になっちゃった。</pre>
	</div>
	
	
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2242/addtag/" class="addtag" id="addtag_2242">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/%E3%82%A4%E3%83%B3%E3%83%87%E3%83%B3%E3%83%88/">インデント</a>
    
	&nbsp;

	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2242"
  >-</span><span
  class="button yellow"
  id="rating_z_2242"
  >0</span><span 
  class="button green"
  id="rating_p_2242"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2241/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2242/root/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  <a href="/web/20090404175547/http://ja.doukaku.org/comment/2242/">
    1
    reply
  </a>

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2242/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2243">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/382/" target="_top">miyamuko</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_bronze.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2243/">#2243</a>(<script language="JavaScript">print_time(new Date("2007/08/16 18:36 GMT"));</script><noscript>2007/08/16 18:36 GMT</noscript>)
	
	
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>よくよく考えると、このコードだと
以下のような処理がシーケンシャルに
行われるのでスケールしなくて当然ですね。

1. client が [:pricestring, ...] を write
2. client が [:pricestring_result] を take
3. server が [:pricestring, ...] をtake して処理
4. server が [:pricestring_result, ] を write
5. client の [:pricestring_result] の take が帰ってくる
6. 1 にもどる


で、処理を変えて client の [:pricestring] を write する処理と 
[:pricestring_result] を take する処理を
別プロセスにしてみたけど、大して変わらなかった。。。
</pre>
	</div>
	
	
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2243/addtag/" class="addtag" id="addtag_2243">タグ</a>:
	
	タグなし
	&nbsp;

	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2243"
  >-</span><span
  class="button yellow"
  id="rating_z_2243"
  >0</span><span 
  class="button green"
  id="rating_p_2243"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2236/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2243/root/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2243/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2246">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/4/" target="_top">匿名</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2246/">#2246</a>(<script language="JavaScript">print_time(new Date("2007/08/17 03:10 GMT"));</script><noscript>2007/08/17 03:10 GMT</noscript>)
	
	
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>別CPUのマシンで試してみました。

一万回呼び出しにかかった時間：1606 ms
・サーバとクライアントのCPU・メモリ： Intel Pentium M processor 1.60GHz・メモリ 2GB
・同一サーバ内での実行か別サーバでの実行か：同一サーバ内
・言語のバージョン：Java HotSpot(TM) Client VM build 1.6.0_02-b06
・ミドルウェアを使用している場合，その名前とバージョン：使用していない</pre>
	</div>
	
	
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2246/addtag/" class="addtag" id="addtag_2246">タグ</a>:
	
	タグなし
	&nbsp;

	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2246"
  >-</span><span
  class="button yellow"
  id="rating_z_2246"
  >0</span><span 
  class="button green"
  id="rating_p_2246"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2235/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2246/root/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2246/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2247">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/1/" target="_top">にしお</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2247/">#2247</a>(<script language="JavaScript">print_time(new Date("2007/08/17 04:21 GMT"));</script><noscript>2007/08/17 04:21 GMT</noscript>)
	
	
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>直しておきました。

原因は部分的にタブ文字が混ざっていたことでした。
どう書くorgではタブ文字をスペース4個で表示しているので、
8スペースの環境でタブとスペースの混在したコードを作ると
タブの所だけへこむことになります。</pre>
	</div>
	
	
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2247/addtag/" class="addtag" id="addtag_2247">タグ</a>:
	
	タグなし
	&nbsp;

	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2247"
  >-</span><span
  class="button yellow"
  id="rating_z_2247"
  >0</span><span 
  class="button green"
  id="rating_p_2247"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2242/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2247/root/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2247/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2248">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/98/" target="_top">nobsun</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2248/">#2248</a>(<script language="JavaScript">print_time(new Date("2007/08/17 04:27 GMT"));</script><noscript>2007/08/17 04:27 GMT</noscript>)
	
	
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>測定結果と環境を書きわすれていました．

測定
% time runhaskell rpc.hs 
...10000行の出力...
runhaskell rpc.hs  0.93s user 0.47s system 12% cpu 10.790 total

通信
  下り 8Mbps (best effort) の回線でインターネット接続
サーバー
  CPU    : AMD Sempron 2600+ 1.61 GHz 
  メモリ : 500MB
  言語   : ghc-6.6
クライアント
  CPU    : Intel Pentium M 2.13 GHz
  メモリ : 2GB
  言語   : ghc-6.6.1
ミドルウェア
  ssh
</pre>
	</div>
	
	
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2248/addtag/" class="addtag" id="addtag_2248">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/ghci/">ghci</a>
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/ssh/">ssh</a>
    
	&nbsp;

	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2248"
  >-</span><span
  class="button yellow"
  id="rating_z_2248"
  >0</span><span 
  class="button green"
  id="rating_p_2248"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2241/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2248/root/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2248/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2262">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/316/" target="_top">theoria</a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2262/">#2262</a>(<script language="JavaScript">print_time(new Date("2007/08/17 07:37 GMT"));</script><noscript>2007/08/17 07:37 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/scheme/">
	  Scheme
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  Shiro&nbsp;さんの実装に対抗して速度重視のものを書いてみました。ソケットによって、二つの引数を渡しているだけですが、&nbsp;RPC&nbsp;ということにしておきます。実験的なコードなので、安全性は考えていません。ソケットを閉じてさえいません。<br/><br/>実行速度はやはり速く、&nbsp;Celeron&nbsp;2GHz&nbsp;のマシン(同一)で、&nbsp;/dev/null&nbsp;&nbsp;に出力したもので、大体3秒程度でした。実行結果は以下のような感じ。<br/><br/>theo-desktop%&nbsp;cd&nbsp;workspace/doukaku&nbsp;<br/>theo-desktop%&nbsp;./rpc-server.scm&amp;<br/>[1]&nbsp;22494<br/>theo-desktop%&nbsp;./rpc-client.scm<br/>#&nbsp;一万行の出力を省略<br/>;(time&nbsp;(dotimes&nbsp;(i&nbsp;*call-times*)&nbsp;(format&nbsp;out&nbsp;"~d&nbsp;~d\n"&nbsp;(u16vector-ref&nbsp;nv&nbsp;...<br/>;&nbsp;real&nbsp;&nbsp;29.516<br/>;&nbsp;user&nbsp;&nbsp;&nbsp;1.170<br/>;&nbsp;sys&nbsp;&nbsp;&nbsp;&nbsp;1.100<br/>theo-desktop%&nbsp;<br/>[1]&nbsp;&nbsp;+&nbsp;done&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;./rpc-server.scm<br/>theo-desktop%&nbsp;./rpc-server.scm&amp;<br/>[1]&nbsp;22499<br/>theo-desktop%&nbsp;./rpc-client.scm&gt;/dev/null&nbsp;<br/>;(time&nbsp;(dotimes&nbsp;(i&nbsp;*call-times*)&nbsp;(format&nbsp;out&nbsp;"~d&nbsp;~d\n"&nbsp;(u16vector-ref&nbsp;nv&nbsp;...<br/>;&nbsp;real&nbsp;&nbsp;&nbsp;3.434<br/>;&nbsp;user&nbsp;&nbsp;&nbsp;0.960<br/>;&nbsp;sys&nbsp;&nbsp;&nbsp;&nbsp;0.840<br/>theo-desktop%&nbsp;<br/>[1]&nbsp;&nbsp;+&nbsp;done&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;./rpc-server.scm<br/>theo-desktop%&nbsp;<br/><br/>*サーバとクライアントのCPU・メモリ<br/>&nbsp;&nbsp;メモリ:&nbsp;749.1MB<br/>&nbsp;&nbsp;プロセッサ:&nbsp;Intel&nbsp;Celeron&nbsp;CPU&nbsp;2.00&nbsp;GHz<br/><br/>*同一サーバ内での実行か別サーバでの実行か<br/>&nbsp;&nbsp;同一。<br/><br/>*言語のバージョン<br/>&nbsp;&nbsp;Gauche&nbsp;scheme&nbsp;interpreter,&nbsp;version&nbsp;0.8.10&nbsp;[utf-8,pthreads]<br/><br/>*ミドルウェアを使用している場合，その名前とバージョン<br/>&nbsp;&nbsp;特にないと思われる。<br/><br/>このプログラムを書くにあたって&nbsp;Gauche&nbsp;(at&nbsp;Lingr)&nbsp;において、びさん、&nbsp;rui&nbsp;さん、&nbsp;masa_edw&nbsp;さん、&nbsp;leque&nbsp;さんらに相談にのっていただきました。どうもありがとう！<br/>
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></td><td class="code"><div class="highlight"><pre><span class="c1">;; クライアント</span>
<span class="o">#</span><span class="nv">!/usr/bin/env</span> <span class="nv">gosh</span>
<span class="p">(</span><span class="nf">use</span> <span class="nv">gauche</span><span class="o">.</span><span class="nv">net</span><span class="p">)</span>
<span class="p">(</span><span class="nf">use</span> <span class="nv">srfi-27</span><span class="p">)</span>
<span class="p">(</span><span class="nf">use</span> <span class="nv">gauche</span><span class="o">.</span><span class="nv">uvector</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="nv">*call-times*</span> <span class="mi">10000</span><span class="p">)</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">random-integers</span> <span class="nv">size</span> <span class="nv">maxnum</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">let1</span> <span class="nv">v</span> <span class="p">(</span><span class="nf">make-u16vector</span> <span class="nv">size</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">dotimes</span> <span class="p">(</span><span class="nf">i</span> <span class="nv">size</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">u16vector-set!</span> <span class="nv">v</span> <span class="nv">i</span> <span class="p">(</span><span class="nf">random-integer</span> <span class="nv">maxnum</span><span class="p">)))</span>
    <span class="nv">v</span><span class="p">))</span>

<span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">main</span> <span class="nv">args</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">nvec</span> <span class="p">(</span><span class="nf">random-integers</span> <span class="nv">*call-times*</span> <span class="p">(</span><span class="nb">expt </span><span class="mi">2</span> <span class="mi">16</span><span class="p">)))</span>
	<span class="p">(</span><span class="nf">mvec</span> <span class="p">(</span><span class="nf">random-integers</span> <span class="nv">*call-times*</span> <span class="mi">100</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">call-with-client-socket</span>
	<span class="p">(</span><span class="nf">make-client-socket</span> <span class="ss">&#39;inet</span> <span class="s">&quot;localhost&quot;</span> <span class="mi">3000</span><span class="p">)</span>
      <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">in</span> <span class="nv">out</span><span class="p">)</span>
	<span class="p">(</span><span class="nf">time</span> 
	 <span class="p">(</span><span class="nf">dotimes</span> <span class="p">(</span><span class="nf">i</span> <span class="nv">*call-times*</span><span class="p">)</span>
	   <span class="p">(</span><span class="nf">format</span> <span class="nv">out</span>
		   <span class="s">&quot;~d ~d\n&quot;</span>
		   <span class="p">(</span><span class="nf">u16vector-ref</span> <span class="nv">nvec</span> <span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="nf">u16vector-ref</span> <span class="nv">mvec</span> <span class="nv">i</span><span class="p">))</span>
	   <span class="p">(</span><span class="nf">flush</span> <span class="nv">out</span><span class="p">)</span>
	   <span class="p">(</span><span class="nf">print</span> <span class="p">(</span><span class="nf">read-line</span> <span class="nv">in</span><span class="p">))</span>
	   <span class="p">))))))</span>

<span class="c1">;; サーバー</span>

<span class="p">(</span><span class="k">let* </span><span class="p">((</span><span class="nf">server</span> <span class="p">(</span><span class="nf">make-server-socket</span> <span class="ss">&#39;inet</span> <span class="mi">3000</span> <span class="nv">:reuse-addr?</span> <span class="no">#t</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">sock</span> <span class="p">(</span><span class="nf">socket-accept</span> <span class="nv">server</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">in</span> <span class="p">(</span><span class="nf">socket-input-port</span> <span class="nv">sock</span> <span class="nv">:buffering</span> <span class="nv">:modest</span><span class="p">))</span>
       <span class="p">(</span><span class="nf">out</span> <span class="p">(</span><span class="nf">socket-output-port</span> <span class="nv">sock</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">with-ports</span>
   <span class="nv">in</span> <span class="nv">out</span> <span class="no">#f</span>
   <span class="p">(</span><span class="k">lambda </span><span class="p">()</span>
     <span class="p">(</span><span class="k">do </span><span class="p">((</span><span class="nf">n</span> <span class="p">(</span><span class="nf">read</span><span class="p">)</span> <span class="p">(</span><span class="nf">read</span><span class="p">))</span>
          <span class="p">(</span><span class="nf">m</span> <span class="p">(</span><span class="nf">read</span><span class="p">)</span> <span class="p">(</span><span class="nf">read</span><span class="p">)))</span>
         <span class="p">((</span><span class="k">or </span><span class="p">(</span><span class="nb">eof-object? </span><span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">eof-object? </span><span class="nv">m</span><span class="p">)))</span>
       <span class="p">(</span><span class="nf">format</span> <span class="nv">out</span> <span class="s">&quot;販売価格 ~,,&#39;,,4:d (定価~,,&#39;,,4:d円から~d%引き)&quot;</span>
               <span class="p">(</span><span class="nb">ceiling </span><span class="p">(</span><span class="nf">*</span><span class="o">.</span> <span class="nv">n</span> <span class="p">(</span><span class="nf">/</span><span class="o">.</span> <span class="p">(</span><span class="nf">-</span><span class="o">.</span> <span class="mi">100</span> <span class="nv">m</span><span class="p">)</span> <span class="mi">100</span><span class="p">)))</span>
               <span class="nv">n</span> <span class="nv">m</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">newline</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">flush</span><span class="p">)))))</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2262/addtag/" class="addtag" id="addtag_2262">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/UnixSocket/">UnixSocket</a>
    
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/scheme/">
		Scheme
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2262/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2262/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2262"
  >-</span><span
  class="button yellow"
  id="rating_z_2262"
  >0</span><span 
  class="button green"
  id="rating_p_2262"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2262/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2280">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/344/" target="_top">jz5</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_bronze.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2280/">#2280</a>(<script language="JavaScript">print_time(new Date("2007/08/17 13:19 GMT"));</script><noscript>2007/08/17 13:19 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/vbnet/">
	  VB.net
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #efffef;">1/1=1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>.NET Remoting です。既にC#で出てますね。

CPU: Athlon 64 X2 5600+  メモリ: 4GB
同一マシン内で14秒ぐらいです。</pre>
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></td><td class="code"><div class="highlight"><pre><span class="c">&#39; Remote Object</span>
<span class="k">Public</span> <span class="k">Class</span> <span class="nc">RemoteClass</span>
    <span class="k">Inherits</span> <span class="n">MarshalByRefObject</span>
    <span class="k">Public</span> <span class="k">Function</span> <span class="n">PriceString</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">value</span> <span class="ow">As</span> <span class="kt">Integer</span><span class="p">,</span> <span class="k">ByVal</span> <span class="n">saving</span> <span class="ow">As</span> <span class="kt">Integer</span><span class="p">)</span> <span class="ow">As</span> <span class="kt">String</span>
        <span class="k">Return</span> <span class="kt">String</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;販売価格 {0}円 (定価{1}円から{2}%引き)&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span> <span class="o">*</span> <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">saving</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">).</span><span class="n">ToString</span><span class="p">(</span><span class="s">&quot;N0&quot;</span><span class="p">),</span> <span class="n">value</span><span class="p">.</span><span class="n">ToString</span><span class="p">(</span><span class="s">&quot;N0&quot;</span><span class="p">),</span> <span class="n">saving</span><span class="p">)</span>
    <span class="k">End</span> <span class="k">Function</span>
<span class="k">End</span> <span class="k">Class</span>
<span class="err">　</span>
<span class="c">&#39; Server</span>
<span class="k">Imports</span> <span class="n">System</span><span class="p">.</span><span class="n">Runtime</span><span class="p">.</span><span class="n">Remoting</span>
<span class="k">Imports</span> <span class="n">System</span><span class="p">.</span><span class="n">Runtime</span><span class="p">.</span><span class="n">Remoting</span><span class="p">.</span><span class="n">Channels</span>

<span class="k">Module</span> <span class="n">ServerModule</span>
    <span class="k">Sub</span> <span class="n">Main</span><span class="p">()</span>
        <span class="n">ChannelServices</span><span class="p">.</span><span class="n">RegisterChannel</span><span class="p">(</span><span class="k">New</span> <span class="n">Http</span><span class="p">.</span><span class="n">HttpChannel</span><span class="p">(</span><span class="mi">8088</span><span class="p">),</span> <span class="k">False</span><span class="p">)</span>
        <span class="n">RemotingServices</span><span class="p">.</span><span class="n">Marshal</span><span class="p">(</span><span class="k">New</span> <span class="n">RemoteClass</span><span class="p">,</span> <span class="s">&quot;Price&quot;</span><span class="p">)</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">()</span>
    <span class="k">End</span> <span class="k">Sub</span>
<span class="k">End</span> <span class="k">Module</span>

<span class="c">&#39; Client</span>
<span class="k">Imports</span> <span class="n">System</span><span class="p">.</span><span class="n">Runtime</span><span class="p">.</span><span class="n">Remoting</span>
<span class="k">Imports</span> <span class="n">System</span><span class="p">.</span><span class="n">Runtime</span><span class="p">.</span><span class="n">Remoting</span><span class="p">.</span><span class="n">Channels</span>

<span class="k">Module</span> <span class="n">ClientModule</span>
    <span class="k">Sub</span> <span class="n">Main</span><span class="p">()</span>
        <span class="n">ChannelServices</span><span class="p">.</span><span class="n">RegisterChannel</span><span class="p">(</span><span class="k">New</span> <span class="n">Http</span><span class="p">.</span><span class="n">HttpChannel</span><span class="p">,</span> <span class="k">False</span><span class="p">)</span>
        <span class="k">Dim</span> <span class="n">t</span> <span class="ow">As</span> <span class="n">DateTime</span> <span class="o">=</span> <span class="n">Now</span>
        <span class="k">For</span> <span class="n">i</span> <span class="ow">As</span> <span class="kt">Integer</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">To</span> <span class="mi">10000</span>
            <span class="k">CType</span><span class="p">(</span><span class="n">Activator</span><span class="p">.</span><span class="n">GetObject</span><span class="p">(</span><span class="ow">GetType</span><span class="p">(</span><span class="n">RemoteClass</span><span class="p">),</span> <span class="s">&quot;http://localhost:8088/Price&quot;</span><span class="p">),</span> <span class="n">RemoteClass</span><span class="p">).</span><span class="n">PriceString</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="k">Next</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">Now</span><span class="p">.</span><span class="n">Subtract</span><span class="p">(</span><span class="n">t</span><span class="p">).</span><span class="n">TotalMilliseconds</span><span class="p">)</span>
    <span class="k">End</span> <span class="k">Sub</span>
<span class="k">End</span> <span class="k">Module</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2280/addtag/" class="addtag" id="addtag_2280">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/.NET_Remoting/">.NET_Remoting</a>
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/VB8.0/">VB8.0</a>
    
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/vbnet/">
		VB.net
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2280/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2280/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #efffef;"
  >1/1=1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2280"
  >-</span><span
  class="button yellow"
  id="rating_z_2280"
  >0</span><span 
  class="button green"
  id="rating_p_2280"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2280/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2288">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/88/" target="_top">sumim</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2288/">#2288</a>(<script language="JavaScript">print_time(new Date("2007/08/17 15:53 GMT"));</script><noscript>2007/08/17 15:53 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/smalltalk/">
	  Smalltalk
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>rST をインストールした Squeak Smalltalk で。

10000 回はきつかったので 1000 回で計測。約 20 秒。
1.0Ghz PowerPC（サーバ）, 1.5Ghz VIA C7M（クライアント）; WiFi 11Mbps 経由</pre>
	</div>
	
	<p class="link">
	  参考: <a href="/web/20090404175547/http://wiki.squeak.org/squeak/2288">rST - Remote Smalltalk</a>
	</p>  
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></td><td class="code"><div class="highlight"><pre>&quot;サーバ側定義&quot;
Object subclass: #Doukaku

Doukaku class &gt;&gt; pricestring: priceInt discount: discInt
    | result data |
    result := (priceInt * (100 - discInt) / 100) asInteger.
    data := {result. priceInt. discInt} collect: [:int | int asStringWithCommas].
    ^&#39;販売価格 {1}円 (定価{2}円から{3}%引き)&#39; format: data


&quot;サーバ側スクリプト&quot;
RSTBroker startOnPort: 9999.
RSTBroker export: Doukaku named: &#39;doukaku&#39;


&quot;クライアント側スクリプト&quot;
| doukaku timeToRun result |
doukaku := &#39;doukaku@xx.xx.xx.xx:9999&#39; asLocalObject.
timeToRun := [1000 timesRepeat: [
    result := doukaku pricestring: 20000 discount: 20]
] timeToRun.
^{result. timeToRun}
&quot;=&gt; #(&#39;販売価格 16,000円 (定価20,000円から20%引き)&#39; 19677) &quot;
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2288/addtag/" class="addtag" id="addtag_2288">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/Squeak_Smalltalk/">Squeak_Smalltalk</a>
    
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/smalltalk/">
		Smalltalk
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2288/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2288/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2288"
  >-</span><span
  class="button yellow"
  id="rating_z_2288"
  >0</span><span 
  class="button green"
  id="rating_p_2288"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2288/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2299">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/4/" target="_top">匿名</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2299/">#2299</a>(<script language="JavaScript">print_time(new Date("2007/08/18 05:19 GMT"));</script><noscript>2007/08/18 05:19 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/java/">
	  Java
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #dfffdf;">2/2=1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  JAX-WSによる実装です。SOAP1.2に準拠しているとの記述がありますので、タグはSOAPとします（他言語との相互接続は確認していません）。<br/><br/>一万回呼び出しにかかった時間：73255&nbsp;ms<br/>・サーバとクライアントのCPU・メモリ：Efficeon&nbsp;998&nbsp;MHz・メモリ&nbsp;232MB<br/>・同一サーバ内での実行か別サーバでの実行か：同一サーバ内<br/>・言語のバージョン：Java&nbsp;HotSpot(TM)&nbsp;Client&nbsp;VM&nbsp;build&nbsp;1.6.0_02-b06<br/>・ミドルウェアを使用している場合，その名前とバージョン：使用していない
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></td><td class="code"><div class="highlight"><pre><span class="err">サーバ側実装</span>

<span class="k">package</span> <span class="n">org</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">jaxws</span><span class="o">;</span>

<span class="k">import</span> <span class="nn">javax.jws.WebService</span><span class="o">;</span>

<span class="nd">@WebService</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">Sample</span> <span class="o">{</span>
    <span class="k">public</span> <span class="n">String</span> <span class="n">priceString</span><span class="o">(</span><span class="kt">int</span> <span class="n">price</span><span class="o">,</span> <span class="kt">int</span> <span class="n">discount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;販売価格 %,d円 (定価 %,d円から %d%%引き)&quot;</span><span class="o">,</span>
                        <span class="n">price</span> <span class="o">*</span> <span class="o">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">discount</span><span class="o">)</span> <span class="o">/</span> <span class="mi">100</span><span class="o">,</span> <span class="n">price</span><span class="o">,</span> <span class="n">discount</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>


<span class="err">サーバメイン</span>

<span class="k">package</span> <span class="n">org</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">jaxws</span><span class="o">;</span>

<span class="k">import</span> <span class="nn">javax.xml.ws.Endpoint</span><span class="o">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">SampleMain</span> <span class="o">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="n">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Endpoint</span><span class="o">.</span><span class="na">publish</span><span class="o">(</span><span class="s">&quot;http://localhost:8080/Sample&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Sample</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>


<span class="err">クライアント側実装</span>

<span class="k">package</span> <span class="n">org</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">jaxws</span><span class="o">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Client</span> <span class="o">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="n">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SampleService</span> <span class="n">service</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SampleService</span><span class="o">();</span>
        <span class="n">Sample</span> <span class="n">port</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="na">getSamplePort</span><span class="o">();</span>
        <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">port</span><span class="o">.</span><span class="na">priceString</span><span class="o">(</span><span class="mi">2000</span><span class="o">,</span> <span class="mi">20</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;%d ms%n&quot;</span><span class="o">,</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">start</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2299/addtag/" class="addtag" id="addtag_2299">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/SOAP/">SOAP</a>
    
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/java/">
		Java
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2299/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2299/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #dfffdf;"
  >2/2=1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2299"
  >-</span><span
  class="button yellow"
  id="rating_z_2299"
  >0</span><span 
  class="button green"
  id="rating_p_2299"
  >+</span></span></span>
  

<p>

  

  <a href="/web/20090404175547/http://ja.doukaku.org/comment/2299/">
    1
    reply
  </a>

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2299/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2337">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/4/" target="_top">匿名</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2337/">#2337</a>(<script language="JavaScript">print_time(new Date("2007/08/20 03:14 GMT"));</script><noscript>2007/08/20 03:14 GMT</noscript>)
	
	
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  別CPUのマシンで試してみました。<br/><br/>一万回呼び出しにかかった時間：24936&nbsp;ms<br/>・サーバとクライアントのCPU・メモリ：&nbsp;Intel&nbsp;Pentium&nbsp;M&nbsp;processor&nbsp;1.60GHz・メモリ&nbsp;2GB<br/>・同一サーバ内での実行か別サーバでの実行か：同一サーバ内<br/>・言語のバージョン：Java&nbsp;HotSpot(TM)&nbsp;Client&nbsp;VM&nbsp;build&nbsp;1.6.0_02-b06<br/>・ミドルウェアを使用している場合，その名前とバージョン：使用していない
	</div>
	
	
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2337/addtag/" class="addtag" id="addtag_2337">タグ</a>:
	
	タグなし
	&nbsp;

	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2337"
  >-</span><span
  class="button yellow"
  id="rating_z_2337"
  >0</span><span 
  class="button green"
  id="rating_p_2337"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2299/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2337/root/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2337/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2493">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/402/" target="_top">tea</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2493/">#2493</a>(<script language="JavaScript">print_time(new Date("2007/08/25 02:30 GMT"));</script><noscript>2007/08/25 02:30 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/python/">
	  Python
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #efffef;">1/1=1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>Twisted のPerspectiveBroker使ってみました。
----
# 1
Client:
 OS: OpenBSD
 CPU: SUNW,UltraSPARC-IIi (rev 1.2) @ 299.768 MHz
 Python: 2.5 (r25:51908, Mar 11 2007, 13:48:09) \n[GCC 3.3.5 (propolice)]
 Twisted: 2.5.0

Server:
 OS: FreeBSD release-6.2
 CPU: Intel Celeron (634.78-MHz 686-class CPU)
 RAM: 254MB
 Python 2.4.4 (GCC3.4.6 FreeBSD 20060305)
 Twisted: 2.5.0

経路は100Base-TX

 89.23s user 8.78s system 86% cpu 1:53.92 total

----
# 2 上記 Client環境、同一ホスト内
 94.81s user 23.25s system 53% cpu 3:42.37 total
----
# 3 同一ホスト内
 OS: CentOS
 CPU: Intel(R) Xeon(R) 2.66GHz
 RAM: 2GB
 Python: '2.5.1 (r251:54863, Jul 28 2007, 19:05:07) \n[GCC 3.4.6 20060404 (Red Hat 3.4.6-8)]
 Twisted: 2.5.0

 2.95s user 0.25s system 52% cpu 6.133 total
</pre>
	</div>
	
	<p class="link">
	  参考: <a href="/web/20090404175547/http://ja.doukaku.org/45/flatten/Grokking%20Twisted">http://www.artima.com/weblogs/viewpost.jsp?thread=156396</a>
	</p>  
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77</pre></td><td class="code"><div class="highlight"><pre><span class="c"># ※ 文字コード等は、各環境に合わせて下さい。</span>

<span class="c">## commify.py </span>
<span class="c">#  参考： http://pleac.sourceforge.net/pleac_python/numbers.html</span>
<span class="c"># Putting Commas in Numbers</span>

<span class="k">def</span> <span class="nf">simple_glue</span><span class="p">(</span><span class="o">*</span><span class="n">funcs</span><span class="p">):</span>
    <span class="s">&quot;glue functions: simple_glue(f, g, h) -&gt; lambda arg: h(g(f(arg)))&quot;</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">arg</span><span class="p">:</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">:</span><span class="n">m</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">funcs</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">digits_div_by</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">xs</span><span class="p">:</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">),</span><span class="n">i</span><span class="p">:</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="p">[</span><span class="n">xs</span><span class="p">[</span><span class="n">m</span><span class="p">:</span><span class="n">i</span><span class="p">]],</span><span class="n">i</span><span class="p">),</span>
                             <span class="n">reversed</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">num</span><span class="p">)),</span>
                             <span class="p">([],</span><span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">commify</span> <span class="o">=</span> <span class="n">simple_glue</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">digits_div_by</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">)</span>


<span class="c">##############################</span>
<span class="c"># サーバー</span>

<span class="c"># -*- coding: euc-jp -*-</span>
<span class="k">from</span> <span class="nn">twisted.spread</span> <span class="k">import</span> <span class="n">pb</span>
<span class="k">from</span> <span class="nn">twisted.internet</span> <span class="k">import</span> <span class="n">reactor</span>
<span class="k">from</span> <span class="nn">commify</span> <span class="k">import</span> <span class="n">commify</span>

<span class="n">PORT</span> <span class="o">=</span> <span class="mi">10800</span>
<span class="n">FORMAT</span> <span class="o">=</span> <span class="n">u</span><span class="s">&quot;販売価格</span><span class="si">%(price)s</span><span class="s">円 (定価 %(original_price)s円から</span><span class="si">%(discount)d</span><span class="s">％引き)&quot;</span>

<span class="k">class</span> <span class="nc">PriceStringService</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">Root</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">remote_pricestring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_price</span><span class="p">,</span> <span class="n">discount</span><span class="p">):</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">commify</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">original_price</span> <span class="o">*</span> <span class="p">((</span><span class="mf">100.0</span> <span class="o">-</span> <span class="n">discount</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)))</span>
        <span class="n">original_price</span> <span class="o">=</span> <span class="n">commify</span><span class="p">(</span><span class="n">original_price</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FORMAT</span> <span class="o">%</span> <span class="nb">vars</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">listenTCP</span><span class="p">(</span><span class="n">PORT</span><span class="p">,</span> <span class="n">pb</span><span class="o">.</span><span class="n">PBServerFactory</span><span class="p">(</span><span class="n">PriceStringService</span><span class="p">()))</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="c">##############################</span>
<span class="c"># クライアント</span>
<span class="c"># ホスト・アドレス、ポート番号を指定して実行。</span>

<span class="c"># -*- coding: euc-jp -*-</span>
<span class="k">import</span> <span class="nn">sys</span>
<span class="k">import</span> <span class="nn">itertools</span>
<span class="k">from</span> <span class="nn">twisted.spread.pb</span> <span class="k">import</span> <span class="n">PBClientFactory</span>
<span class="k">from</span> <span class="nn">twisted.internet</span> <span class="k">import</span> <span class="n">reactor</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">host</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">failure</span><span class="p">(</span><span class="n">_</span><span class="p">):</span>
        <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">connected</span><span class="p">(</span><span class="n">perspective</span><span class="p">):</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">callloop</span><span class="p">():</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">perspective</span><span class="o">.</span><span class="n">callRemote</span><span class="p">(</span><span class="s">&quot;pricestring&quot;</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
            <span class="n">d</span><span class="o">.</span><span class="n">addCallbacks</span><span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="n">failure</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">success</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
            <span class="k">print</span> <span class="n">result</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&quot;euc-jp&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">counter</span><span class="o">.</span><span class="n">next</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">:</span>
                <span class="n">callloop</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

        <span class="n">callloop</span><span class="p">()</span>

    <span class="n">factory</span> <span class="o">=</span> <span class="n">PBClientFactory</span><span class="p">()</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">connectTCP</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">factory</span><span class="p">)</span>
    <span class="n">factory</span><span class="o">.</span><span class="n">getRootObject</span><span class="p">()</span><span class="o">.</span><span class="n">addCallbacks</span><span class="p">(</span><span class="n">connected</span><span class="p">,</span> <span class="n">failure</span><span class="p">)</span>
    <span class="n">reactor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2493/addtag/" class="addtag" id="addtag_2493">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/Twisted/">Twisted</a>
    
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/python/">
		Python
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2493/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2493/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #efffef;"
  >1/1=1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2493"
  >-</span><span
  class="button yellow"
  id="rating_z_2493"
  >0</span><span 
  class="button green"
  id="rating_p_2493"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2493/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2497">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/153/" target="_top">Mistfeal</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2497/">#2497</a>(<script language="JavaScript">print_time(new Date("2007/08/25 03:34 GMT"));</script><noscript>2007/08/25 03:34 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/php/">
	  PHP
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>最初はfsockopenで開いて一行ずつ読み込んでいたのですが、
あまりに遅いのでソケット関数で作り変えました。

実行結果：23.0054550171 秒

&lt;測定環境&gt;
　サーバサイド
　　CPU: Intel(R) Celeron(R) CPU 2.40GHz
　　MEM: 256MB
　　Apache2.0.52 + PHP4.3.9
　クライアントサイド
　　CPU: Intel(R) Celeron(R) CPU 2.80GHz
　　MEM: 512MB
　　PHP4.4.4(Cli)
　通信経路: 100Mbps Ethernet
</pre>
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></td><td class="code"><div class="highlight"><pre><span class="x">// サーバサイド</span>
<span class="cp">&lt;?php</span>
<span class="nv">$lprice</span> <span class="o">=</span> <span class="nf">strip_tags</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;lprice&quot;</span><span class="p">]);</span>
<span class="nv">$dcrate</span> <span class="o">=</span> <span class="nf">strip_tags</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;dcrate&quot;</span><span class="p">]);</span>
<span class="nv">$dprice</span> <span class="o">=</span> <span class="nv">$lprice</span> <span class="o">-</span> <span class="p">(</span><span class="nv">$lprice</span> <span class="o">*</span> <span class="p">(</span> <span class="nv">$dcrate</span> <span class="o">/</span> <span class="m">100</span> <span class="p">));</span>

<span class="k">echo</span> <span class="s2">&quot;販売価格 &quot;</span><span class="o">.</span><span class="nf">number_format</span><span class="p">(</span><span class="nv">$dprice</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;円（定価&quot;</span><span class="o">.</span><span class="nf">number_format</span><span class="p">(</span><span class="nv">$lprice</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;円から&quot;</span><span class="o">.</span><span class="nv">$dcrate</span><span class="o">.</span><span class="s2">&quot;%引き）</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>

<span class="x">// クライアントサイド</span>
<span class="cp">&lt;?php</span>
<span class="nv">$host</span>   <span class="o">=</span> <span class="s2">&quot;192.168.*.*&quot;</span><span class="p">;</span>
<span class="nv">$script</span> <span class="o">=</span> <span class="s2">&quot;test/test_1.php&quot;</span><span class="p">;</span>
<span class="nv">$lprice</span> <span class="o">=</span> <span class="m">2000</span><span class="p">;</span>
<span class="nv">$dcrate</span> <span class="o">=</span> <span class="m">20</span><span class="p">;</span>
<span class="nv">$st_time</span> <span class="o">=</span> <span class="nx">msec</span><span class="p">();</span>
<span class="k">for</span> <span class="p">(</span> <span class="nv">$i</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="m">10000</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
	<span class="nv">$postdata</span> <span class="o">=</span> <span class="s2">&quot;lprice=&quot;</span><span class="o">.</span><span class="nf">urlencode</span><span class="p">(</span><span class="nv">$lprice</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;&amp;dcrate=&quot;</span><span class="o">.</span><span class="nf">urlencode</span><span class="p">(</span><span class="nv">$dcrate</span><span class="p">);</span>
	<span class="nv">$send</span>  <span class="o">=</span> <span class="s2">&quot;POST /</span><span class="si">$script</span><span class="s2"> HTTP/1.0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
	<span class="nv">$send</span> <span class="o">.=</span> <span class="s2">&quot;Content-type: application/x-www-form-urlencoded</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
	<span class="nv">$send</span> <span class="o">.=</span> <span class="s2">&quot;Content-Length: &quot;</span><span class="o">.</span><span class="nf">strlen</span><span class="p">(</span><span class="nv">$postdata</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">;</span>
	<span class="nv">$send</span> <span class="o">.=</span> <span class="nv">$postdata</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">;</span>
	<span class="nv">$sct</span> <span class="o">=</span> <span class="nf">socket_create</span><span class="p">(</span><span class="nx">AF_INET</span><span class="p">,</span><span class="nx">SOCK_STREAM</span><span class="p">,</span><span class="nx">SOL_TCP</span><span class="p">);</span>
	<span class="nf">socket_connect</span><span class="p">(</span><span class="nv">$sct</span><span class="p">,</span><span class="nv">$host</span><span class="p">,</span><span class="m">80</span><span class="p">);</span>
	<span class="nf">socket_write</span><span class="p">(</span><span class="nv">$sct</span><span class="p">,</span><span class="nv">$send</span><span class="p">,</span><span class="nf">strlen</span><span class="p">(</span><span class="nv">$send</span><span class="p">));</span>
	<span class="nv">$result</span> <span class="o">=</span> <span class="nf">socket_read</span><span class="p">(</span><span class="nv">$sct</span><span class="p">,</span><span class="m">4096</span><span class="p">);</span>
	<span class="k">list</span><span class="p">(</span><span class="nv">$head</span><span class="p">,</span><span class="nv">$body</span><span class="p">)</span> <span class="o">=</span> <span class="nf">explode</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n\r\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="nv">$result</span><span class="p">);</span>
	<span class="k">echo</span> <span class="nv">$body</span><span class="p">;</span>
	<span class="nf">socket_close</span><span class="p">(</span><span class="nv">$sct</span><span class="p">);</span>
<span class="p">}</span>
<span class="nv">$ed_time</span> <span class="o">=</span> <span class="nx">msec</span><span class="p">();</span>
<span class="nv">$total</span> <span class="o">=</span> <span class="nv">$ed_time</span> <span class="o">-</span> <span class="nv">$st_time</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">&quot;所要時間：</span><span class="si">$total</span><span class="s2"> 秒</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="k">function</span> <span class="nf">msec</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">list</span><span class="p">(</span><span class="nv">$msec</span><span class="p">,</span><span class="nv">$sec</span><span class="p">)</span> <span class="o">=</span> <span class="nf">explode</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="nf">microtime</span><span class="p">());</span>
	<span class="k">return</span> <span class="nv">$sec</span> <span class="o">+</span> <span class="nv">$msec</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2497/addtag/" class="addtag" id="addtag_2497">タグ</a>:
	
	タグなし
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/php/">
		PHP
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2497/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2497/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2497"
  >-</span><span
  class="button yellow"
  id="rating_z_2497"
  >0</span><span 
  class="button green"
  id="rating_p_2497"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2497/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2500">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/402/" target="_top">tea</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2500/">#2500</a>(<script language="JavaScript">print_time(new Date("2007/08/25 05:22 GMT"));</script><noscript>2007/08/25 05:22 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/python/">
	  Python
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #efffef;">1/1=1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>OS: Windows XP sp2
CPU: Intel Celeron 1.4GHz
RAM: 480MB
Python: 2.5
PyRO: 3.7

同一サーバー内。実行時間 20秒</pre>
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></td><td class="code"><div class="highlight"><pre><span class="c">#### Server</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="k">from</span> <span class="nn">Pyro.core</span> <span class="k">import</span> <span class="n">ObjBase</span><span class="p">,</span> <span class="n">Daemon</span><span class="p">,</span> <span class="n">initServer</span>

<span class="k">def</span> <span class="nf">calc_sales_price</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">discount</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">price</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">discount</span><span class="o">*</span><span class="mf">0.01</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">commify</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_commify</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="n">num</span><span class="p">],</span><span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="n">num</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">commify</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="n">sep</span><span class="o">+</span><span class="n">b</span> <span class="k">if</span> <span class="n">a</span> <span class="k">else</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">_commify</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">amount</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">PriceString</span><span class="p">(</span><span class="n">ObjBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">pricestring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">discount</span><span class="p">):</span>
        <span class="n">FORMAT</span> <span class="o">=</span> <span class="n">u</span><span class="s">&quot;販売価格%(sales_price)s円 (定価 </span><span class="si">%(price)s</span><span class="s">円から</span><span class="si">%(discount)d</span><span class="s">％引き)&quot;</span>
        <span class="n">sales_price</span> <span class="o">=</span> <span class="n">commify</span><span class="p">(</span><span class="n">calc_sales_price</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">discount</span><span class="p">))</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">commify</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FORMAT</span> <span class="o">%</span> <span class="nb">vars</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">initServer</span><span class="p">()</span>
    <span class="n">daemon</span> <span class="o">=</span> <span class="n">Daemon</span><span class="p">()</span>
    <span class="n">daemon</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">PriceString</span><span class="p">(),</span> <span class="s">&quot;pricestring&quot;</span><span class="p">)</span>
    <span class="n">daemon</span><span class="o">.</span><span class="n">requestLoop</span><span class="p">()</span>


<span class="c">#### Client</span>
<span class="k">from</span> <span class="nn">Pyro.core</span> <span class="k">import</span> <span class="n">getProxyForURI</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">remote</span> <span class="o">=</span> <span class="n">getProxyForURI</span><span class="p">(</span><span class="s">r&quot;PYROLOC://localhost:7766/pricestring&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">remote</span><span class="o">.</span><span class="n">pricestring</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2500/addtag/" class="addtag" id="addtag_2500">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/PyRO/">PyRO</a>
    
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/python/">
		Python
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2500/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2500/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #efffef;"
  >1/1=1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2500"
  >-</span><span
  class="button yellow"
  id="rating_z_2500"
  >0</span><span 
  class="button green"
  id="rating_p_2500"
  >+</span></span></span>
  

<p>

  

  <a href="/web/20090404175547/http://ja.doukaku.org/comment/2500/">
    1
    reply
  </a>

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2500/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2501">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/402/" target="_top">tea</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2501/">#2501</a>(<script language="JavaScript">print_time(new Date("2007/08/25 05:24 GMT"));</script><noscript>2007/08/25 05:24 GMT</noscript>)
	
	
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #efffef;">1/1=1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>PyROライブラリのURL書き忘れてました。</pre>
	</div>
	
	<p class="link">
	  参考: <a href="/web/20090404175547/http://pyro.sourceforge.net/">Python Remote Objects</a>
	</p>  
	
	
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2501/addtag/" class="addtag" id="addtag_2501">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/PyRO/">PyRO</a>
    
	&nbsp;

	

  
  <span class="rating">
  評価<span style="background-color: #efffef;"
  >1/1=1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2501"
  >-</span><span
  class="button yellow"
  id="rating_z_2501"
  >0</span><span 
  class="button green"
  id="rating_p_2501"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2500/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2501/root/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2501/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2504">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/402/" target="_top">tea</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2504/">#2504</a>(<script language="JavaScript">print_time(new Date("2007/08/25 09:45 GMT"));</script><noscript>2007/08/25 09:45 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/python/">
	  Python
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #efffef;">1/1=1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>Rpyc (Remote Python call) による実装です。


OS: Windows XP
CPU: Celeron 1.4GHz
RAM: 480MB
Python: 2.5
Rpyc: 2.6

同一サーバー内でテスト。
実行時間: 約12秒</pre>
	</div>
	
	<p class="link">
	  参考: <a href="/web/20090404175547/http://rpyc.wikispaces.com/">Remote Python Call</a>
	</p>  
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></td><td class="code"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># ./pricestring.py</span>
<span class="c"># サーバーj実行時のsys.pathの通ったところに置く。</span>
<span class="c"># サーバーの実行は、</span>
<span class="c"># &gt; python -m Rpyc.Servers.simple_server.py</span>

<span class="k">def</span> <span class="nf">Y</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="s">&quot;simple Y-combinator&quot;</span>
    <span class="n">_f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">_f</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_f</span>

<span class="k">def</span> <span class="nf">commify</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Y</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">,</span><span class="n">s</span><span class="p">:(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">:(</span><span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="n">sep</span><span class="o">+</span><span class="n">b</span> <span class="k">if</span> <span class="n">a</span> <span class="k">else</span> <span class="n">b</span><span class="p">))(</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="n">num</span><span class="p">],</span><span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="n">num</span><span class="p">:]))(</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">calc_sales_price</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">discount</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">((</span><span class="n">price</span><span class="o">/</span><span class="mf">100.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">100</span><span class="o">-</span><span class="n">discount</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">pricestring</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">discount</span><span class="p">):</span>
    <span class="n">sales_price</span> <span class="o">=</span> <span class="n">commify</span><span class="p">(</span><span class="n">calc_sales_price</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">discount</span><span class="p">))</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">commify</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">u</span><span class="s">&quot;販売価格%(sales_price)s円 (定価</span><span class="si">%(price)s</span><span class="s">円から</span><span class="si">%(discount)d%%</span><span class="s">引き)&quot;</span> <span class="o">%</span> <span class="nb">vars</span><span class="p">()</span>

<span class="c">#### クライアント</span>

<span class="k">from</span> <span class="nn">time</span> <span class="k">import</span> <span class="n">sleep</span>
<span class="k">from</span> <span class="nn">Rpyc</span> <span class="k">import</span> <span class="n">SocketConnection</span><span class="p">,</span> <span class="n">Async</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">SocketConnection</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">)</span>
<span class="n">pricestring</span> <span class="o">=</span> <span class="n">Async</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">pricestring</span><span class="o">.</span><span class="n">pricestring</span><span class="p">)</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">pricestring</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">is_ready</span><span class="p">:</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">c</span><span class="o">.</span><span class="n">result</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2504/addtag/" class="addtag" id="addtag_2504">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/Rpyc/">Rpyc</a>
    
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/python/">
		Python
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2504/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2504/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #efffef;"
  >1/1=1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2504"
  >-</span><span
  class="button yellow"
  id="rating_z_2504"
  >0</span><span 
  class="button green"
  id="rating_p_2504"
  >+</span></span></span>
  

<p>

  

  <a href="/web/20090404175547/http://ja.doukaku.org/comment/2504/">
    1
    reply
  </a>

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2504/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2518">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/402/" target="_top">tea</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2518/">#2518</a>(<script language="JavaScript">print_time(new Date("2007/08/26 06:03 GMT"));</script><noscript>2007/08/26 06:03 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/python/">
	  Python
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>お題とは関係ないけど、commify関数に使ってる、
Y-combinatorの表記の手続きなし版。</pre>
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre>1
2
3
4
5
6
7
8</pre></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">Y</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">arg</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">g</span><span class="p">),</span><span class="n">arg</span><span class="p">))((</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">arg</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">g</span><span class="p">),</span><span class="n">arg</span><span class="p">)))</span>


<span class="c"># デコレータとしての利用例</span>
    <span class="nd">@Y</span>
    <span class="k">def</span> <span class="nf">fact</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">n</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2518/addtag/" class="addtag" id="addtag_2518">タグ</a>:
	
	タグなし
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/python/">
		Python
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2518/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2518/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2518"
  >-</span><span
  class="button yellow"
  id="rating_z_2518"
  >0</span><span 
  class="button green"
  id="rating_p_2518"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2504/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/2518/root/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2518/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment2552">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/402/" target="_top">tea</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2552/">#2552</a>(<script language="JavaScript">print_time(new Date("2007/08/27 06:28 GMT"));</script><noscript>2007/08/27 06:28 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/python/">
	  Python
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #efffef;">1/1=1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>Thrift使ってみました。release-20070401版です。
サーバ／クライアント共にPython。
初めてなので、Thriftの作法等は、まだよく解ってません。

※注意点： サーバー・クライアントのスクリプト 共に、
gen-py以下をモジュール探索対象のPATHに含めること。
PYTHONPATHに設定、もしくはモジュールのインポート前に、下のコードを追加。
import sys
sys.path.append("./gen-py")

※ メモ
C++のTNonblockingServerがlibeventを利用してるので、
kqueueやepollが使える環境だと、パフォーマンス向上が期待できそうです。（未計測）
Thriftは、言語以外にも各言語毎にserverやprotocllも組み合わせて使うことが出来るみたいなので、
C++/TNonblockingServer/boost.Pythonもやってみようかな。
</pre>
	</div>
	
	<p class="link">
	  参考: <a href="/web/20090404175547/http://developers.facebook.com/thrift/">Facebook Developers | Thrift</a>
	</p>  
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53</pre></td><td class="code"><div class="highlight"><pre><span class="c">##############################</span>
<span class="c"># pricestring.thrift</span>

<span class="n">service</span> <span class="n">PriceStringService</span> <span class="p">{</span>
  <span class="n">string</span> <span class="n">pricestring</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">i32</span> <span class="n">price</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="n">i32</span> <span class="n">discount</span><span class="p">)</span>
<span class="p">}</span>

<span class="c">##############################</span>
<span class="c"># Server</span>
<span class="k">from</span> <span class="nn">locale</span> <span class="k">import</span> <span class="n">format</span>

<span class="k">class</span> <span class="nc">PriceStringHandler</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">pricestring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">discount</span><span class="p">):</span>
        <span class="n">calc_sales_price</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">:</span> <span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="mf">0.01</span><span class="p">))</span>
        <span class="n">commify</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">format</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">grouping</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">u</span><span class="s">&quot;販売価格</span><span class="si">%s</span><span class="s">円 (</span><span class="si">%s</span><span class="s">円から</span><span class="si">%s</span><span class="s">％引き)&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">template</span> <span class="o">%</span> <span class="p">(</span><span class="n">commify</span><span class="p">(</span><span class="n">calc_sales_price</span><span class="p">(</span><span class="n">price</span><span class="p">,</span><span class="n">discount</span><span class="p">)),</span> <span class="n">commify</span><span class="p">(</span><span class="n">price</span><span class="p">),</span> <span class="n">discount</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">from</span> <span class="nn">locale</span> <span class="k">import</span> <span class="n">setlocale</span><span class="p">,</span> <span class="n">LC_NUMERIC</span>
    <span class="n">setlocale</span><span class="p">(</span><span class="n">LC_NUMERIC</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

    <span class="k">from</span> <span class="nn">pricestring</span> <span class="k">import</span> <span class="n">PriceStringService</span>
    <span class="k">from</span> <span class="nn">thrift.transport.TSocket</span> <span class="k">import</span> <span class="n">TServerSocket</span>
    <span class="k">from</span> <span class="nn">thrift.server.TServer</span> <span class="k">import</span> <span class="n">TSimpleServer</span>

    <span class="n">handler</span> <span class="o">=</span> <span class="n">PriceStringHandler</span><span class="p">()</span>
    <span class="n">processor</span> <span class="o">=</span> <span class="n">PriceStringService</span><span class="o">.</span><span class="n">Processor</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">TSimpleServer</span><span class="p">(</span><span class="n">processor</span><span class="p">,</span> <span class="n">TServerSocket</span><span class="p">(</span><span class="mi">9090</span><span class="p">))</span>
    <span class="n">server</span><span class="o">.</span><span class="n">serve</span><span class="p">()</span>

<span class="c">##############################</span>
<span class="c"># Client</span>
<span class="c"># データはutf-8 で渡ってきます。&lt; client.pricestring</span>
<span class="c"># 端末に表示する時など、文字コードは適切なものにエンコードしてください。</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
 
    <span class="k">from</span> <span class="nn">pricestring</span> <span class="k">import</span> <span class="n">PriceStringService</span>

    <span class="k">from</span> <span class="nn">thrift</span> <span class="k">import</span> <span class="n">Thrift</span>
    <span class="k">from</span> <span class="nn">thrift.transport.TSocket</span> <span class="k">import</span> <span class="n">TSocket</span>
    <span class="k">from</span> <span class="nn">thrift.transport.TTransport</span> <span class="k">import</span> <span class="n">TBufferedTransport</span>
    <span class="k">from</span> <span class="nn">thrift.protocol.TBinaryProtocol</span> <span class="k">import</span> <span class="n">TBinaryProtocol</span>

    <span class="n">transport</span> <span class="o">=</span> <span class="n">TBufferedTransport</span><span class="p">(</span><span class="n">TSocket</span><span class="p">(</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">9090</span><span class="p">))</span>
    <span class="n">protocol</span> <span class="o">=</span> <span class="n">TBinaryProtocol</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">PriceStringService</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">protocol</span><span class="p">)</span>

    <span class="n">transport</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">client</span><span class="o">.</span><span class="n">pricestring</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">transport</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/2552/addtag/" class="addtag" id="addtag_2552">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/Thrift/">Thrift</a>
    
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/python/">
		Python
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2552/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/2552/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #efffef;"
  >1/1=1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_2552"
  >-</span><span
  class="button yellow"
  id="rating_z_2552"
  >0</span><span 
  class="button green"
  id="rating_p_2552"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/2552/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment3153">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/446/" target="_top">tilde</a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/3153/">#3153</a>(<script language="JavaScript">print_time(new Date("2007/09/21 09:08 GMT"));</script><noscript>2007/09/21 09:08 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/objectivec/">
	  Objective-C
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #efffef;">1/1=1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>ＣＰＵ：　1.83 GHz Intel Core Duo
メモリ：　2 GB
実行：　　同一サーバ内
１万回の実行時間：　1.936秒</pre>
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85</pre></td><td class="code"><div class="highlight"><pre><span class="c">//--------------------------------------------------------------------------------</span>
<span class="c">//サーバ側のソースコード</span>
<span class="c">//ソースファイルのエンコーディングはUTF-8にしてください</span>
<span class="c">//--------------------------------------------------------------------------------</span>

<span class="cp">#import &lt;Foundation/Foundation.h&gt;</span>

<span class="k">@interface</span> <span class="nc">Server</span> : <span class="nc">NSObject</span> <span class="p">{</span>
<span class="p">}</span>
<span class="o">-</span> <span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="nl">priceString:</span><span class="p">(</span><span class="n">NSNumber</span><span class="o">*</span><span class="p">)</span><span class="n">listPrice</span> <span class="o">:</span><span class="p">(</span><span class="n">NSNumber</span><span class="o">*</span><span class="p">)</span><span class="n">discount</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">Server</span>
<span class="o">-</span> <span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="nl">insertComma:</span><span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="n">number</span> <span class="p">{</span>
	<span class="n">NSMutableString</span><span class="o">*</span> <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableString</span> <span class="nl">stringWithString:</span>
			<span class="p">[[</span><span class="n">NSNumber</span> <span class="nl">numberWithUnsignedInt:</span><span class="n">number</span><span class="p">]</span> <span class="n">stringValue</span><span class="p">]];</span>
	
	<span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="p">[</span><span class="n">result</span> <span class="n">length</span><span class="p">];</span>
	<span class="k">while</span> <span class="p">(</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="p">)</span> <span class="p">{</span>
		<span class="n">length</span> <span class="o">-=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="p">[</span><span class="n">result</span> <span class="nl">insertString:</span><span class="s">@&quot;,&quot;</span> <span class="nl">atIndex:</span><span class="n">length</span><span class="p">];</span>
	<span class="p">}</span>
	
	<span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="nl">priceString:</span><span class="p">(</span><span class="n">NSNumber</span><span class="o">*</span><span class="p">)</span><span class="n">listPrice</span> <span class="o">:</span><span class="p">(</span><span class="n">NSNumber</span><span class="o">*</span><span class="p">)</span><span class="n">discount</span> <span class="p">{</span>
	<span class="n">NSString</span><span class="o">*</span> <span class="n">format</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithUTF8String:</span> <span class="s">&quot;販売価格 %@円 (定価%@円から%d%%%%引き)&quot;</span><span class="p">];</span>
	
	<span class="kt">unsigned</span> <span class="n">unsignedListPrice</span> <span class="o">=</span> <span class="p">[</span><span class="n">listPrice</span> <span class="n">unsignedIntValue</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="n">unsignedDiscount</span> <span class="o">=</span> <span class="p">[</span><span class="n">discount</span> <span class="n">unsignedIntValue</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="n">unsignedRetailPrice</span> <span class="o">=</span> <span class="n">unsignedListPrice</span> <span class="o">*</span> <span class="p">(</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">unsignedDiscount</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span>
	
	<span class="n">NSString</span><span class="o">*</span> <span class="n">listPriceString</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nl">insertComma:</span><span class="n">unsignedListPrice</span><span class="p">];</span>
	<span class="n">NSString</span><span class="o">*</span> <span class="n">retailPriceString</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nl">insertComma:</span><span class="n">unsignedRetailPrice</span><span class="p">];</span>
	
	<span class="k">return</span> <span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithFormat:</span> <span class="n">format</span><span class="p">,</span> <span class="n">retailPriceString</span><span class="p">,</span> <span class="n">listPriceString</span><span class="p">,</span> <span class="n">unsignedDiscount</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">@end</span>

<span class="kt">int</span> <span class="n">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">NSAutoreleasePool</span> <span class="o">*</span> <span class="n">pool</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSAutoreleasePool</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
	
	<span class="n">Server</span><span class="o">*</span> <span class="n">server</span> <span class="o">=</span> <span class="p">[[[</span><span class="n">Server</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">]</span> <span class="n">autorelease</span><span class="p">];</span>
	<span class="n">NSConnection</span><span class="o">*</span> <span class="n">connection</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSConnection</span> <span class="n">defaultConnection</span><span class="p">];</span>
	<span class="p">[</span><span class="n">connection</span> <span class="nl">setRootObject:</span><span class="n">server</span><span class="p">];</span>
	
	<span class="k">if</span> <span class="p">(</span> <span class="p">[</span><span class="n">connection</span> <span class="nl">registerName:</span><span class="s">@&quot;server&quot;</span><span class="p">]</span> <span class="p">)</span>
		<span class="p">[[</span><span class="n">NSRunLoop</span> <span class="n">currentRunLoop</span><span class="p">]</span> <span class="n">run</span><span class="p">];</span>
	
    <span class="p">[</span><span class="n">pool</span> <span class="n">release</span><span class="p">];</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c">//--------------------------------------------------------------------------------</span>
<span class="c">//クライアント側のソースコード</span>
<span class="c">//コンパイルオプション：-std=gnu99</span>
<span class="c">//--------------------------------------------------------------------------------</span>

<span class="cp">#import &lt;Foundation/Foundation.h&gt;</span>

<span class="err">@</span><span class="n">protocol</span> <span class="n">ServerProtocol</span>
<span class="o">-</span> <span class="p">(</span><span class="n">NSString</span><span class="o">*</span><span class="p">)</span><span class="nl">priceString:</span><span class="p">(</span><span class="n">NSNumber</span><span class="o">*</span><span class="p">)</span><span class="n">listPrice</span> <span class="o">:</span><span class="p">(</span><span class="n">NSNumber</span><span class="o">*</span><span class="p">)</span><span class="n">discount</span><span class="p">;</span>
<span class="k">@end</span>

<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">NSAutoreleasePool</span> <span class="o">*</span> <span class="n">pool</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSAutoreleasePool</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
	
	<span class="n">NSDistantObject</span><span class="o">*</span> <span class="n">distantObject</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSConnection</span>
			<span class="nl">rootProxyForConnectionWithRegisteredName:</span><span class="s">@&quot;server&quot;</span> <span class="nl">host:</span><span class="nb">nil</span><span class="p">];</span>
	<span class="p">[</span><span class="n">distantObject</span> <span class="nl">setProtocolForProxy:</span><span class="err">@</span><span class="n">protocol</span><span class="p">(</span><span class="n">ServerProtocol</span><span class="p">)];</span>
	
	<span class="n">NSNumber</span><span class="o">*</span> <span class="n">listPrice</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSNumber</span> <span class="nl">numberWithInt:</span><span class="mi">2000</span><span class="p">];</span>
	<span class="n">NSNumber</span><span class="o">*</span> <span class="n">discount</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSNumber</span> <span class="nl">numberWithInt:</span><span class="mi">20</span><span class="p">];</span>
	
	<span class="n">NSLog</span><span class="p">(</span> <span class="s">@&quot;start&quot;</span> <span class="p">);</span>
	
	<span class="k">for</span> <span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">)</span>
		<span class="p">[</span><span class="n">distantObject</span> <span class="nl">performSelector:</span><span class="k">@selector</span><span class="p">(</span><span class="n">priceString</span><span class="o">::</span><span class="p">)</span> <span class="nl">withObject:</span><span class="n">listPrice</span> <span class="nl">withObject:</span><span class="n">discount</span><span class="p">];</span>
	
	<span class="n">NSLog</span><span class="p">(</span> <span class="s">@&quot;end&quot;</span> <span class="p">);</span>
	
    <span class="p">[</span><span class="n">pool</span> <span class="n">release</span><span class="p">];</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/3153/addtag/" class="addtag" id="addtag_3153">タグ</a>:
	
	タグなし
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/objectivec/">
		Objective-C
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/3153/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/3153/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #efffef;"
  >1/1=1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_3153"
  >-</span><span
  class="button yellow"
  id="rating_z_3153"
  >0</span><span 
  class="button green"
  id="rating_p_3153"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/3153/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment3167">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/405/" target="_top">mc</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/3167/">#3167</a>(<script language="JavaScript">print_time(new Date("2007/09/25 10:40 GMT"));</script><noscript>2007/09/25 10:40 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/commonlisp/">
	  Common Lisp
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>とりあえず検索して使えそうなコードを探しそれを参考にして切った貼ったで
作りました。
socket自体良く分かっていないため怪しいものができていると思います^^;

できるだけ、処理系非依存にしたかったのですが、サーバ側は、SBCLの、
sb-bsd-socketに依存しているので、残念ながらsbclでしか動きません。
色々探している中で、usocketというものが使えそうだったので、クライアン
ト側は、usocketを使用して作成しました。こちらは、USOCKETがサポートして
いる処理系なら大丈夫だと思います。
USOCKETはASDF-INSTALL可能です。

サーバ: Pentium 1GHz Mem 768MB
クライアント: iBook G4 800MHz Mem 640MB
通信経路: 100Mbps Ethernet
言語: SBCL 1.0.9 (サーバ/クライアント共に)

参考(サーバ)
http://paste.lisp.org/display/1376

測定コード:
 (time 
  (dotimes (i 10000)
   (get-pricestring (random 30000) (random 105) "server" 2000))
   
10,000回実行にかかった時間
-------------------
real: 1202秒
user:   26秒
sys:    11秒

同一マシン(サーバ上)で実行
-------------------
real: 66秒
user: 27秒
sys:  10秒</pre>
	</div>
	
	<p class="link">
	  参考: <a href="/web/20090404175547/http://paste.lisp.org/display/1376">Lisp Paste #1376</a>
	</p>  
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre></td><td class="code"><div class="highlight"><pre>;; ================================================================
;; クライアント
(defpackage doukaku-45 (:use :cl :usocket))
(in-package :doukaku-45)

(defun get-pricestring (price discount% server port)
  (with-client-socket (socket stream server port)
    (format stream &quot;(~D ~D)~%&quot; price discount%)
    (force-output stream)
    (read-line stream)))

;; ================================================================
;; サーバ
;; (ファイルにセーブして、$ sbcl --load server.lisp のように実行し起動させます。
(require :sb-bsd-sockets)
(use-package :sb-bsd-sockets)

(defun return-discount-price (stream price discount%)
  (let ((discount-price (round (* price (/ (- 100 discount%) 100)))))
    (format stream &quot;販売価格 ~:D円（定価~:D円から~D%引き）&quot;
	    discount-price price discount%)))

(defun valid-input-p (input)
  (and (consp input)
       (= 2 (length input))
       (every #&#39;numberp input)
       (every (lambda (x) (&lt;= 0 x)) input)
       (&lt;= 0 (cadr input) 100)))

(defun get-server-socket (hostname port)
  (let ((socket (make-instance &#39;inet-socket :type :stream :protocol :tcp)))
    (setf (sockopt-reuse-address socket) t)
    (socket-bind socket
		 (host-ent-address (get-host-by-name hostname))
		 port)
    (socket-listen socket 10)
    socket))

(defun get-client-socket (server-socket)
  (socket-accept server-socket))

(defun get-socket-stream (socket)
  (socket-make-stream socket :input t :output t))

(defun close-socket (socket)
  (socket-close socket))

(defun doukaku-45-server (port)
  (let ((socket (get-server-socket &quot;doritos&quot; port)))
    (handler-case
        (progn
          (format t &quot;listening on ~D~%&quot; port)
	  (do* ((client (get-client-socket socket) (get-client-socket socket))
		(stream (get-socket-stream client) (get-socket-stream client)))
	       (())
	    (let ((in (read-from-string (read-line stream))))
	      (if (valid-input-p in)
		  (let ((mesg (apply #&#39;return-discount-price nil in)))
		    (print mesg) (terpri) ;サーバ側確認用
		    (princ mesg stream))
		  (let ((mesg (format nil &quot;~Sは不正な入力形式です。(価格 値引き率(0〜100%))&quot; in)))
		    (print mesg) (terpri) ;サーバ側確認用
		    (princ mesg stream)))
	      (close-socket client))))
      (condition (c) (format t &quot;error occured: ~A~%&quot; c)) )
    (close-socket socket) ))

;; 2000番ポートでサーバ起動
(doukaku-45-server 2000)
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/3167/addtag/" class="addtag" id="addtag_3167">タグ</a>:
	
	タグなし
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/commonlisp/">
		Common Lisp
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/3167/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/3167/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_3167"
  >-</span><span
  class="button yellow"
  id="rating_z_3167"
  >0</span><span 
  class="button green"
  id="rating_p_3167"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/3167/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  <br/>

  
  




<div class="comment" id="comment3767">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/26/" target="_top">dankogai</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#medal" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/star_gold.png" border=0/></a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/3767/">#3767</a>(<script language="JavaScript">print_time(new Date("2007/11/08 15:01 GMT"));</script><noscript>2007/11/08 15:01 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/perl/">
	  Perl
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  <pre class='compact'>これまたPerlのカバレッジを上げるため。
非常にtrivialなAPI.
http://host/dir/doukaku_remote/fun/arg/more/args
にアクセスすると、text/plainで
Remote::Server::Trivial::fun(arg,more,args)
の実行結果が返る。

測定環境として，
・Server: FreeBSD 6.2-Stable; Xeon 2.4GHz; 2GB RAM; apache-1.3.x; mod_perl
・完全remote
・Perl 5.8.8

速度はmod_perlで100req/sほど。Web API、単一serverとしては悪くないかな。

もっともこの程度のtrivialな作業にHTTPはいささか重たくもあるのではあるけれど。

Dan the Perl Monger</pre>
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></td><td class="code"><div class="highlight"><pre><span class="c1">#!/usr/local/bin/perl</span>
<span class="c1">#</span>
<span class="c1"># $Id: doukaku_remote.cgi,v 0.1 2007/11/08 14:49:27 dankogai Exp dankogai $</span>
<span class="c1">#</span>
<span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>
<span class="k">use</span> <span class="n">CGI</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">URI::</span><span class="n">Escape</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">CGI::</span><span class="n">Carp</span> <span class="n">qw</span><span class="sr">/fatalsToBrowser/</span><span class="p">;</span>

<span class="k">sub </span><span class="nf">Remote</span><span class="p">::Server::Trivial::pricestring{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$price</span><span class="p">,</span> <span class="nv">$discount</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$dprice</span> <span class="o">=</span> <span class="nv">$price</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nv">$discount</span><span class="o">/</span><span class="mi">100</span><span class="p">);</span>
    <span class="s">&quot;Price: $dprice Yen ($discount% discount from $price Yen)\n&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">my</span> <span class="p">(</span><span class="nv">@args</span><span class="p">)</span>  <span class="o">=</span> <span class="nb">split</span> <span class="sr">m/\//</span><span class="p">,</span> <span class="n">uri_unescape</span><span class="p">(</span><span class="nv">$ENV</span><span class="p">{</span><span class="n">PATH_INFO</span><span class="p">});</span>
<span class="nb">shift</span> <span class="nv">@args</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$cmd</span> <span class="o">=</span> <span class="nb">shift</span> <span class="nv">@args</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$result</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">{</span> 
    <span class="nb">no</span> <span class="n">strict</span> <span class="s">&#39;refs&#39;</span><span class="p">;</span>
    <span class="o">&amp;</span><span class="p">{</span><span class="s">&#39;Remote::Server::Trivial::&#39;</span> <span class="o">.</span> <span class="nv">$cmd</span><span class="p">}(</span><span class="nv">@args</span><span class="p">);</span>
<span class="p">};</span>
<span class="nb">die</span> <span class="vg">$@</span> <span class="k">if</span> <span class="vg">$@</span><span class="p">;</span>
<span class="k">use</span> <span class="n">bytes</span><span class="p">;</span>
<span class="k">print</span>
    <span class="s">&quot;Content-Type: text/plain\n&quot;</span><span class="p">,</span>
    <span class="s">&quot;Content-Length: &quot;</span><span class="p">,</span> <span class="nn">bytes::</span><span class="n">length</span><span class="p">(</span><span class="nv">$result</span><span class="p">),</span> <span class="s">&quot;\n\n&quot;</span><span class="p">,</span>
    <span class="nv">$result</span><span class="p">;</span>
<span class="c1"># end of server</span>

<span class="c1">#!/usr/local/bin/perl</span>
<span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">LWP::</span><span class="n">Simple</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$times</span> <span class="o">=</span> <span class="nb">shift</span> <span class="o">||</span> <span class="mi">10000</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$api_root</span> <span class="o">=</span> <span class="s">&#39;http://where.ever/you/put/doukaku_remote.cgi&#39;</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$cmd</span> <span class="o">=</span> <span class="s">&quot;pricestring&quot;</span><span class="p">;</span>

<span class="vg">$|</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="c1"># autoflush;</span>
<span class="k">for</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="nv">$times</span><span class="p">){</span>
    <span class="k">my</span> <span class="nv">$req</span> <span class="o">=</span> <span class="nb">join</span> <span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="nv">$api_root</span><span class="p">,</span> <span class="nv">$cmd</span><span class="p">,</span> <span class="nv">$_</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="nb">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
    <span class="k">my</span> <span class="nv">$result</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="nv">$req</span><span class="p">);</span>
    <span class="nb">chomp</span> <span class="nv">$result</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;$_:$result\r&quot;</span>
<span class="p">}</span>
<span class="k">print</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
<span class="c1">#end of client</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/3767/addtag/" class="addtag" id="addtag_3767">タグ</a>:
	
	タグなし
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/perl/">
		Perl
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/3767/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/3767/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_3767"
  >-</span><span
  class="button yellow"
  id="rating_z_3767"
  >0</span><span 
  class="button green"
  id="rating_p_3767"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/3767/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment4375">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/582/" target="_top">jijixi</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/4375/">#4375</a>(<script language="JavaScript">print_time(new Date("2007/11/23 13:05 GMT"));</script><noscript>2007/11/23 13:05 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/ocaml/">
	  OCaml
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #dfffdf;">2/2=1.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  JoCaml&nbsp;は&nbsp;OCaml&nbsp;に並行プログラミングの概念の一つである&nbsp;join&nbsp;calculus&nbsp;のサポートを組み込んだ言語です。<br/>並行プログラミングと分散プログラミングがサポートされています。<br/><br/>server.ml&nbsp;を動かした状態で&nbsp;client.ml&nbsp;を動かすことで、サーバ側に定義されている&nbsp;price_string&nbsp;関数が&nbsp;10000&nbsp;回実行されます。<br/><br/>サーバ:<br/>&nbsp;Mac&nbsp;OS&nbsp;X&nbsp;10.5&nbsp;PPC&nbsp;G5/1.8GHz&nbsp;mem:1GB<br/>クライアント:<br/>&nbsp;FreeBSD&nbsp;6.2R&nbsp;Pen3/550MHz&nbsp;mem:256MB<br/><br/>という環境でテストしました。<br/>まずインタプリタで、<br/><br/>&nbsp;server%&nbsp;jocaml&nbsp;server.ml&nbsp;10000<br/>&nbsp;listening&nbsp;address&nbsp;10.0.1.5<br/>&nbsp;listening&nbsp;port&nbsp;10000<br/><br/>&nbsp;client%&nbsp;time&nbsp;jocaml&nbsp;client.ml&nbsp;10.0.1.5&nbsp;10000<br/>&nbsp;jocaml&nbsp;client.ml&nbsp;10.0.1.5&nbsp;10000&nbsp;&nbsp;12.28s&nbsp;user&nbsp;1.09s&nbsp;system&nbsp;69%&nbsp;cpu&nbsp;19.178&nbsp;total<br/><br/>jocamlopt&nbsp;でネイティブコンパイルしたもので、<br/><br/>&nbsp;server%&nbsp;./server&nbsp;10000<br/><br/>&nbsp;client%&nbsp;time&nbsp;./client&nbsp;10.0.1.5&nbsp;10000<br/>&nbsp;./client&nbsp;10.0.1.5&nbsp;10000&nbsp;&nbsp;4.84s&nbsp;user&nbsp;1.17s&nbsp;system&nbsp;60%&nbsp;cpu&nbsp;9.930&nbsp;total<br/><br/>といった感じでした。<br/>実行される関数はサーバ側に定義されているので、実際の実行はサーバ側でされています。<br/>それと、JoCaml&nbsp;では&nbsp;for&nbsp;文が並行実行されるので、client.ml&nbsp;での&nbsp;price_string&nbsp;の呼び出しはおそらく直列には動いていません。
	</div>
	
	<p class="link">
	  参考: <a href="/web/20090404175547/http://jocaml.inria.fr/">The JoCaml system</a>
	</p>  
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67</pre></td><td class="code"><div class="highlight"><pre><span class="c">(* server.ml *)</span>

<span class="n">def</span> <span class="n">price_string</span><span class="k">(</span><span class="n">value</span><span class="k">,</span> <span class="n">discount</span><span class="k">)</span> <span class="k">=</span>
   <span class="kr">let</span> <span class="n">comma_sep</span> <span class="k">()</span> <span class="n">num</span> <span class="k">=</span>
      <span class="kr">let</span> <span class="n">str</span>  <span class="k">=</span> <span class="n">Printf</span><span class="k">.</span><span class="n">sprintf</span> <span class="s2">&quot;%d&quot;</span> <span class="n">num</span> <span class="kr">in</span>
      <span class="kr">let</span> <span class="n">len</span>  <span class="k">=</span> <span class="n">String</span><span class="k">.</span><span class="n">length</span> <span class="n">str</span> <span class="kr">in</span>
      <span class="kr">let</span> <span class="kr">rec</span> <span class="n">s_to_l</span> <span class="n">r</span> <span class="n">i</span> <span class="k">=</span>
         <span class="kr">if</span> <span class="n">i</span> <span class="k">&gt;=</span> <span class="n">len</span> <span class="kr">then</span> <span class="n">r</span>
         <span class="kr">else</span>
            <span class="n">s_to_l</span> <span class="k">(</span><span class="n">str</span><span class="k">.[</span><span class="n">i</span><span class="k">]</span> <span class="k">::</span> <span class="n">r</span><span class="k">)</span> <span class="k">(</span><span class="n">i</span> <span class="k">+</span> <span class="mi">1</span><span class="k">)</span>
      <span class="kr">in</span>
      <span class="kr">let</span> <span class="n">str&#39;</span><span class="k">,</span> <span class="k">_</span> <span class="k">=</span>
         <span class="n">List</span><span class="k">.</span><span class="n">fold_left</span> <span class="kr">begin</span> <span class="kr">fun</span> <span class="k">(</span><span class="n">s</span><span class="k">,</span> <span class="n">i</span><span class="k">)</span> <span class="n">ch</span> <span class="k">-&gt;</span>
            <span class="kr">match</span> <span class="n">i</span> <span class="kr">with</span>
            <span class="k">|</span> <span class="mi">3</span> <span class="k">-&gt;</span> <span class="k">(</span><span class="n">ch</span> <span class="k">::</span> <span class="sc">&#39;,&#39;</span> <span class="k">::</span> <span class="n">s</span><span class="k">,</span> <span class="mi">0</span><span class="k">)</span>
            <span class="k">|</span> <span class="n">i</span> <span class="k">-&gt;</span> <span class="k">(</span><span class="n">ch</span> <span class="k">::</span> <span class="n">s</span><span class="k">,</span> <span class="k">(</span><span class="n">i</span> <span class="k">+</span> <span class="mi">1</span><span class="k">))</span>
         <span class="kr">end</span> <span class="k">([],</span> <span class="mi">0</span><span class="k">)</span> <span class="k">(</span><span class="n">s_to_l</span> <span class="k">[]</span> <span class="mi">0</span><span class="k">)</span>
      <span class="kr">in</span>
      <span class="n">List</span><span class="k">.</span><span class="n">fold_left</span> <span class="kr">begin</span> <span class="kr">fun</span> <span class="n">acc</span> <span class="n">ch</span> <span class="k">-&gt;</span>
         <span class="n">acc</span> <span class="o">^</span> <span class="k">(</span><span class="n">String</span><span class="k">.</span><span class="n">make</span> <span class="mi">1</span> <span class="n">ch</span><span class="k">)</span>
      <span class="kr">end</span> <span class="s2">&quot;&quot;</span> <span class="n">str&#39;</span>
   <span class="kr">in</span>
   <span class="kr">let</span> <span class="n">new_value</span> <span class="k">=</span> <span class="n">value</span> <span class="k">*</span> <span class="k">(</span><span class="mi">100</span> <span class="k">-</span> <span class="n">discount</span><span class="k">)</span> <span class="o">/</span> <span class="mi">100</span> <span class="kr">in</span>
   <span class="kr">let</span> <span class="n">msg</span> <span class="k">=</span>
      <span class="n">Printf</span><span class="k">.</span><span class="n">sprintf</span> <span class="s2">&quot;販売価格 %a円 (定価%a円から%d%%引き)&quot;</span>
                     <span class="n">comma_sep</span> <span class="n">new_value</span> <span class="n">comma_sep</span> <span class="n">value</span> <span class="n">discount</span>
   <span class="kr">in</span>
   <span class="n">reply</span> <span class="n">msg</span> <span class="kr">to</span> <span class="n">price_string</span>

<span class="kr">let</span> <span class="n">main</span> <span class="k">()</span> <span class="k">=</span>
   <span class="kr">match</span> <span class="n">Sys</span><span class="k">.</span><span class="n">argv</span> <span class="kr">with</span>
   <span class="k">|</span> <span class="k">[|_;</span> <span class="n">listen_port</span><span class="k">|]</span> <span class="k">-&gt;</span> <span class="kr">begin</span>
        <span class="kr">let</span> <span class="n">addr</span> <span class="k">=</span> <span class="n">Join</span><span class="k">.</span><span class="n">Site</span><span class="k">.</span><span class="n">get_local_addr</span> <span class="k">()</span> <span class="kr">in</span>
        <span class="kr">let</span> <span class="n">addr_str</span> <span class="k">=</span> <span class="n">Unix</span><span class="k">.</span><span class="n">string_of_inet_addr</span> <span class="n">addr</span> <span class="kr">in</span>
        <span class="kr">let</span> <span class="n">sock</span> <span class="k">=</span> <span class="n">Unix</span><span class="k">.</span><span class="n">ADDR_INET</span> <span class="k">(</span><span class="n">addr</span><span class="k">,</span> <span class="n">int_of_string</span> <span class="n">listen_port</span><span class="k">)</span> <span class="kr">in</span>
        <span class="n">List</span><span class="k">.</span><span class="n">iter</span> <span class="n">print_endline</span>
           <span class="k">[</span><span class="s2">&quot;listening address &quot;</span> <span class="o">^</span> <span class="n">addr_str</span><span class="k">;</span>
            <span class="s2">&quot;listening port &quot;</span> <span class="o">^</span> <span class="n">listen_port</span><span class="k">];</span>
        <span class="n">Join</span><span class="k">.</span><span class="n">Ns</span><span class="k">.</span><span class="n">register</span> <span class="n">Join</span><span class="k">.</span><span class="n">Ns</span><span class="k">.</span><span class="n">here</span> <span class="s2">&quot;price_string&quot;</span> <span class="n">price_string</span><span class="k">;</span>
        <span class="n">Join</span><span class="k">.</span><span class="n">Site</span><span class="k">.</span><span class="n">listen</span> <span class="n">sock</span><span class="k">;</span>
        <span class="n">at_exit</span> <span class="n">Join</span><span class="k">.</span><span class="n">exit_hook</span>
     <span class="kr">end</span>
   <span class="k">|</span> <span class="k">_</span> <span class="k">-&gt;</span>
        <span class="n">print_endline</span> <span class="s2">&quot;usage: command listen_port&quot;</span>

<span class="kr">let</span> <span class="k">()</span> <span class="k">=</span> <span class="kr">if</span> <span class="n">not</span> <span class="o">!</span><span class="n">Sys</span><span class="k">.</span><span class="n">interactive</span> <span class="kr">then</span> <span class="n">main</span> <span class="k">()</span>


<span class="c">(* client.ml *)</span>

<span class="kr">let</span> <span class="n">main</span> <span class="k">()</span> <span class="k">=</span>
   <span class="kr">match</span> <span class="n">Sys</span><span class="k">.</span><span class="n">argv</span> <span class="kr">with</span>
   <span class="k">|</span> <span class="k">[|_;</span> <span class="n">server_addr</span><span class="k">;</span> <span class="n">server_port</span><span class="k">|]</span> <span class="k">-&gt;</span>
        <span class="kr">let</span> <span class="n">addr</span> <span class="k">=</span> <span class="n">Unix</span><span class="k">.</span><span class="n">inet_addr_of_string</span> <span class="n">server_addr</span> <span class="kr">in</span>
        <span class="kr">let</span> <span class="n">sock</span> <span class="k">=</span> <span class="n">Unix</span><span class="k">.</span><span class="n">ADDR_INET</span> <span class="k">(</span><span class="n">addr</span><span class="k">,</span> <span class="k">(</span><span class="n">int_of_string</span> <span class="n">server_port</span><span class="k">))</span> <span class="kr">in</span>
        <span class="kr">let</span> <span class="n">namespace</span> <span class="k">=</span> <span class="n">Join</span><span class="k">.</span><span class="n">Ns</span><span class="k">.</span><span class="n">there</span> <span class="n">sock</span> <span class="kr">in</span>
        <span class="kr">let</span> <span class="n">price_string</span> <span class="k">:</span> <span class="n">int</span> <span class="k">*</span> <span class="n">int</span> <span class="k">-&gt;</span> <span class="n">string</span> <span class="k">=</span>
           <span class="n">Join</span><span class="k">.</span><span class="n">Ns</span><span class="k">.</span><span class="n">lookup</span> <span class="n">namespace</span> <span class="s2">&quot;price_string&quot;</span>
        <span class="kr">in</span>
        <span class="kr">for</span> <span class="n">i</span> <span class="k">=</span> <span class="mi">0</span> <span class="kr">to</span> <span class="mi">10000</span> <span class="kr">do</span>
           <span class="n">ignore</span> <span class="k">(</span><span class="n">price_string</span> <span class="k">(</span><span class="mi">2000</span><span class="k">,</span> <span class="mi">20</span><span class="k">))</span>
        <span class="kr">done</span><span class="k">;</span>
        <span class="n">print_endline</span> <span class="k">(</span><span class="n">price_string</span> <span class="k">(</span><span class="mi">2000</span><span class="k">,</span> <span class="mi">20</span><span class="k">))</span>
   <span class="k">|</span> <span class="k">_</span> <span class="k">-&gt;</span>
        <span class="n">print_endline</span> <span class="s2">&quot;usage: command server_address server_port&quot;</span>

<span class="kr">let</span> <span class="k">()</span> <span class="k">=</span> <span class="kr">if</span> <span class="n">not</span> <span class="o">!</span><span class="n">Sys</span><span class="k">.</span><span class="n">interactive</span> <span class="kr">then</span> <span class="n">main</span> <span class="k">()</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/4375/addtag/" class="addtag" id="addtag_4375">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/JoCaml/">JoCaml</a>
    
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/ocaml/">
		OCaml
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/4375/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/4375/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #dfffdf;"
  >2/2=1.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_4375"
  >-</span><span
  class="button yellow"
  id="rating_z_4375"
  >0</span><span 
  class="button green"
  id="rating_p_4375"
  >+</span></span></span>
  

<p>

  

  <a href="/web/20090404175547/http://ja.doukaku.org/comment/4375/">
    1
    reply
  </a>

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/4375/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment4389">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/582/" target="_top">jijixi</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/4389/">#4389</a>(<script language="JavaScript">print_time(new Date("2007/11/24 11:35 GMT"));</script><noscript>2007/11/24 11:35 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/diff/">
	  diff
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  &gt;&nbsp;それと、JoCaml&nbsp;では&nbsp;for&nbsp;文が並行実行されるので、client.ml&nbsp;での&nbsp;price_string&nbsp;の呼び出しはおそらく直列には動いていません。<br/><br/>うっかりしてました。<br/>この話はプロセスコンテキストでは正しいですが、投稿したコードの例では&nbsp;for&nbsp;は式コンテキストで使われているので、この場合は直列に動いているはずです。<br/><br/>この例で並行に動かすなら&nbsp;for&nbsp;の前に&nbsp;spawn&nbsp;を追加すれば良いと思います。(diff&nbsp;参照)<br/>その場合&nbsp;for&nbsp;の内部はプロセスコンテキストになるので、price_string&nbsp;をプロセス扱いにするために空のプロセス&nbsp;0&nbsp;を付け足しています。
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></td><td class="code"><div class="highlight"><pre><span class="gd">--- client.ml.orig    2007-11-24 20:24:55.000000000 +0900</span>
<span class="gi">+++ client.ml    2007-11-24 20:31:51.000000000 +0900</span>
<span class="gu">@@ -9,8 +9,8 @@</span>
         let price_string : int * int -&gt; string =
            Join.Ns.lookup namespace &quot;price_string&quot;
         in
<span class="gd">-        for i = 0 to 10000 do</span>
<span class="gd">-           ignore (price_string (2000, 20))</span>
<span class="gi">+        spawn for i = 0 to 10000 do</span>
<span class="gi">+           (ignore (price_string (2000, 20)); 0)</span>
         done;
         print_endline (price_string (2000, 20))
    | _ -&gt;
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/4389/addtag/" class="addtag" id="addtag_4389">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/JoCaml/">JoCaml</a>
    
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/diff/">
		diff
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/4389/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/4389/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_4389"
  >-</span><span
  class="button yellow"
  id="rating_z_4389"
  >0</span><span 
  class="button green"
  id="rating_p_4389"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/4375/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20090404175547/http://ja.doukaku.org/comment/4389/root/"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/4389/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>

  
  




<div class="comment" id="comment4538">
  <p class="banner"><a href="/web/20090404175547/http://ja.doukaku.org/user/592/" target="_top">t_ishida</a><a href="/web/20090404175547/http://ja.doukaku.org/qa/#anomark" target="_top"><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/anomark.png" border=0/></a>

	
	&nbsp;
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/4538/">#4538</a>(<script language="JavaScript">print_time(new Date("2007/12/01 07:43 GMT"));</script><noscript>2007/12/01 07:43 GMT</noscript>)
	
	
	
	[<a href="/web/20090404175547/http://ja.doukaku.org/lang/javascript/">
	  JavaScript
	</a>]
	
	
	
	&nbsp;

<span class="rating">評価<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content">
	<div class="comment_body">
	  
<p>テキストのみの通信にしちゃいました。
   CPU 2.8G
   MEM 1G
   WinXP Pro IIS
</p>
<p>で実行したところ、
   こんな感じです。
</p>
<p>販売価格 1,600円 (定価2,000から20%引き)
   st=1196494169386
   et=1196494432558
   10000回：263.172秒かかってまっせ。
</p>



	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></td><td class="code"><div class="highlight"><pre><span class="o">--</span><span class="nx">HTML</span><span class="err">側</span><span class="p">(</span><span class="nx">doukaku</span><span class="p">.</span><span class="nx">html</span><span class="p">)</span>
<span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="s2">&quot;Content-Type&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;text/html; charset=sjis&quot;</span><span class="o">&gt;</span><span class="p">.</span>
    <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
        <span class="k">var</span> <span class="nx">st</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
        <span class="k">var</span> <span class="nx">ajax</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">ActiveXObject</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span><span class="p">){</span>
          <span class="k">try</span>       <span class="p">{</span> <span class="nx">ajax</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ActiveXObject</span><span class="p">(</span><span class="s2">&quot;Microsoft.XMLHTTP&quot;</span><span class="p">);</span> <span class="p">}</span>
          <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="nx">ajax</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">ajax</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">XMLHttpRequest</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span>  <span class="nx">ajax</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
        <span class="k">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>    
        <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
            <span class="nx">ajax</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span> <span class="s1">&#39;GET&#39;</span><span class="o">,</span><span class="s1">&#39;doukaku.asp?x=2000&amp;y=20&#39;</span><span class="o">,</span> <span class="kc">false</span> <span class="p">);</span>
            <span class="nx">ajax</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span> <span class="p">);</span>
            <span class="nx">txt</span> <span class="o">=</span> <span class="nx">ajax</span><span class="p">.</span><span class="nx">responseText</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="k">var</span> <span class="nx">et</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;&#39;</span> <span class="o">+</span> <span class="nx">txt</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">);</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;st=&#39;</span> <span class="o">+</span> <span class="nx">st</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span> <span class="p">);</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;et=&#39;</span> <span class="o">+</span> <span class="nx">et</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span> <span class="p">);</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;&#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;回：&#39;</span> <span class="o">+</span>  <span class="p">(</span><span class="nx">et</span> <span class="o">-</span> <span class="nx">st</span><span class="p">)</span> <span class="sr">/ 1000 + &#39;秒かかってまっせ。&lt;/</span><span class="nx">div</span><span class="o">&gt;</span><span class="s1">&#39; );</span>
<span class="s1">        &lt;/script&gt;</span>
<span class="s1">    &lt;/body&gt;</span>
<span class="s1">&lt;/html&gt;</span>

<span class="s1">--SV側(doukaku.asp)</span>

<span class="s1">&lt;%@ Language=&quot;JavaScript&quot; %&gt;</span>
<span class="s1">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;.</span>
<span class="s1">&lt;%</span>
<span class="s1">var q = Request.QueryString;</span>
<span class="s1">function getPricestring( x, y ){</span>
<span class="s1">  x = x - 0; y = y - 0;</span>
<span class="s1">  return &quot;販売価格 &quot; + f( ( x * ( 100 - y ) / 100 ) ) + &quot;円 (定価&quot; + f(x) + &quot;から&quot; + y + &quot;%引き)&quot;;</span>
<span class="s1">  function f( x ){</span>
<span class="s1">    return x.toString().split(&#39;&#39;).reverse().join(&#39;&#39;).replace(/(\d{3})/g, &#39;</span><span class="nx">$1</span><span class="o">,</span><span class="s1">&#39;).split(&#39;&#39;).reverse().join(&#39;&#39;);</span>
<span class="s1">  }</span>
<span class="s1">}</span>
<span class="s1">%&gt;</span>
<span class="s1">&lt;%=getPricestring(q(&#39;</span><span class="nx">x</span><span class="s1">&#39;),q(&#39;</span><span class="nx">y</span><span class="err">&#39;</span><span class="p">))</span><span class="o">%&gt;</span>
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20090404175547/http://ja.doukaku.org/comment/4538/addtag/" class="addtag" id="addtag_4538">タグ</a>:
	
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/AJAJA/">AJAJA</a>
    
    <a href="/web/20090404175547/http://ja.doukaku.org/tag/ASP/">ASP</a>
    
	&nbsp;

	
      [<a href="/web/20090404175547/http://ja.doukaku.org/lang/javascript/">
		JavaScript
      </a>]
	  
      [<a href="/web/20090404175547/http://ja.doukaku.org/comment/4538/download/">
		ダウンロード
      </a>]
	  [<a href="/web/20090404175547/http://ja.doukaku.org/comment/4538/download_html/">
		HTML
      </a>]<p>
	

  
  <span class="rating">
  評価<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_4538"
  >-</span><span
  class="button yellow"
  id="rating_z_4538"
  >0</span><span 
  class="button green"
  id="rating_p_4538"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20090404175547/http://ja.doukaku.org/45/reply_to/4538/">
  返信
  </a>]
  </div>
</div>
</div>

  
  <br/>







</div>

<div id="side_menu" class="compact">

<iframe src="/web/20090404175547if_/http://ja.doukaku.org/login_info/" frameborder=0 width=100% id="login_info">
iframe required
</iframe>

<h4 class="semi_compact">一覧</h4>

<ul>
<!--<li><a href="/web/20090404175547/http://ja.doukaku.org/user/">ユーザ</a>-->
<li><a href="/web/20090404175547/http://ja.doukaku.org/lang/">言語</a>
<li><a href="/web/20090404175547/http://ja.doukaku.org/challenge/">お題</a>
<li><a href="/web/20090404175547/http://ja.doukaku.org/topic/">トピック</a>
<li><a href="/web/20090404175547/http://ja.doukaku.org/comment/">投稿</a>
<li><a href="/web/20090404175547/http://ja.doukaku.org/good_comments/">評価の高い投稿</a>
<li><a href="/web/20090404175547/http://ja.doukaku.org/tag/">タグ</a>
</ul>

<h4 class="compact">フィード</h4>
<ul>
<li><a href="/web/20090404175547/http://ja.doukaku.org/feeds/challenges/">最新のお題</a><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/feed_icon.png">
<li><a href="/web/20090404175547/http://ja.doukaku.org/feeds/topics/">最新のトピック</a><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/feed_icon.png">
<li><a href="/web/20090404175547/http://ja.doukaku.org/feeds/comments/">新着投稿</a><img src="/web/20090404175547im_/http://ja.doukaku.org/static/image/feed_icon.png">
</ul>







<h4 class="compact">その他</h4>
<ul>
<li><a href="/web/20090404175547/http://ja.doukaku.org/qa/">Q&A</a>
<li><a href="/web/20090404175547/http://ja.doukaku.org/feedback/">フィードバック</a>
<!--<li><a href="/web/20090404175547/http://ja.doukaku.org/terms">用語集</a>-->
</ul>


<h4 class="compact">リンク</h4>
<ul>
<li><a href="/web/20090404175547/http://www.lingr.com/room/doukaku_ja">チャットルーム(Lingr)</a>
<li><a href="/web/20090404175547/http://labs.cybozu.co.jp/">サイボウズ・ラボ</a>
<li><a href="/web/20090404175547/http://www.djangoproject.com/">Django</a>
</ul>

<h4 id="pathtraq" class="compact"><a href="/web/20090404175547/http://pathtraq.com/analytics?url=http%3A%2F%2Fja.doukaku.org%2Fcomment%2F*%2F%20desc%3A%E3%81%A9%E3%81%86%E6%9B%B8%E3%81%8Forg&m=popular">Pathtraq</a></h4>
<div class="indent">
<span id="pathtraq_sentinel">loading...</span>
</div>


</div>
</div>


<div id="page_foot" class="bordered">

<a rel="license" href="/web/20090404175547/http://creativecommons.org/licenses/by/2.1/jp/">
<img alt="Creative Commons License" style="border-width:0" src="/web/20090404175547im_/http://i.creativecommons.org/l/by/2.1/jp/88x31.png" /></a>
このサイトの内容は、
<a rel="license" href="/web/20090404175547/http://creativecommons.org/licenses/by/2.1/jp/">クリエイティブ・コモンズ・ライセンス</a>の下でライセンスされています。
<a href="/web/20090404175547/http://ja.doukaku.org/qa/#licence">[詳細]</a>

</div>

</body>




<script type="text/javascript">
$(document).ready(function(){$("#doukaku_org").after("<script src='/web/20090404175547/http://api.pathtraq.com/pages?url=http%3A%2F%2Fja.doukaku.org%2Fcomment%2F*%2F%20desc%3A%E3%81%A9%E3%81%86%E6%9B%B8%E3%81%8Forg&api=json&callback=addPathtraq'><" + "/script>")});
</script>

<script src="/web/20090404175547js_/http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-2136157-1";
urchinTracker();
</script>




</html>





<!--
     FILE ARCHIVED ON 17:55:47 Apr 4, 2009 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 13:47:33 Nov 16, 2013.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
