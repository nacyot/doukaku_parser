
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja"> 
  <head>

<script type="text/javascript" src="/static/js/analytics.js" ></script>
<link type="text/css" rel="stylesheet" href="/static/css/banner-styles.css"/>




    <meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
    <title>
情報オリンピック2007年度世界大会「洪水」
DouKaku? </title>

    <link rel="stylesheet" type="text/css"
	href="/web/20081122151140cs_/http://ja.doukaku.org/static/style/reset-fonts-grids.css" />
    <link rel="stylesheet" type="text/css"
	href="/web/20081122151140cs_/http://ja.doukaku.org/static/style/style.css?20071211?20071207" />
	
    <link rel="stylesheet" type="text/css"
	href="/web/20081122151140cs_/http://ja.doukaku.org/static/style/pygments.css" />


	
    <!--<script src="/web/20081122151140/http://ja.doukaku.org/static/js/ieerbug/ieerbug.js" type="text/javascript"></script>-->


<!--<script src="/web/20081122151140/http://ja.doukaku.org/static/js/ieerbug/ieerbug.js" type="text/javascript"></script>-->
<script src="/web/20081122151140js_/http://ja.doukaku.org/static/js/jquery-1.1.3.1.js" type="text/javascript"></script>
<script src="/web/20081122151140js_/http://ja.doukaku.org/static/js/rating.js" type="text/javascript"></script>
<script src="/web/20081122151140js_/http://ja.doukaku.org/static/js/addtag.js?20071129" type="text/javascript"></script>

<script type="text/javascript">
is_key_navigation_enable = true;
</script>
<script src="/web/20081122151140js_/http://ja.doukaku.org/static/js/utils.js?~~~" type="text/javascript"></script>

</head>


<body id="doukaku_org">
<!-- BEGIN WAYBACK TOOLBAR INSERT -->
<script> if (window.archive_analytics) { window.archive_analytics.values['server_name']="wwwb-app3.us.archive.org";}; </script>

<script type="text/javascript" src="/static/js/disclaim-element.js" ></script>
<script type="text/javascript" src="/static/js/graph-calc.js" ></script>
<script type="text/javascript" src="/static/jflot/jquery.min.js" ></script>
<script type="text/javascript">
//<![CDATA[
var firstDate = 820454400000;
var lastDate = 1388534399999;
var wbPrefix = "/web/";
var wbCurrentUrl = "http:\/\/ja.doukaku.org\/153\/nested\/";

var curYear = -1;
var curMonth = -1;
var yearCount = 18;
var firstYear = 1996;
var imgWidth = 450;
var yearImgWidth = 25;
var monthImgWidth = 2;
var trackerVal = "none";
var displayDay = "22";
var displayMonth = "Nov";
var displayYear = "2008";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function showTrackers(val) {
	if(val == trackerVal) {
		return;
	}
	if(val == "inline") {
		document.getElementById("displayYearEl").style.color = "#ec008c";
		document.getElementById("displayMonthEl").style.color = "#ec008c";
		document.getElementById("displayDayEl").style.color = "#ec008c";		
	} else {
		document.getElementById("displayYearEl").innerHTML = displayYear;
		document.getElementById("displayYearEl").style.color = "#ff0";
		document.getElementById("displayMonthEl").innerHTML = displayMonth;
		document.getElementById("displayMonthEl").style.color = "#ff0";
		document.getElementById("displayDayEl").innerHTML = displayDay;
		document.getElementById("displayDayEl").style.color = "#ff0";
	}
   document.getElementById("wbMouseTrackYearImg").style.display = val;
   document.getElementById("wbMouseTrackMonthImg").style.display = val;
   trackerVal = val;
}
function getElementX2(obj) {
	var thing = jQuery(obj);
	if((thing == undefined) 
			|| (typeof thing == "undefined") 
			|| (typeof thing.offset == "undefined")) {
		return getElementX(obj);
	}
	return Math.round(thing.offset().left);
}
function trackMouseMove(event,element) {

   var eventX = getEventX(event);
   var elementX = getElementX2(element);
   var xOff = eventX - elementX;
	if(xOff < 0) {
		xOff = 0;
	} else if(xOff > imgWidth) {
		xOff = imgWidth;
	}
   var monthOff = xOff % yearImgWidth;

   var year = Math.floor(xOff / yearImgWidth);
	var yearStart = year * yearImgWidth;
   var monthOfYear = Math.floor(monthOff / monthImgWidth);
   if(monthOfYear > 11) {
       monthOfYear = 11;
   }
   // 1 extra border pixel at the left edge of the year:
   var month = (year * 12) + monthOfYear;
   var day = 1;
	if(monthOff % 2 == 1) {
		day = 15;
	}
	var dateString = 
		zeroPad(year + firstYear) + 
		zeroPad(monthOfYear+1,2) +
		zeroPad(day,2) + "000000";

	var monthString = prettyMonths[monthOfYear];
	document.getElementById("displayYearEl").innerHTML = year + 1996;
	document.getElementById("displayMonthEl").innerHTML = monthString;
	// looks too jarring when it changes..
	//document.getElementById("displayDayEl").innerHTML = zeroPad(day,2);

	var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
	document.getElementById('wm-graph-anchor').href = url;

   //document.getElementById("wmtbURL").value="evX("+eventX+") elX("+elementX+") xO("+xOff+") y("+year+") m("+month+") monthOff("+monthOff+") DS("+dateString+") Moy("+monthOfYear+") ms("+monthString+")";
   if(curYear != year) {
       var yrOff = year * yearImgWidth;
       document.getElementById("wbMouseTrackYearImg").style.left = yrOff + "px";
       curYear = year;
   }
   if(curMonth != month) {
       var mtOff = year + (month * monthImgWidth) + 1;
       document.getElementById("wbMouseTrackMonthImg").style.left = mtOff + "px";
       curMonth = month;
   }
}
//]]>
</script>

<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>
<div id="wm-ipp" lang="en" class="__wb_banner_div" style="display:none; position:relative;padding:0 5px;min-height:70px;min-width:800px">


<div id="wm-ipp-inside" class="__wb_banner_div" style="position:fixed;padding:0!important;margin:0!important;width:97%;min-width:780px;border:5px solid #000;border-top:none;background-image:url(/static/images/toolbar/wm_tb_bk_trns.png);text-align:center;-moz-box-shadow:1px 1px 3px #333;-webkit-box-shadow:1px 1px 3px #333;box-shadow:1px 1px 3px #333;font-size:11px!important;font-family:'Lucida Grande','Arial',sans-serif!important;">
   <table style="border-collapse:collapse;margin:0;padding:0;width:100%;"><tbody><tr>
   <td style="padding:10px;vertical-align:top;min-width:110px;">
   <a href="/web/" title="Wayback Machine home page" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0"/></a>
   </td>
   <td style="padding:0!important;text-align:center;vertical-align:top;width:100%;">

       <table style="border-collapse:collapse;margin:0 auto;padding:0;width:570px;"><tbody><tr>
       <td style="padding:3px 0;" colspan="2">
       <form target="_top" method="get" action="/web/form-submit.jsp" name="wmtb" id="wmtb" style="margin:0!important;padding:0!important;"><input type="text" name="url" id="wmtbURL" value="http://ja.doukaku.org/153/nested/" style="width:400px;font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;" onfocus="javascript:this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20081122151140" /><input type="submit" value="Go" style="font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;margin-left:5px;width: inherit !important" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td style="vertical-align:bottom;padding:5px 0 0 0!important;" rowspan="2">
           <table style="border-collapse:collapse;width:110px;color:#99a;font-family:'Helvetica','Lucida Grande','Arial',sans-serif;"><tbody>
			
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr style="width:110px;height:16px;font-size:10px!important;">
           	<td style="padding-right:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
                       Oct
                       
               </td>
               <td id="displayMonthEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight:bold;text-transform:uppercase;width:34px;height:15px;padding-top:1px;text-align:center;" title="You are here: 15:11:40 Nov 22, 2008">NOV</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
                       Dec
                       
               </td>
           </tr>

           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr>
               <td style="padding-right:9px;white-space:nowrap;overflow:visible;text-align:right!important;vertical-align:middle!important;" nowrap="nowrap">
               
                       <img src="/static/images/toolbar/wm_tb_prv_off.png" alt="Previous capture" width="14" height="16" border="0" />
                       
               </td>
               <td id="displayDayEl" style="background:#000;color:#ff0;width:34px;height:24px;padding:2px 0 0 0;text-align:center;font-size:24px;font-weight: bold;" title="You are here: 15:11:40 Nov 22, 2008">22</td>
				<td style="padding-left:9px;white-space:nowrap;overflow:visible;text-align:left!important;vertical-align:middle!important;" nowrap="nowrap">
               
                       <img src="/static/images/toolbar/wm_tb_nxt_off.png" alt="Next capture" width="14" height="16" border="0"/>
                       
			    </td>
           </tr>

           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr style="width:110px;height:13px;font-size:9px!important;">
				<td style="padding-right:9px;font-size:11px!important;font-weight: bold;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
                       2007
                       
               </td>
               <td id="displayYearEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight: bold;padding-top:1px;width:34px;height:13px;text-align:center;" title="You are here: 15:11:40 Nov 22, 2008">2008</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight: bold;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
                       2009
                       
				</td>
           </tr>
           </tbody></table>
       </td>

       </tr>
       <tr>
       <td style="vertical-align:middle;padding:0!important;">
           <a href="/web/20081122151140*/http://ja.doukaku.org/153/nested/" style="color:#33f;font-size:11px;font-weight:bold;background-color:transparent;border:none;" title="See a list of every capture for this URL"><strong>1 captures</strong></a>
           <div class="__wb_banner_div" style="margin:0!important;padding:0!important;color:#666;font-size:9px;padding-top:2px!important;white-space:nowrap;" title="Timespan for captures of this URL">22 Nov 08 - 22 Nov 08</div>
       </td>
       <td style="padding:0!important;">
       <a style="position:relative; white-space:nowrap; width:450px;height:27px;" href="" id="wm-graph-anchor">
       <div class="__wb_banner_div" id="wm-ipp-sparkline" style="position:relative; white-space:nowrap; width:450px;height:27px;background-color:#fff;cursor:pointer;border-right:1px solid #ccc;" title="Explore captures for this URL">
			<img id="sparklineImgId" style="position:absolute; z-index:9012; top:0px; left:0px;"
				onmouseover="showTrackers('inline');" 
				onmouseout="showTrackers('none');"
				onmousemove="trackMouseMove(event,this)"
				alt="sparklines"
				width="450"
				height="27"
				border="0"
				src="/web/jsp/graph.jsp?graphdata=450_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000000000000_2004:-1:000000000000_2005:-1:000000000000_2006:-1:000000000000_2007:-1:000000000000_2008:10:000000000010_2009:-1:000000000000_2010:-1:000000000000_2011:-1:000000000000_2012:-1:000000000000_2013:-1:000000000000"></img>
			<img id="wbMouseTrackYearImg" 
				style="display:none; position:absolute; z-index:9010;"
				width="25" 
				height="27"
				border="0"
				src="/static/images/toolbar/transp-yellow-pixel.png"></img>
			<img id="wbMouseTrackMonthImg"
				style="display:none; position:absolute; z-index:9011; " 
				width="2"
				height="27" 
				border="0"
				src="/static/images/toolbar/transp-red-pixel.png"></img>
       </div>
		</a>

       </td>
       </tr></tbody></table>
   </td>
   <td style="text-align:right;padding:5px;width:65px;font-size:11px!important;">
       <a href="javascript:;" onclick="document.getElementById('wm-ipp').style.display='none';" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_close.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;margin-bottom:23px;background-color:transparent;border:none;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_help.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;background-color:transparent;border:none;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>

</div>
</div>
<script type="text/javascript">
 var wmDisclaimBanner = document.getElementById("wm-ipp");
 if(wmDisclaimBanner != null) {
   disclaimElement(wmDisclaimBanner);
 }
</script>
<!-- END WAYBACK TOOLBAR INSERT -->


<div id="page_head" class="compact">
  <h1 class="compact">
    <a href="/web/20081122151140/http://ja.doukaku.org/">DouKaku?</a><img src="/web/20081122151140im_/http://ja.doukaku.org/static/image/beta.png" alt="beta">
  </h1>
</div>

<div id="page_body" class="compact">
<div id="content" class="compact">




<h2 class="compact">
[topic]
<a href="/web/20081122151140/http://ja.doukaku.org/153/">情報オリンピック2007年度世界大会「洪水」</a>
</h2>

    





<div class="comment" id="comment5754">
  <p class="banner"><a href="/web/20081122151140/http://ja.doukaku.org/user/689/" target="_top">yukoba</a>

	
	&nbsp;
	<a href="/web/20081122151140/http://ja.doukaku.org/comment/5754/">#5754</a>(<script language="JavaScript">print_time(new Date("2008/02/15 04:00 GMT"));</script><noscript>2008/02/15 04:00 GMT</noscript>)
	
	
	
	
	
	&nbsp;

<span class="rating">Rating<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content" >
	<div class="comment_body">
	  <p>中高生向けの情報オリンピックの世界大会2007年度の第1日目「洪水」です。コンテストは2日間にて行われます。クロアチアにて開催されました。</p>
<ul class="simple">
<li>問題文： <a class="reference" href="/web/20081122151140/http://www.ioi-jp.org/ioi/2007/problem/day1/flood-prob-j.pdf">http://www.ioi-jp.org/ioi/2007/problem/day1/flood-prob-j.pdf</a></li>
<li>テストデータ： <a class="reference" href="/web/20081122151140/http://www.hsin.hr/ioi2007/index.php?page=tasks">http://www.hsin.hr/ioi2007/index.php?page=tasks</a></li>
<li>問題一覧： <a class="reference" href="/web/20081122151140/http://www.ioi-jp.org/ioi/2007/problem/index.html">http://www.ioi-jp.org/ioi/2007/problem/index.html</a></li>
<li>コンテスト概要： <a class="reference" href="/web/20081122151140/http://www.ioi-jp.org/ioi/2007/index.html">http://www.ioi-jp.org/ioi/2007/index.html</a></li>
</ul>
<p>「問題ごとに、プログラムの実行時間（や使用メモリ量）に制限が設定されています。」にご注意ください。本問では、制限時間2秒、メモリ制限32MBとなっています。</p>
<p>入出力は標準入出力にて行います。</p>
<p>採点は、テストデータにおいて正しい結果が返ってくるかで採点されます。出題時はテストデータの一部のみが公開されており、全てのデータは出題時には公開されていません。</p>

	</div>
	
	
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20081122151140/http://ja.doukaku.org/comment/5754/addtag/" class="addtag" id="addtag_5754">Tags</a>:
	
    
    <a href="/web/20081122151140/http://ja.doukaku.org/tag/%E6%83%85%E5%A0%B1%E3%82%AA%E3%83%AA%E3%83%B3%E3%83%94%E3%83%83%E3%82%AF/">情報オリンピック</a>
    
	&nbsp;

	

  
  <span class="rating">
  Rating<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_5754"
  >-</span><span
  class="button yellow"
  id="rating_z_5754"
  >0</span><span 
  class="button green"
  id="rating_p_5754"
  >+</span></span></span>
  

<p>

  

  <a href="/web/20081122151140/http://ja.doukaku.org/comment/5754/">
    1
    reply
  </a>

  [<a href="/web/20081122151140/http://ja.doukaku.org/153/reply_to/5754/">
  reply
  </a>]
  </div>
</div>
</div>




  
    <div class="indent compact" style="position: relative;">
      <img src="/web/20081122151140im_/http://ja.doukaku.org/static/image/1x1dark_green.png" width=10 style="position: absolute;top:-10px;margin-left:8px;">
      





<div class="comment" id="comment5763">
  <p class="banner"><a href="/web/20081122151140/http://ja.doukaku.org/user/689/" target="_top">yukoba</a>

	
	&nbsp;
	<a href="/web/20081122151140/http://ja.doukaku.org/comment/5763/">#5763</a>(<script language="JavaScript">print_time(new Date("2008/02/16 02:21 GMT"));</script><noscript>2008/02/16 02:21 GMT</noscript>)
	
	
	
	[<a href="/web/20081122151140/http://ja.doukaku.org/lang/scala/">
	  Scala
	</a>]
	
	
	
	&nbsp;

<span class="rating">Rating<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content" >
	<div class="comment_body">
	  プログラムの制限時間もクリアしているバージョン。<br/>以下が擬似コードです。<br/><br/>-------------------------------------<br/><br/>{まだたどっていない壁}がある<br/>&nbsp;&nbsp;[全ての壁|座標でソート済み]in{まだたどっていない壁}から最初の壁をとる。次はこの配列番号から。<br/>&nbsp;&nbsp;左手に水:int＝頂点から右方向に壁&nbsp;なら&nbsp;1&nbsp;下方向なら&nbsp;-1<br/>&nbsp;&nbsp;最初の壁に戻ってくるまで、壁をたどる&nbsp;(do-while)<br/>&nbsp;&nbsp;&nbsp;&nbsp;{たどった壁}に入っている&nbsp;=&gt;&nbsp;{たどった壁}から{両方水の壁}へ移動<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{まだたどっていない壁}から{たどった壁}へ移動<br/>&nbsp;&nbsp;&nbsp;&nbsp;次の壁の始点＝前の壁の終点<br/>&nbsp;&nbsp;&nbsp;&nbsp;{次の壁の始点&nbsp;-&gt;&nbsp;つながっている壁|not&nbsp;in&nbsp;両方水の壁&nbsp;&amp;&amp;&nbsp;崩壊壁}から「角度」の小さい順にたどる<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;角度＝外積（前の壁、次の壁）×左手に水（正負）-&gt;&nbsp;９０～３６０<br/>&nbsp;&nbsp;{たどった壁}&nbsp;=&gt;&nbsp;{崩壊壁}<br/>{両方水の壁}を表示<br/><br/>-------------------------------------<br/>
	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154</pre></td><td class="code"><div class="highlight"><pre>package jp.yukoba.ioi2007;

import scala.collection.mutable._

object Flood4 extends Application {
  class Base
  case class Point(x:int, y:int) extends Base {
    def &lt; (that:Point) = (y &lt; that.y || (y == that.y &amp;&amp; x &lt; that.x))
  }
  case class Wall(no:int, from:Point, to:Point) extends Base {
    def &lt; (that:Wall) = (from &lt; that.from)
  }
  
  // 点番号 -&gt; Point
  val N = readInt
  val dotMap = Map(List.tabulate(N, i =&gt; {
    val line = readLine.split(&quot; &quot;).map(Integer.parseInt(_))
    (i+1, Point(line(0), line(1)))
  }):_*)
  // 壁番号 -&gt; Wall
  val W = readInt
  val wallMap = Map(List.tabulate(W, i =&gt; {
    val ary = readLine.split(&quot; &quot;).map(Integer.parseInt(_))
    // 左上に近いのを from に設定
    val p1 = dotMap(ary(0))
    val p2 = dotMap(ary(1))
    if(p1 &lt; p2)
      (i+1, Wall(i+1, p1, p2))
    else
      (i+1, Wall(i+1, p2, p1))
  }):_*)
  // 訪れていない壁番号のセット
  val unvisited:Set[int] = Set(wallMap.keys.toList:_*)
  // ソート済みの壁の壁番号の配列
  val sortAry = wallMap.keySet.toList.sort((n1, n2) =&gt; 
      wallMap(n1) &lt; wallMap(n2)).toArray
  // 上のたどっていくポインタ
  var sortAryPos = 0
  // {たどった壁} {両方水の壁}
  val visited = Set[int]()
  val bothWater = Set[int]()
  val brokenWall = Set[int]()
  // Point -&gt; Wallの配列
  val point2wallAry = Map[Point, Array[(Wall,int)]]()
  for(pointNo &lt;- dotMap.keys) {
    // 頂点から出る壁は１～４つ
    val point = dotMap(pointNo)
    point2wallAry(point) = new Array[(Wall,int)](4)
  }
  for(wallNo &lt;- unvisited) {
    def put(p:Point, wallDir:(Wall,int)) {
      val ary = point2wallAry(p)
      for(i &lt;- 0 until (ary.length)) {
        if(ary(i) == null) {
          ary(i) = wallDir
          return
        }
      }
      error(&quot;ここにはこない&quot;)
    }
    val wall = wallMap(wallNo)
    put(wall.from, (wall, 1))
    put(wall.to, (wall, -1))
  }
  
  while(unvisited.size &gt; 0) {
    //println(unvisited)
    // [全ての壁|座標でソート済み]in{まだたどっていない壁}から最初の壁をとる。次はこの配列番号から。
    def getFromSortAry():int = {
        while(true) {
          val wallNo = sortAry(sortAryPos)
        if(unvisited.contains(wallNo)) return wallNo
        sortAryPos += 1
        }
      error(&quot;ここにはこない&quot;)
    }
    var wallNo = getFromSortAry
    var wall = wallMap(wallNo) 
    // 左手に水:int＝頂点から右方向に壁 なら 1 下方向なら -1
    val isLeftWater = if(wall.from.y == wall.to.y) 1 else -1
    //println(&quot;isLeftWater = &quot; + isLeftWater)
    // 壁のたどる方向、1 = from -&gt; to、-1 = to -&gt; from
    var wallDir = 1
    // 最初の壁に戻ってくるまで、壁をたどる (do-while)
    val firstWallNo = wallNo
    val firstWallDir = wallDir
    def loop() {
      while(true) {
        //println(&quot;wall = &quot; + wall + &quot;, wallDir = &quot; + wallDir)
        //{たどった壁}に入っている =&gt; {たどった壁}から{両方水の壁}へ移動
        //  else {まだたどっていない壁}から{たどった壁}へ移動
        if(visited.contains(wallNo)) {
          visited -= wallNo
          bothWater += wallNo
        } else {
          unvisited -= wallNo
          visited += wallNo
        }
        // 次の壁の始点＝前の壁の終点
        val nextStart = (if(wallDir == 1) wall.to else wall.from)
        // {次の壁の始点 -&gt; つながっている壁|not in 両方水の壁 &amp;&amp; 崩壊壁}から「角度」の小さい順にたどる
        //println(nextStart)
        val wallAry = point2wallAry(nextStart)
        var minArg = Integer.MAX_VALUE
        var minWallDir:(Wall,int) = null
        for(i &lt;- 0 until (wallAry.length)) {
          val nextWallDir = wallAry(i)
          //println(&quot;nextWallDir = &quot; + nextWallDir)
          if(nextWallDir != null &amp;&amp; !bothWater.contains(nextWallDir._1.no) &amp;&amp; 
            !brokenWall.contains(nextWallDir._1.no)) {
            // 角度＝外積（前の壁、次の壁）×左手に水（正負）-&gt; ９０～３６０
            def getArg(wall1:Wall, wallDir1:int, wall2:Wall, wallDir2:int, isLeftWater:int):int = {
              def toSign(p:Point):Point = Point(toSignI(p.x), toSignI(p.y))
              def toSignI(i:int) = if(i&lt;0) -1 else if(i==0) 0 else 1
              def toVec(wall:Wall, wallDir:int) =
                if(wallDir == 1) Point(wall.to.x - wall.from.x, wall.to.y - wall.from.y)
                else Point(wall.from.x - wall.to.x, wall.from.y - wall.to.y)
              val vec1 = toSign(toVec(wall1, wallDir1))
              val vec2 = toSign(toVec(wall2, wallDir2))
              if(vec1 == vec2) return 180
              else if(vec1.x == -vec2.x &amp;&amp; vec1.y == -vec2.y) return 360
              val gaiseki = (vec1.x * vec2.y - vec1.y * vec2.x) * isLeftWater
              if(gaiseki &lt; 0) return 90
              else return 270
            }
            val arg = getArg(wall, wallDir, nextWallDir._1, nextWallDir._2, isLeftWater)
            //println(&quot;arg = &quot; + arg)
            if(arg &lt; minArg) {
              minArg = arg
              minWallDir = nextWallDir
            }
          }
        }
        //assert(minWallDir != null)
        if(minWallDir == null) return
        // 最初の壁に戻って来たら終了
        val nextWall = minWallDir._1
        val nextWallDir = minWallDir._2
        if(nextWall.no == firstWallNo &amp;&amp; nextWallDir == firstWallDir) return
        wall = nextWall
        wallDir = nextWallDir
        wallNo = wall.no
      }
      
    }
    loop()
    brokenWall ++= visited
    visited.clear
  }  
  println(bothWater.size)
  for(wallNo &lt;- bothWater)
    println(wallMap(wallNo).no)
  //println(brokenWall.size)
}
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20081122151140/http://ja.doukaku.org/comment/5763/addtag/" class="addtag" id="addtag_5763">Tags</a>:
	
	No tags
	&nbsp;

	
      [<a href="/web/20081122151140/http://ja.doukaku.org/lang/scala/">
		Scala
      </a>]
	  
      [<a href="/web/20081122151140/http://ja.doukaku.org/comment/5763/download/">
		download code
      </a>]
	  [<a href="/web/20081122151140/http://ja.doukaku.org/comment/5763/download_html/">
		get code as html
      </a>]<p>
	

  
  <span class="rating">
  Rating<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_5763"
  >-</span><span
  class="button yellow"
  id="rating_z_5763"
  >0</span><span 
  class="button green"
  id="rating_p_5763"
  >+</span></span></span>
  

<p>

  
    <a href="/web/20081122151140/http://ja.doukaku.org/comment/5754/"><img src="/web/20081122151140im_/http://ja.doukaku.org/static/image/gotoparent.png" alt="parent"></a>
    <a href="/web/20081122151140/http://ja.doukaku.org/comment/5763/root/"><img src="/web/20081122151140im_/http://ja.doukaku.org/static/image/gotoroot.png" alt="thread root"></a>
  

  

  [<a href="/web/20081122151140/http://ja.doukaku.org/153/reply_to/5763/">
  reply
  </a>]
  </div>
</div>
</div>




  


    </div>
  



<div class="indent">
<a href="/web/20081122151140/http://ja.doukaku.org/153/post_comment/">
post comment
</a>
</div>


<h2>Posted feedbacks - Nested</h2>
<a href="/web/20081122151140/http://ja.doukaku.org/153/flatten/">Flatten</a> 
<a href="/web/20081122151140/http://ja.doukaku.org/153/">Hidden</a> 


  

  
    





<div class="comment" id="comment5762">
  <p class="banner"><a href="/web/20081122151140/http://ja.doukaku.org/user/689/" target="_top">yukoba</a>

	
	&nbsp;
	<a href="/web/20081122151140/http://ja.doukaku.org/comment/5762/">#5762</a>(<script language="JavaScript">print_time(new Date("2008/02/15 14:24 GMT"));</script><noscript>2008/02/15 14:24 GMT</noscript>)
	
	
	
	[<a href="/web/20081122151140/http://ja.doukaku.org/lang/scala/">
	  Scala
	</a>]
	
	
	
	&nbsp;

<span class="rating">Rating<span style="background-color: #ffffff;">0/0=0.00</span></span>
  </p>
  <div class="comment_content" >
	<div class="comment_body">
	  <p>一応、正しい答えを出しますが、制限時間内に終えるには、ハッシュデーブルやソートを使わないとたぶんダメです。</p>

	</div>
	
	
	
    <div class="compact">
      <table><tr><td class="linenos"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136</pre></td><td class="code"><div class="highlight"><pre>object Flood2 extends Application {
  val N = readInt
  val dots = Map(List.tabulate(N, i =&gt; {
    val line = readLine.split(&quot; &quot;).map(Integer.parseInt(_)).toList
    (i+1, (line(0), line(1)))
  }):_*)
  val W = readInt
  val initWalls = List.tabulate(W, i =&gt; (i+1) :: readLine.split(&quot; &quot;).map(Integer.parseInt(_)).toList)
  
  def step(walls:WallList, prevHasWater:WaterMap) {
    val hasWater = searchWater(walls, prevHasWater)
    val leftWall = getLeftWall(walls, hasWater)
    if(isDone(leftWall, hasWater)) {
      printResult(leftWall)
      exit
    }
    step(leftWall, hasWater)      
  }
  step(initWalls, initHasWater)

  def initHasWater() = {
    Map(initWalls.map(wall =&gt; {
      (wall(0), (false, false))
    }):_*)
  }
  
  // 0 = 壁番号,　1 = from, 2 = to
  type Wall = List[int]
  type WallList = List[Wall]
  type WaterMap = Map[int, (boolean, boolean)]
  type Point = int
  // 壁番号, from, to
  type WallDir = (int,Point,Point)
  
  def searchWater(walls:WallList, hasWater:WaterMap) : WaterMap = {
    val haveToVisit = getHaveToVisit(walls, hasWater)
    val startWall = getStartWall(walls, haveToVisit)
    def step(checkWall:WallDir, startWall:WallDir, hasWater:WaterMap, haveToVisit:Set[Point], isLeftWater:Boolean):WaterMap = {
      if(checkWall == null) return hasWater
      // nextWall探す
      val wallList = getWalls(walls, checkWall._3)
      val nextWallList = wallList.sort((w1, w2) =&gt; getArg(checkWall, w1, isLeftWater) &lt; getArg(checkWall, w2, isLeftWater))
      var nextWall = nextWallList(0)
      // hasWater を更新
      val checkWallNo = checkWall._1
      val water = hasWater(checkWallNo)
      val wall = getWall(walls, checkWallNo)
      val nextHasWater = (hasWater(checkWallNo) = 
        if(wall(1) == checkWall._2) (true, water._2) else (water._1, true))
      // haveToVisit から減らす
      val nextHaveToVisit = (haveToVisit - checkWall._1 - checkWall._2)
      if(nextWall == startWall)
        return nextHasWater
      return step(nextWall, startWall, nextHasWater, nextHaveToVisit, isLeftWater)
    }
    step(startWall, startWall, hasWater, haveToVisit, calcIsLeftWater(startWall))
  }
  
  def calcIsLeftWater(wall:WallDir) = dots(wall._2)._1 != dots(wall._3)._1 
  
  def getArg(baseWall:WallDir, checkWall:WallDir, isLeftWater:boolean):int = {
    assert(baseWall._3 == checkWall._2)
    // baseWall を逆向きにして 90~360度の時計周りの角度を求める
    val baseVec = toVec(minus(dots(baseWall._2), dots(baseWall._3)))
    val checkVec = toVec(minus(dots(checkWall._3), dots(checkWall._2)))
    if(baseVec == checkVec) return 360
    val naiseki = (baseVec._1 * checkVec._2 - baseVec._2 * checkVec._1)
    if(naiseki == 0) return 180
    else if(naiseki &gt; 0 ^ !isLeftWater) return 90
    else return 270
  }
  
  def minus(p1:(int,int), p2:(int,int)) = (p1._1 - p2._1, p1._2 - p2._2)
  def toVec(xy:(int,int)) = (toDir(xy._1), toDir(xy._2))
  def toDir(v:int) = { if(v == 0) 0 else v / Math.abs(v) }
  
  def getWalls(walls:WallList, startPoint:Point):List[WallDir] = {
    walls.filter(wall =&gt; {
      wall(1) == startPoint || wall(2) == startPoint      
    }).map(wall =&gt; {
      if(wall(1) == startPoint)
        (wall(0), wall(1), wall(2))
      else
        (wall(0), wall(2), wall(1))
    })
  }
  
  def getWall(walls:WallList, no:int):Wall = {
    walls.find(wall =&gt; wall(0) == no).get
  }
  
  def getHaveToVisit(walls:WallList, hasWater:WaterMap) : Set[Point] = {
    // 水のついてない壁のリスト
    val nonWaterList = walls.filter(wall =&gt; {
      hasWater(wall(0)) != (true, true)
    })
    // 点のリストに変換
    Set(List.flatten(nonWaterList.map(wall =&gt; List(wall(1), wall(2)))):_*)
  }
  
  def getStartWall(walls:WallList, haveToVisit:Set[Point]) : WallDir = {
    if(haveToVisit.size == 0) return null
    // 左上の点を探す
    val p = haveToVisit.toList.sort((p1, p2) =&gt; {
      val xy1 = dots(p1)
      val xy2 = dots(p2)
      xy1._2 &lt; xy2._2 || (xy1._2 == xy2._2 &amp;&amp; xy1._1 &lt; xy2._1) 
    }).head
    // その点を含む壁を探す
    val wall = walls.find(wall =&gt; {
      wall(1) == p || wall(2) == p 
    }).get
    if(wall(1) == p) (wall(0), wall(1), wall(2))
    else (wall(0), wall(2), wall(1))
  }
  
  def getLeftWall(walls:WallList, hasWater:WaterMap) = {
    walls.filter(wall =&gt; {
      val water = hasWater(wall(0))
      water._1 == water._2
    })
  }
  
  def isDone(walls:WallList, hasWater:WaterMap):boolean = {
    walls.foreach(wall =&gt; {
      val water = hasWater(wall(0))
      if(!water._1 || !water._2) return false 
    })
    true
  }
  
  def printResult(walls:WallList) {
    println(walls.length)
    walls.foreach(w =&gt; println(w(0)))
  }
}
</pre></div>
</td></tr></table>
    </div>
	

  
  <div align = "right" class="banner">
	
	<a href="/web/20081122151140/http://ja.doukaku.org/comment/5762/addtag/" class="addtag" id="addtag_5762">Tags</a>:
	
	No tags
	&nbsp;

	
      [<a href="/web/20081122151140/http://ja.doukaku.org/lang/scala/">
		Scala
      </a>]
	  
      [<a href="/web/20081122151140/http://ja.doukaku.org/comment/5762/download/">
		download code
      </a>]
	  [<a href="/web/20081122151140/http://ja.doukaku.org/comment/5762/download_html/">
		get code as html
      </a>]<p>
	

  
  <span class="rating">
  Rating<span style="background-color: #ffffff;"
  >0/0=0.00</span
  ><span class="buttons"><span 
  class="button red"
  id="rating_n_5762"
  >-</span><span
  class="button yellow"
  id="rating_z_5762"
  >0</span><span 
  class="button green"
  id="rating_p_5762"
  >+</span></span></span>
  

<p>

  

  

  [<a href="/web/20081122151140/http://ja.doukaku.org/153/reply_to/5762/">
  reply
  </a>]
  </div>
</div>
</div>




  


  

  







</div>

<div id="side_menu" class="compact">

<iframe src="/web/20081122151140if_/http://ja.doukaku.org/login_info/" frameborder=0 width=100% id="login_info">
iframe required
</iframe>

<h4 class="semi_compact">Index</h4>

<ul>
<!--<li><a href="/web/20081122151140/http://ja.doukaku.org/user/">Users</a>-->
<li><a href="/web/20081122151140/http://ja.doukaku.org/lang/">Languages</a>
<li><a href="/web/20081122151140/http://ja.doukaku.org/challenge/">Challenges</a>
<li><a href="/web/20081122151140/http://ja.doukaku.org/topic/">Topics</a>
<li><a href="/web/20081122151140/http://ja.doukaku.org/comment/">Comments</a>
<li><a href="/web/20081122151140/http://ja.doukaku.org/good_comments/">Good comments</a>
<li><a href="/web/20081122151140/http://ja.doukaku.org/tag/">Tags</a>
</ul>

<h4 class="compact">Feed</h4>
<ul>
<li><a href="/web/20081122151140/http://ja.doukaku.org/feeds/challenges/">Latest challenges</a><img src="/web/20081122151140im_/http://ja.doukaku.org/static/image/feed_icon.png">
<li><a href="/web/20081122151140/http://ja.doukaku.org/feeds/topics/">Latest topics</a><img src="/web/20081122151140im_/http://ja.doukaku.org/static/image/feed_icon.png">
<li><a href="/web/20081122151140/http://ja.doukaku.org/feeds/comments/">Latest comments</a><img src="/web/20081122151140im_/http://ja.doukaku.org/static/image/feed_icon.png">
</ul>







<h4 class="compact">Other</h4>
<ul>
<li><a href="/web/20081122151140/http://ja.doukaku.org/qa/">Q&A</a>
<li><a href="/web/20081122151140/http://ja.doukaku.org/feedback/">Feedback</a>
<!--<li><a href="/web/20081122151140/http://ja.doukaku.org/terms">Terms</a>-->
</ul>


<h4 class="compact">Link</h4>
<ul>
<li><a href="/web/20081122151140/http://www.lingr.com/room/doukaku_ja">Chatroom in Lingr</a>
<li><a href="/web/20081122151140/http://labs.cybozu.co.jp/">Cybozu Labs.</a>
<li><a href="/web/20081122151140/http://www.djangoproject.com/">Django</a>
</ul>

<h4 id="pathtraq" class="compact"><a href="/web/20081122151140/http://pathtraq.com/analytics?url=http%3A%2F%2Fja.doukaku.org%2Fcomment%2F*%2F%20desc%3A%E3%81%A9%E3%81%86%E6%9B%B8%E3%81%8Forg&m=popular">Pathtraq</a></h4>
<div class="indent">
<span id="pathtraq_sentinel">loading...</span>
</div>


</div>
</div>


<div id="page_foot" class="bordered">

<a rel="license" href="/web/20081122151140/http://creativecommons.org/licenses/by/2.1/jp/">
<img alt="Creative Commons License" style="border-width:0" src="/web/20081122151140im_/http://i.creativecommons.org/l/by/2.1/jp/88x31.png" /></a>
このサイトの内容は、
<a rel="license" href="/web/20081122151140/http://creativecommons.org/licenses/by/2.1/jp/">クリエイティブ・コモンズ・ライセンス</a>の下でライセンスされています。
<a href="/web/20081122151140/http://ja.doukaku.org/qa/#licence">[詳細]</a>

</div>

</body>




<script type="text/javascript">
$(document).ready(function(){$("#doukaku_org").after("<script src='/web/20081122151140/http://api.pathtraq.com/pages?url=http%3A%2F%2Fja.doukaku.org%2Fcomment%2F*%2F%20desc%3A%E3%81%A9%E3%81%86%E6%9B%B8%E3%81%8Forg&api=json&callback=addPathtraq'><" + "/script>")});
</script>

<script src="/web/20081122151140js_/http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-2136157-1";
urchinTracker();
</script>




</html>





<!--
     FILE ARCHIVED ON 15:11:40 Nov 22, 2008 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 14:50:18 Nov 16, 2013.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
